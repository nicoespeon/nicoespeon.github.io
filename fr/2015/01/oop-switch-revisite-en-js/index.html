<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, minimum-scale=1.0"><meta name="description" content="En JavaScript, nous disposons d'une alternative plus orientée-objet, moins procédurale et propice aux erreurs que le bon vieux <code>switch … case</code>."><meta property="og:site_name" content="@nicoespeon's blog" /><meta property="og:url" content="http://www.nicoespeon.com/fr/2015/01/oop-switch-revisite-en-js/" /><meta property="og:type" content="article" /><meta property="og:title" content="POO - le switch revisité en JavaScript | @nicoespeon" /><meta property="og:description" content="En JavaScript, nous disposons d'une alternative plus orientée-objet, moins procédurale et propice aux erreurs que le bon vieux <code>switch … case</code>." /><meta property="og:image" content="https://fr.gravatar.com/userimage/27601663/eb6a327f57a4931bfdf6c213af65ed2d.jpg?size=300" /><title>POO - le switch revisité en JavaScript | @nicoespeon</title><link rel="icon" href="/assets/img/icon.png"><link rel="author" href="https://plus.google.com/u/0/108378377887967941980"><!-- DNS prefetch for external resources --><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//platform.twitter.com"><link rel="dns-prefetch" href="//p.twitter.com"><link rel="dns-prefetch" href="//cdn.api.twitter.com"><link rel="dns-prefetch" href="//google-analytics.com"><link rel="stylesheet"href='http://fonts.googleapis.com/css?family=Snippet|Roboto:300,100,700'><link rel="stylesheet" href="/assets/css/nicoespeon.css" media="screen"><link rel="stylesheet" href="/assets/css/nicoespeon-print.css" media="print"></head><body><div id="site"><div class="container"><div class="grid"><div class="grid__item seven-tenths portable-one-whole" role="main"><header class="media" role="banner"><!-- Brand logo --><img src="http://www.gravatar.com/avatar/46978c87c5c75cea5d05a61fa8b7d95b" class="media__img img--circle" alt="My avatar" width="80" height="80"/><!-- Main navigation --><nav class="media__body" role="navigation"><ul class="nav nav--main"><li><a href="/fr/index.html">Accueil</a></li><li><a href="/fr/about.html">À propos</a></li><li><a href="/fr/projects.html">Projets</a></li><li><a href="/fr/worth-reading.html">À Lire</a></li></ul></nav><!-- /navigation --></header><!-- /header --><article role="main"><h1>POO - le switch revisité en JavaScript</h1><div class="media"><div class="media__img"><a href="https://twitter.com/share" class="twitter-share-button" data-text="POO - le switch revisité en JavaScript |" data-via="nicoespeon">Tweeter</a></div><div class="media__body brand-face zeta">(14 Janvier, 2015)</div></div><p class="islet">En JavaScript, nous disposons d'une alternative plus orientée-objet, moins procédurale et propice aux erreurs que le bon vieux <code>switch … case</code>.</p><p>Supposons que les méthodes suivantes existent :</p><div class="highlight"><pre><code class="javascript"><span class="kd">function</span> <span class="nx">sayHello</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;Hello, how are you?&quot;</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">giveSomeNews</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;Roses are red. Did you know that?&quot;</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">sayBye</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;Ok bye!&quot;</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h2 id="quelques-rappels-sur-le-switch">Quelques rappels sur le <code>switch</code></h2><p><code>if / else</code> permet d’introduire de la logique dans notre code en créant des branches : en fonction d’une condition, nous exécuterons telle ou telle opération. Mais parfois, il y a plus de 2 branches possibles.</p><p>Le réflexe initial consiste donc à ajouter des branches avec <code>else if</code> :</p><div class="highlight"><pre><code class="javascript"><span class="k">if</span><span class="p">(</span> <span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;patrick&quot;</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">sayHello</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;jane&quot;</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">giveSomeNews</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">sayBye</span><span class="p">();</span> <span class="c1">// don&#39;t talk to strangers!</span>
<span class="p">}</span>
</code></pre></div><p>Comme c’est un petit peu verbeux, peu lisible et encore moins élégant, on utilise alors le <code>switch</code> :</p><div class="highlight"><pre><code class="javascript"><span class="k">switch</span><span class="p">(</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="s2">&quot;patrick&quot;</span><span class="o">:</span>
  <span class="nx">sayHello</span><span class="p">();</span>
  <span class="k">break</span><span class="p">;</span>

<span class="k">case</span> <span class="s2">&quot;jane&quot;</span><span class="o">:</span>
  <span class="nx">giveSomeNews</span><span class="p">();</span>
  <span class="k">break</span><span class="p">;</span>

<span class="k">default</span><span class="o">:</span>
  <span class="nx">sayBye</span><span class="p">();</span> <span class="c1">// don&#39;t talk to strangers!</span>
  <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p><code>switch</code> est une alternative classique à un enchaînement de <code>else if</code>.</p><p class="islet">À moins qu'il s'agisse d'opérations très petites (quelques lignes, claires et explicites), je préfère les encapsuler dans des fonctions <strong>explicitement nommées</strong> pour décomposer la logique de l'implémentation. Le <code>switch</code>, c'est la logique. J'utilise la même technique pour les <code>if / else</code>.</p><p>La syntaxe est plus claire, mais on introduit certaines subtilités.</p><p>Notamment, il faut prendre garde au concept du <code>break</code> introduit ici : il permet de sortir du <code>switch</code> et éviter de passer au <code>case</code> suivant.</p><h3 id="rappel-des-erreurs--viter">Rappel des erreurs à éviter !</h3><p>Lorsque l’on arrive sur un <code>switch</code>, on s’attend rarement (jamais ?) à passer à travers 2 cas différents.</p><p>À l’instar du <code>else if</code>, on s’attend à exécuter un cas et un seul. Pour cette raison, on veille à <strong>ne pas oublier le <code>break</code></strong> !</p><p>Par exemple, ce code est-il intentionnel ? Est-ce un oubli ? En tout cas, c’est une source de confusion et de bugs !</p><div class="highlight"><pre><code class="javascript"><span class="k">switch</span><span class="p">(</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="s2">&quot;patrick&quot;</span><span class="o">:</span>
  <span class="nx">sayHello</span><span class="p">();</span>
  <span class="k">break</span><span class="p">;</span>

<span class="k">case</span> <span class="s2">&quot;jane&quot;</span><span class="o">:</span>
  <span class="nx">giveSomeNews</span><span class="p">();</span>

<span class="k">default</span><span class="o">:</span>
  <span class="nx">sayBye</span><span class="p">();</span> <span class="c1">// don&#39;t talk to strangers!</span>
  <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Il existe un cas de figure où, à la limite, l’intention reste claire et qui est acceptable (et utilisée).</p><p>Il s’agit de regrouper différents inputs dans un même <code>case</code> :</p><div class="highlight"><pre><code class="javascript"><span class="k">switch</span><span class="p">(</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="s2">&quot;patrick&quot;</span><span class="o">:</span>
  <span class="nx">sayHello</span><span class="p">();</span>
  <span class="k">break</span><span class="p">;</span>

<span class="k">case</span> <span class="s2">&quot;jane&quot;</span><span class="o">:</span>
<span class="k">case</span> <span class="s2">&quot;john&quot;</span><span class="o">:</span>
  <span class="nx">giveSomeNews</span><span class="p">();</span>
  <span class="k">break</span><span class="p">;</span>

<span class="k">default</span><span class="o">:</span>
  <span class="nx">sayBye</span><span class="p">();</span> <span class="c1">// don&#39;t talk to strangers!</span>
  <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Bref, ne pas mettre un <code>break</code> à chaque <code>case</code> est très souvent propice aux erreurs car le code écrit comporte “une subtilité”, il a donc des chances d’être mal lu / interprété.</p><p>Le jeu n’en vaut pas la chandelle, aussi je vous conseille plutôt de ne pas le faire. Après, c’est vous qui voyez mais y’en a qu’on essayé…</p><h2 id="une-alternative-oriente-objet-method-lookup">Une alternative orientée objet : method lookup</h2><p>Reprenons à présent notre exemple avec un esprit moins procédural, plus orienté-objet :</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">greetings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;patrick&quot;</span><span class="o">:</span> <span class="nx">sayHello</span><span class="p">,</span>
  <span class="s2">&quot;john&quot;</span><span class="o">:</span> <span class="nx">giveSomeNews</span><span class="p">,</span>
  <span class="s2">&quot;jane&quot;</span><span class="o">:</span> <span class="nx">giveSomeNews</span>
<span class="p">};</span>

<span class="p">(</span><span class="k">typeof</span> <span class="nx">greetings</span><span class="p">[</span> <span class="nx">name</span> <span class="p">]</span><span class="err"> </span><span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span>
  <span class="o">?</span> <span class="nx">greetings</span><span class="p">[</span> <span class="nx">name</span> <span class="p">]()</span>
  <span class="o">:</span> <span class="nx">sayBye</span><span class="p">();</span>
</code></pre></div><p>On peut appeler cela le <strong>method lookup</strong> qui traduit finalement l’idée du <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/#commandpatternjavascript">Command Pattern</a>.</p><p>On utilise ici la syntaxe objet naturelle de JavaScript et la puissance de ses fonctions. Pas de <code>break</code> dont on doit se préoccuper. On dispose également de tous les avantages de l’objet, notamment le fait de pouvoir le surcharger facilement et ainsi dépendre d’un contexte particulier.</p><p>En pratique, le method lookup est pertinent par rapport au switch si vous vous trouvez dans l’un des cas suivants :</p><ul><li>aurez-vous besoin d’ajouter plus de cas ? <em>Par exemple dans le cas de plugins</em></li><li>est-il utile de pouvoir modifier les cas en cours d’exécution ? <em>Par exemple pour changer d’options en fonction du contexte.</em></li><li>est-il utile de log les cas qui ont été exécutés ? <em>Par exemple pour mettre en place un stack de undo / redo, ou un système de log.</em></li><li>êtes-vous en train d’utiliser des nombres pour lister vos cas, de manière itérative ? <em>Par exemple <code>case 1:</code>, <code>case 2:</code>, etc.</em></li><li>êtes-vous en train d’essayer de regrouper des cas ensembles en omettant de manière intentionnelle des <code>break</code> ? <em>Fall through = danger, le method lookup est bien plus clair.</em></li></ul><h2 id="remarques-sur-une-version-du-switch-avanc">Remarques sur une version du <code>switch</code> “avancé”</h2><p>Avec <code>switch</code> il est possible de tester directement une condition dans le <code>case</code>.</p><p>Ainsi, en considérant que ceci existe :</p><div class="highlight"><pre><code class="javascript"><span class="kd">function</span> <span class="nx">isPatrick</span> <span class="p">(</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;patrick&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">isJane</span> <span class="p">(</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="sr">/^jane-/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="nx">name</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>Le code suivant fonctionne parfaitement :</p><div class="highlight"><pre><code class="javascript"><span class="k">switch</span><span class="p">(</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="nx">isPatrick</span><span class="p">(</span> <span class="nx">name</span> <span class="p">)</span><span class="o">:</span>
  <span class="nx">sayHello</span><span class="p">();</span>
  <span class="k">break</span><span class="p">;</span>

<span class="k">case</span> <span class="nx">isJane</span><span class="p">(</span> <span class="nx">name</span> <span class="p">)</span><span class="o">:</span>
  <span class="nx">giveSomeNews</span><span class="p">();</span>
  <span class="k">break</span><span class="p">;</span>

<span class="k">default</span><span class="o">:</span>
  <span class="nx">sayBye</span><span class="p">();</span> <span class="c1">// don&#39;t talk to strangers!</span>
  <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p class="islet">Pour plus de lisibilité, j'ai effectivement exporté les <code>case</code> dans des fonctions qui expriment clairement l'intention afin de produire un code clair avec cette syntaxe.<br /><br />Vous conviendrez que la logique est à présent un poil plus complexe. Dans ce cas, il est donc judicieux de travailler à <strong>rendre le code plus clair</strong>.</p><p>Ceci fonctionne, peut se révéler utile et n’a pas d’équivalent avec la method lookup (que je sache).</p><p>Cela étant, <strong>prenez garde aux abus de logique</strong>. Ce n’est pas parce-qu’on peut le faire, qu’on doit le faire. Veillez à garder un esprit critique sur ce que vous faîtes : est-ce vraiment nécessaire ou existe-t-il un moyen plus simple ? Peut-on trouver design plus clair pour exprimer cette logique ?</p><p>Parfois on s’emporte dans des trucs “sexy”, mais un bon <strong>KISS</strong> ne fait jamais de mal !</p><h2 id="release-the-object-oriented-kraken">Release the (object-oriented) Kraken!</h2><p>Le <em>method lookup / command pattern</em> est l’équivalent du <code>switch</code> dans un esprit objet. <strong>Il tend à encourager l’écriture d’un code flexible, bien organisé, orienté-objet</strong> (et ça, c’est bien !).</p><p>Si <code>switch … case</code> n’est pas mauvais en soi, il peut s’avérer propice aux erreurs et encourage en soi le <em>spaghetti code</em>. Par sa nature procédurale, il peut conduire à une logique de branche complexe qui résulte souvent dans un mauvais design et donc un code peu difficile à maintenir.</p><p>En fait, il n’y a pas vraiment de raison d’utiliser <code>switch</code> plutôt que son alternative quand on veut profiter de ce que JavaScript offre. Le principal, c’est de produire un code clair pour votre future-vous et les autres !</p><div id="disqus_thread" role="complementary"></div></article></div><div class="grid__item three-tenths portable-one-whole"role="complementary"><!-- Lang navigation --><nav role="navigation"><ul class="nav nav--stacked text--center"><li ><a href="/">English version</a></li><li class="current" ><a href="/fr/">Version française</a></li></ul></nav><!-- About --><aside class="text--justify"><p>Je m'appelle <span class='brand-face'>Nicolas</span> et je suis Consultant chez <a href='http://www.octo.com/'>OCTO Technology</a>.</p><p>Je <a href='/archive'>rédige</a> des articles sur le développement web et la gestion de projets. Je suis <a href='http://www.linkedin.com/profile/view?id=143126897'>LinkedIn</a>, je <a href='https://github.com/nicoespeon/'>code</a> et je <a href='http://twitter.com/nicoespeon'>tweet</a> pas mal aussi.</p><p>J’ai tendance à <a href='https://medium.com/@nicoespeon'>écrire sur Medium</a> désormais, si vous souhaitez suivre mes articles ;-)</p></aside><!-- RSS --><aside><p class="text--center"><a href="http://www.nicoespeon.com/feed.xml"><i class="icon-connection"></i>&nbsp;Restez connectés</a></p></aside><!-- Tweets --><aside class="text--center visuallyhidden--portable"><a class="twitter-timeline" href="https://twitter.com/nicoespeon" data-widget-id="320422386929377280">Tweets de @nicoespeon</a></aside><aside class="visuallyhidden--portable push--top"><h2 class="text--center">Copains</h2><a href="http://iceranking.com">IceRanking.com</a> - (SEO) Cédric Brun, Consultant en Référencement Durable</aside></div></div></div><!-- /container --></div><!-- /main-content --><footer role="contentinfo"><div class="container"><p>&copy; 2017 - <a href="https://twitter.com/nicoespeon">Nicolas (Espeon) Carlo</a><br>Ce site est construit grâce à <a href='https://github.com/mojombo/jekyll'>Jekyll</a> et à <a href='http://inuitcss.com/'>inuit.css</a> de l'excellent <a href='https://twitter.com/csswizardry'>@csswizardry</a>. Le code source est <a href='https://github.com/nicoespeon/nicoespeon.github.io'>hébergé sur GitHub</a>.</p></div></footer><!-- jQuery --><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script>$( function () {/*** This JS code is still small so its better to keep it inline.** Only apply if we are beyond the desk CSS breakpoint on load*/if ( $( window ).width() >= 1024 ) {var $timeline = $( "ul#timeline" );/*** Then hide every label description of the timeline*/$timeline.find( "a.timeline__label" ).each( function () {$( this ).find( "p" ).hide();} );/*** And delegate the visibility effect on hover for each label description*/$timeline.on( "mouseenter mouseleave", "a.timeline__label", function () {$( this ).find( "p" ).stop().toggle( "slow" );} );}/*** Append anchor to page subtitles with IDs (used for blog posts).*/$( "h2[id], h3[id]" ).each( function () {var $title = $( this );var $anchor = $( "<a href='#" + $title.attr( "id" ) + "' class='anchor'><i class='icon-link'></i></a>" );$title.append( $anchor );} );} );</script><!-- Twitter API --><script>!function ( d, s, id ) {var js, fjs = d.getElementsByTagName( s )[0];if ( !d.getElementById( id ) ) {js = d.createElement( s );js.id = id;js.src = "//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore( js, fjs );}}( document, "script", "twitter-wjs" );</script><!-- Google Analytics --><script>var _gaq = _gaq || [];_gaq.push( ['_setAccount', 'UA-39957541-2'] );_gaq.push( ['_setDomainName', 'nicoespeon.com'] );_gaq.push( ['_trackPageview'] );(function () {var ga = document.createElement( 'script' );ga.type = 'text/javascript';ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName( 'script' )[0];s.parentNode.insertBefore( ga, s );})();</script><!-- Disqus --><script>var disqus_shortname = 'nicoespeon';var disqus_url = 'http://nicoespeon.com/fr/2015/01/oop-switch-revisite-en-js/';var title = "POO - le switch revisité en JavaScript";(function () {var dsq = document.createElement( 'script' );dsq.type = 'text/javascript';dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName( 'head' )[0] || document.getElementsByTagName( 'body' )[0]).appendChild( dsq );})();</script><noscript>Please enable JavaScript to view the <ahref="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></body></html>