<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, minimum-scale=1.0"><meta name="description" content="Qu'est-ce-qu'une fonction pure et pourquoi s'y intéresser en JavaScript ?"><meta property="og:site_name" content="@nicoespeon's blog" /><meta property="og:url" content="http://www.nicoespeon.com/fr/2015/01/fonctions-pures-javascript/" /><meta property="og:type" content="article" /><meta property="og:title" content="Fonctions pures en JavaScript | @nicoespeon" /><meta property="og:description" content="Qu'est-ce-qu'une fonction pure et pourquoi s'y intéresser en JavaScript ?" /><meta property="og:image" content="https://fr.gravatar.com/userimage/27601663/eb6a327f57a4931bfdf6c213af65ed2d.jpg?size=300" /><title>Fonctions pures en JavaScript | @nicoespeon</title><link rel="icon" href="/assets/img/icon.png"><link rel="author" href="https://plus.google.com/u/0/108378377887967941980"><!-- DNS prefetch for external resources --><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//platform.twitter.com"><link rel="dns-prefetch" href="//p.twitter.com"><link rel="dns-prefetch" href="//cdn.api.twitter.com"><link rel="dns-prefetch" href="//google-analytics.com"><link rel="stylesheet"href='http://fonts.googleapis.com/css?family=Snippet|Roboto:300,100,700'><link rel="stylesheet" href="/assets/css/nicoespeon.css" media="screen"><link rel="stylesheet" href="/assets/css/nicoespeon-print.css" media="print"></head><body><div id="site"><div class="container"><div class="grid"><div class="grid__item seven-tenths portable-one-whole" role="main"><header class="media" role="banner"><!-- Brand logo --><img src="http://www.gravatar.com/avatar/46978c87c5c75cea5d05a61fa8b7d95b" class="media__img img--circle" alt="My avatar" width="80" height="80"/><!-- Main navigation --><nav class="media__body" role="navigation"><ul class="nav nav--main"><li><a href="/fr/index.html">Accueil</a></li><li><a href="/fr/about.html">À propos</a></li><li><a href="/fr/projects.html">Projets</a></li><li><a href="/fr/worth-reading.html">À Lire</a></li></ul></nav><!-- /navigation --></header><!-- /header --><article role="main"><h1>Fonctions pures en JavaScript</h1><div class="media"><div class="media__img"><a href="https://twitter.com/share" class="twitter-share-button" data-text="Fonctions pures en JavaScript |" data-via="nicoespeon">Tweeter</a></div><div class="media__body brand-face zeta">(25 Janvier, 2015)</div></div><p class="islet">Qu'est-ce-qu'une fonction pure et pourquoi s'y intéresser en JavaScript ?</p><h2 id="cest-quoi-a-une-fonction-pure-">C’est quoi ça une fonction “pure” ?</h2><p>Une fonction pure <strong>ne dépend pas</strong> et <strong>ne modifie pas l’état de variables hors de sa portée</strong>.</p><p>En pratique, cela signifie qu’<strong>une fonction pure retourne toujours le même résultat avec des paramètres identiques</strong>. Son exécution ne dépend pas de l’état du système.</p><p>Les fonctions pures sont d’ailleurs un pilier de la <a href="http://fr.wikipedia.org/wiki/Programmation_fonctionnelle">programmation fonctionnelle</a>.</p><h3 id="quelques-exemples">Quelques exemples</h3><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">1</span> <span class="p">};</span>

<span class="kd">function</span> <span class="nx">impureFunction</span> <span class="p">(</span> <span class="nx">items</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="nx">items</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">a</span> <span class="o">*</span> <span class="nx">b</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">impureFunction</span><span class="p">(</span> <span class="nx">values</span> <span class="p">);</span>
<span class="c1">// Désormais `values.a` vaut 3 car la fonction impure l&#39;a modifié.</span>
</code></pre></div><p>Ici, on modifie les attributs de l’objet passé en paramètre, donc on modifie l’objet en dehors de la portée de notre fonction également : elle est impure dans ce cas.</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">1</span> <span class="p">};</span>

<span class="kd">function</span> <span class="nx">pureFunction</span> <span class="p">(</span> <span class="nx">a</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">*</span> <span class="nx">b</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">pureFunction</span><span class="p">(</span> <span class="nx">values</span><span class="p">.</span><span class="nx">a</span> <span class="p">);</span>
<span class="c1">// `values.a` n&#39;a pas été modifié, c&#39;est toujours 1</span>
</code></pre></div><p>Ici, on modifie simplement le paramètre dans la portée de la fonction, on ne touche à rien d’autre en dehors !</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">1</span> <span class="p">};</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">impureFunction</span> <span class="p">(</span> <span class="nx">a</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">*</span> <span class="nx">b</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">impureFunction</span><span class="p">(</span> <span class="nx">values</span><span class="p">.</span><span class="nx">a</span> <span class="p">);</span>
<span class="c1">// En fait la valeur de `c` dépend de celle de `b`.</span>
<span class="c1">// Dans une base de code plus grande vous risquez d&#39;oublier ce</span>
<span class="c1">// détail et le résultat peut vous surprendre car il peut varier</span>
<span class="c1">// de manière implicite.</span>
</code></pre></div><p>La variable <code>b</code> n’est pas dans la portée de la fonction. Le résultat dépendra du contexte : surprises garanties !</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">1</span> <span class="p">};</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">pureFunction</span> <span class="p">(</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">c</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">*</span> <span class="nx">c</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">pureFunction</span><span class="p">(</span> <span class="nx">values</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="p">);</span>
<span class="c1">// Ici il est clair que la valeur de `c` dépend de celle de `b`. </span>
<span class="c1">// Pas de surprise en douce.</span>
</code></pre></div><h2 id="et-en-pratique-a-donne-quoi-">Et en pratique ça donne quoi ?</h2><p>Considérons que ce code existe :</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">getMinQuantity</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">getMinQuantity</span> <span class="p">(</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Une fonction pure qui retourne une valeur numérique</span>
  <span class="c1">// en fonction du name.</span>
<span class="p">};</span>
</code></pre></div><p>Et prenons donc l’exemple du code suivant que l’on pourrait retrouver dans un projet lambda :</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">popover</span> <span class="o">=</span> <span class="p">{</span>

  <span class="c1">// Un tas de code…</span>

  <span class="nx">addQuantityText</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">quantity</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">quantityTextOptions</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">namespace</span><span class="o">:</span> <span class="s2">&quot;quantity&quot;</span><span class="p">,</span>
      <span class="nx">initialChildIndex</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="nx">quantity</span><span class="o">:</span> <span class="nx">quantity</span>
    <span class="p">};</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">formatQuantityText</span><span class="p">(</span> <span class="nx">quantityTextOptions</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;Couldn&#39;t add quantity text!&quot;</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">formatQuantityText</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">$$boxContainer</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span> <span class="s2">&quot;$$boxContainer is not configured&quot;</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">namespace</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">||</span> <span class="s2">&quot;quantity&quot;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">quantity</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">quantity</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">initialChildIndex</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">initialChildIndex</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">$$quantity</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Canvas</span><span class="p">();</span> <span class="c1">// implementation details hidden</span>
    <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">namespace</span><span class="p">;</span>
    <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">quantity</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setQuantityTextColor</span><span class="p">(</span> <span class="nx">$$quantity</span> <span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">$$boxContainer</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span> <span class="nx">$$quantity</span><span class="p">,</span> <span class="nx">initialChildIndex</span> <span class="p">);</span>

    <span class="k">return</span> <span class="nx">$$quantity</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">setQuantityTextColor</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">$$quantity</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">$$quantity</span> <span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">minQuantity</span> <span class="o">=</span> <span class="nx">getMinQuantity</span><span class="p">(</span> <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">name</span> <span class="p">);</span>
    <span class="kd">var</span> <span class="nx">quantity</span> <span class="o">=</span> <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">value</span> <span class="o">||</span> <span class="nx">minQuantity</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">hasEnoughQuantity</span> <span class="o">=</span> <span class="p">(</span><span class="nx">quantity</span> <span class="o">&gt;=</span> <span class="nx">minQuantity</span><span class="p">);</span>

    <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hasEnoughQuantity</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;green&quot;</span> <span class="o">:</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="c1">// Un tas de code…</span>

<span class="p">};</span>
</code></pre></div><p>Ici nous avons <code>addQuantityText()</code>, <code>formatQuantityText()</code> et <code>setQuantityTextColor()</code> qui sont toutes impures.</p><p>Dans notre contexte, c’est <code>addQuantityText()</code> qui est utilisée lorsque l’on souhaite “afficher la quantité” dans notre <code>$$boxContainer</code>. C’est le point d’entrée qui se charge de tous les détails. C’est dans cette fonction qu’on va aller jeter un œil si un soucis se présente avec notre <code>$$quantity</code>. Ça risque de devenir un vrai jeu de piste.</p><p>La manière dont il a été écrit peut être propice à certaines erreurs sur le long terme.</p><h3 id="quand-a-devient-compliqu">Quand ça devient compliqué</h3><p>Dans l’exemple, l’ordre d’exécution des fonctions est garant du bon fonctionnement du code.</p><p><strong>Il suffit d’échanger l’ordre de 2 lignes pour tout casser</strong>. Ça peut paraître évident, mais ça l’est beaucoup moins à repérer :</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">popover</span> <span class="o">=</span> <span class="p">{</span>

  <span class="c1">// Un tas de code…</span>

  <span class="nx">addQuantityText</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">quantity</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">quantityTextOptions</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">namespace</span><span class="o">:</span> <span class="s2">&quot;quantity&quot;</span><span class="p">,</span>
      <span class="nx">initialChildIndex</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="nx">quantity</span><span class="o">:</span> <span class="nx">quantity</span>
    <span class="p">};</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">formatQuantityText</span><span class="p">(</span> <span class="nx">quantityTextOptions</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;Couldn&#39;t add quantity text!&quot;</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">formatQuantityText</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">$$boxContainer</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span> <span class="s2">&quot;$$boxContainer is not configured&quot;</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">namespace</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">||</span> <span class="s2">&quot;quantity&quot;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">quantity</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">quantity</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">initialChildIndex</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">initialChildIndex</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">$$quantity</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Canvas</span><span class="p">();</span> <span class="c1">// implementation details hidden</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setQuantityTextColor</span><span class="p">(</span> <span class="nx">$$quantity</span> <span class="p">);</span>
    <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">namespace</span><span class="p">;</span>
    <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">quantity</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">$$quantity</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">setQuantityTextColor</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">$$quantity</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">$$quantity</span> <span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">minQuantity</span> <span class="o">=</span> <span class="nx">getMinQuantity</span><span class="p">(</span> <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">name</span> <span class="p">);</span>
    <span class="kd">var</span> <span class="nx">quantity</span> <span class="o">=</span> <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">value</span> <span class="o">||</span> <span class="nx">minQuantity</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">hasEnoughQuantity</span> <span class="o">=</span> <span class="p">(</span><span class="nx">quantity</span> <span class="o">&gt;=</span> <span class="nx">minQuantity</span><span class="p">);</span>

    <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hasEnoughQuantity</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;green&quot;</span> <span class="o">:</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="c1">// Un tas de code…</span>

<span class="p">};</span>
</code></pre></div><p>Il y a désormais une erreur dans le code. Le problème, c’est que ça ne saute pas aux yeux !</p><p>Ici, <code>setQuantityTextColor()</code> est responsable de la couleur de <code>$$quantity</code>. Du coup, il faut naviguer de méthodes en méthodes pour trouver celle qui modifie l’objet en dernier et reconstituer le flow pour comprendre ce qui pourrait mal se passer.</p><p>À ce moment là, on pourrait presque s’en mordre les doigts d’avoir découpé <code>formatQuantityText()</code> en petites méthodes pour simplifier les détails de son implémentation.</p><p>D’une manière générale d’ailleurs, ça fait pas mal de code à considérer en cas de debug. Et si on commence à estimer que décomposer une grosse méthode en petites complique la tâche de debug, alors le concept de <strong>fonction pure</strong> prend de l’intérêt.</p><h3 id="avec-des-fonctions-pures">Avec des fonctions pures</h3><p>Reprenons notre code en utilisant cette fois un maximum de fonctions pures :</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">popover</span> <span class="o">=</span> <span class="p">{</span>

  <span class="c1">// Un tas de code…</span>

  <span class="c1">// L&#39;ensemble des modifications de l&#39;état du système sont</span>
  <span class="c1">// concentrées ici.</span>
  <span class="c1">// Seule cette méthode est responsable de l&#39;insertion</span>
  <span class="c1">// d&#39;un élément, ce qui simplifie le debug et limite les</span>
  <span class="c1">// effets de bord.</span>
  <span class="nx">addQuantityText</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">quantity</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">$$boxContainer</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span> <span class="s2">&quot;$$boxContainer is not configured&quot;</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">quantityTextOptions</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">namespace</span><span class="o">:</span> <span class="s2">&quot;quantity&quot;</span><span class="p">,</span>
      <span class="nx">quantity</span><span class="o">:</span> <span class="nx">quantity</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">$$quantity</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">formatQuantityText</span><span class="p">(</span> <span class="nx">quantityTextOptions</span> <span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">$$boxContainer</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span> <span class="nx">$$quantity</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
  <span class="p">},</span>

  <span class="c1">// Cette fonction n&#39;a pas d&#39;effet de bord.</span>
  <span class="c1">// Elle n&#39;appelle que des fonctions pures. Elle crée et</span>
  <span class="c1">// retourne l&#39;objet canvas désiré, correctement configuré !</span>
  <span class="nx">formatQuantityText</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">namespace</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">||</span> <span class="s2">&quot;quantity&quot;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">quantity</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">quantity</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">$$quantity</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Canvas</span><span class="p">();</span> <span class="c1">// implementation details hidden</span>
    <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">namespace</span><span class="p">;</span>
    <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">quantity</span><span class="p">;</span>
    <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getQuantityTextColor</span><span class="p">(</span> <span class="nx">quantity</span><span class="p">,</span> <span class="nx">namespace</span> <span class="p">);</span>

    <span class="k">return</span> <span class="nx">$$quantity</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="c1">// Cette méthode n&#39;a plus d&#39;effet de bord non plus,</span>
  <span class="c1">// elle se charge de renvoyer la bonne couleur en fonction</span>
  <span class="c1">// de la quantité en paramètre.</span>
  <span class="nx">getQuantityTextColor</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">quantity</span><span class="p">,</span> <span class="nx">namespace</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">minQuantity</span> <span class="o">=</span> <span class="nx">getMinQuantity</span><span class="p">(</span> <span class="nx">namespace</span> <span class="p">);</span>
    <span class="kd">var</span> <span class="nx">hasEnoughQuantity</span> <span class="o">=</span> <span class="p">(</span><span class="nx">quantity</span> <span class="o">&amp;&amp;</span> <span class="nx">quantity</span> <span class="o">&gt;=</span> <span class="nx">minQuantity</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="nx">hasEnoughQuantity</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;green&quot;</span> <span class="o">:</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="c1">// Un tas de code…</span>

<span class="p">};</span>
</code></pre></div><p>Il n’y a pas de changement fondamental dans cette nouvelle version du code. Et pourtant, les bénéfices ne sont pas négligeables.</p><p>Ce qu’on a fait :</p><ul><li><code>getQuantityTextColor()</code> plutôt que <code>setQuantityTextColor()</code></li><li>la méthode nous retourne une couleur en fonction de la quantité passée en paramètre au lieu de modifier l’objet qu’on lui passait en paramètre auparavant</li><li>les méthodes ne dépendent plus de variables en dehors de leur portée</li><li>les méthodes appellent uniquement des méthodes pures</li><li>on isole la création / modification de l’objet <code>$$quantity</code> dans <code>formatQuantityText()</code></li><li>on isole les modifications de l’état du système dans la seule méthode <code>addQuantityText()</code></li></ul><p>Ainsi, nous avons supprimé les méthodes qui avaient des effets de bords. Nous avons donc <strong>simplifié la maintenance du code</strong>. Si jamais il y a un soucis avec <code>$$quantity</code>, il n’y a qu’une méthode à regarder.</p><h3 id="simplification-de-linterface">Simplification de l’interface</h3><p>Nous utilisons ici des méthodes publiques. Il serait tout à fait envisageable, voire carrément pertinent, de les rendre privées.</p><p>En effet, elles n’ont pas grand chose à faire dans notre API car <strong>leur rôle est de simplifier l’interface</strong>. Allez jeter un œil à mon article sur <a href="/fr/2014/12/fonctions-privees-backbonejs/">les fonctions privées avec Backbone.js</a> si ça vous laisse perplexe.</p><p>Comme elles sont pures, les extraire est un jeu d’enfant puisqu’elles ne dépendent d’aucun contexte mais simplement des paramètres !</p><div class="highlight"><pre><code class="javascript"><span class="kd">function</span> <span class="nx">getQuantityTextColor</span> <span class="p">(</span> <span class="nx">quantity</span><span class="p">,</span> <span class="nx">namespace</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">minQuantity</span> <span class="o">=</span> <span class="nx">getMinQuantity</span><span class="p">(</span> <span class="nx">namespace</span> <span class="p">);</span>
  <span class="kd">var</span> <span class="nx">hasEnoughQuantity</span> <span class="o">=</span> <span class="p">(</span><span class="nx">quantity</span> <span class="o">&amp;&amp;</span> <span class="nx">quantity</span> <span class="o">&gt;=</span> <span class="nx">minQuantity</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">(</span><span class="nx">hasEnoughQuantity</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;green&quot;</span> <span class="o">:</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">formatQuantityText</span> <span class="p">(</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">namespace</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">||</span> <span class="s2">&quot;quantity&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">quantity</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">quantity</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">$$quantity</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Canvas</span><span class="p">();</span> <span class="c1">// implementation details hidden</span>
  <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">namespace</span><span class="p">;</span>
  <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">quantity</span><span class="p">;</span>
  <span class="nx">$$quantity</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">getQuantityTextColor</span><span class="p">(</span> <span class="nx">quantity</span><span class="p">,</span> <span class="nx">namespace</span> <span class="p">);</span>

  <span class="k">return</span> <span class="nx">$$quantity</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div><p>Et du coup, plus loin dans le code :</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">popover</span> <span class="o">=</span> <span class="p">{</span>

  <span class="c1">// Un tas de code…</span>

  <span class="nx">addQuantityText</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">quantity</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">$$boxContainer</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span> <span class="s2">&quot;$$boxContainer is not configured&quot;</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">quantityTextOptions</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">namespace</span><span class="o">:</span> <span class="s2">&quot;quantity&quot;</span><span class="p">,</span>
      <span class="nx">quantity</span><span class="o">:</span> <span class="nx">quantity</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">$$quantity</span> <span class="o">=</span> <span class="nx">formatQuantityText</span><span class="p">(</span> <span class="nx">quantityTextOptions</span> <span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">$$boxContainer</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span> <span class="nx">$$quantity</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
  <span class="p">},</span>

  <span class="c1">// Un tas de code…</span>

<span class="p">};</span>
</code></pre></div><h2 id="lintrt-des-fonctions-pures">L’intérêt des fonctions pures</h2><p>L’avantage d’une fonction pure, c’est qu’<strong>elle n’a pas d’effets de bord</strong>. Elles ne modifient pas l’état du système en dehors de leur portée. Ainsi, elles simplifient et clarifient le code : quand on appelle une fonction pure, on peut se concentrer sur la valeur qu’elle retourne puisqu’on sait qu’elle ne va pas impacter le système en passant.</p><p>Une fonction pure est également robuste. <strong>Son ordre d’exécution n’a pas d’impact sur le système</strong>. Les opérations sur des fonctions pures sont donc parallélisables.</p><p>De même, <strong>il est très simple de tester une fonction pure</strong> puisqu’il n’y a pas de contexte considérer. Il suffit de se concentrer sur les entrées / sorties.</p><p>Enfin, maximiser le nombre de fonctions pures <strong>rend le code plus simple, plus flexible</strong>.</p><h2 id="une-question-de-design">Une question de design</h2><p>En pratique quand on fait de l’orienté-objet, on se dit que les concepts de la programmation fonctionnelle paraissent inadaptés. C’est une erreur car <a href="http://blog.cleancoder.com/uncle-bob/2014/11/24/FPvsOO.html">POO et FP sont parfaitement compatibles</a> !</p><p>En effet, l’idée ici est toute simple : <strong>simplifier le code en limitant le nombre de fonctions qui ont un impact sur l’état du système</strong>.</p><p>En s’efforçant à écrire un maximum de fonctions pures, en limitant le nombre de fonctions qui ne le sont pas, on se simplifie la vie !</p><p>En tout cas, c’est l’idée. Et souvent, en pratique, c’est surtout une question de design, de choix entre un <code>get</code> et un <code>set</code> par exemple.</p><div id="disqus_thread" role="complementary"></div></article></div><div class="grid__item three-tenths portable-one-whole"role="complementary"><!-- Lang navigation --><nav role="navigation"><ul class="nav nav--stacked text--center"><li ><a href="/">English version</a></li><li class="current" ><a href="/fr/">Version française</a></li></ul></nav><!-- About --><aside class="text--justify"><p>Je m'appelle <span class='brand-face'>Nicolas</span> et je suis Consultant chez <a href='http://www.octo.com/'>OCTO Technology</a>.</p><p>Je <a href='/archive'>rédige</a> des articles sur le développement web et la gestion de projets. Je suis <a href='https://www.linkedin.com/in/nicolas-carlo-095b243b/'>LinkedIn</a>, je <a href='https://github.com/nicoespeon/'>code</a> et je <a href='http://twitter.com/nicoespeon'>tweet</a> pas mal aussi.</p><p>J’ai tendance à <a href='https://medium.com/@nicoespeon'>écrire sur Medium</a> désormais, si vous souhaitez suivre mes articles ;-)</p></aside><!-- RSS --><aside><p class="text--center"><a href="http://www.nicoespeon.com/feed.xml"><i class="icon-connection"></i>&nbsp;Restez connectés</a></p></aside><!-- Tweets --><aside class="text--center visuallyhidden--portable"><a class="twitter-timeline" href="https://twitter.com/nicoespeon" data-widget-id="320422386929377280">Tweets de @nicoespeon</a></aside><aside class="visuallyhidden--portable push--top"><h2 class="text--center">Copains</h2><a href="http://iceranking.com">IceRanking.com</a> - (SEO) Cédric Brun, Consultant en Référencement Durable</aside></div></div></div><!-- /container --></div><!-- /main-content --><footer role="contentinfo"><div class="container"><p>&copy; 2017 - <a href="https://twitter.com/nicoespeon">Nicolas (Espeon) Carlo</a><br>Ce site est construit grâce à <a href='https://github.com/mojombo/jekyll'>Jekyll</a> et à <a href='http://inuitcss.com/'>inuit.css</a> de l'excellent <a href='https://twitter.com/csswizardry'>@csswizardry</a>. Le code source est <a href='https://github.com/nicoespeon/nicoespeon.github.io'>hébergé sur GitHub</a>.</p></div></footer><!-- jQuery --><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script>$( function () {/*** This JS code is still small so its better to keep it inline.** Only apply if we are beyond the desk CSS breakpoint on load*/if ( $( window ).width() >= 1024 ) {var $timeline = $( "ul#timeline" );/*** Then hide every label description of the timeline*/$timeline.find( "a.timeline__label" ).each( function () {$( this ).find( "p" ).hide();} );/*** And delegate the visibility effect on hover for each label description*/$timeline.on( "mouseenter mouseleave", "a.timeline__label", function () {$( this ).find( "p" ).stop().toggle( "slow" );} );}/*** Append anchor to page subtitles with IDs (used for blog posts).*/$( "h2[id], h3[id]" ).each( function () {var $title = $( this );var $anchor = $( "<a href='#" + $title.attr( "id" ) + "' class='anchor'><i class='icon-link'></i></a>" );$title.append( $anchor );} );} );</script><!-- Twitter API --><script>!function ( d, s, id ) {var js, fjs = d.getElementsByTagName( s )[0];if ( !d.getElementById( id ) ) {js = d.createElement( s );js.id = id;js.src = "//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore( js, fjs );}}( document, "script", "twitter-wjs" );</script><!-- Google Analytics --><script>var _gaq = _gaq || [];_gaq.push( ['_setAccount', 'UA-39957541-2'] );_gaq.push( ['_setDomainName', 'nicoespeon.com'] );_gaq.push( ['_trackPageview'] );(function () {var ga = document.createElement( 'script' );ga.type = 'text/javascript';ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName( 'script' )[0];s.parentNode.insertBefore( ga, s );})();</script><!-- Disqus --><script>var disqus_shortname = 'nicoespeon';var disqus_url = 'http://nicoespeon.com/fr/2015/01/fonctions-pures-javascript/';var title = "Fonctions pures en JavaScript";(function () {var dsq = document.createElement( 'script' );dsq.type = 'text/javascript';dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName( 'head' )[0] || document.getElementsByTagName( 'body' )[0]).appendChild( dsq );})();</script><noscript>Please enable JavaScript to view the <ahref="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></body></html>
