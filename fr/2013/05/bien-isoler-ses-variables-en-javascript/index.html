<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, minimum-scale=1.0"><meta name="description" content="Une histoire de fonctions anonymes et auto-exécutantes (IIFE)... Parce-qu'on n'y pense pas assez, et que c'est bien pratique quand même !"><meta property="og:site_name" content="@nicoespeon's blog" /><meta property="og:url" content="http://www.nicoespeon.com/fr/2013/05/bien-isoler-ses-variables-en-javascript/" /><meta property="og:type" content="article" /><meta property="og:title" content="Bien isoler ses variables en Javascript | @nicoespeon" /><meta property="og:description" content="Une histoire de fonctions anonymes et auto-exécutantes (IIFE)... Parce-qu'on n'y pense pas assez, et que c'est bien pratique quand même !" /><meta property="og:image" content="https://fr.gravatar.com/userimage/27601663/eb6a327f57a4931bfdf6c213af65ed2d.jpg?size=300" /><title>Bien isoler ses variables en Javascript | @nicoespeon</title><link rel="icon" href="/assets/img/icon.png"><link rel="author" href="https://plus.google.com/u/0/108378377887967941980"><!-- DNS prefetch for external resources --><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//platform.twitter.com"><link rel="dns-prefetch" href="//p.twitter.com"><link rel="dns-prefetch" href="//cdn.api.twitter.com"><link rel="dns-prefetch" href="//google-analytics.com"><link rel="stylesheet"href='http://fonts.googleapis.com/css?family=Snippet|Roboto:300,100,700'><link rel="stylesheet" href="/assets/css/nicoespeon.css" media="screen"><link rel="stylesheet" href="/assets/css/nicoespeon-print.css" media="print"></head><body><div id="site"><div class="container"><div class="grid"><div class="grid__item seven-tenths portable-one-whole" role="main"><header class="media" role="banner"><!-- Brand logo --><img src="http://www.gravatar.com/avatar/46978c87c5c75cea5d05a61fa8b7d95b" class="media__img img--circle" alt="My avatar" width="80" height="80"/><!-- Main navigation --><nav class="media__body" role="navigation"><ul class="nav nav--main"><li><a href="/fr/index.html">Accueil</a></li><li><a href="/fr/about.html">À propos</a></li><li><a href="/fr/projects.html">Projets</a></li><li><a href="/fr/worth-reading.html">À Lire</a></li></ul></nav><!-- /navigation --></header><!-- /header --><article role="main"><h1>Bien isoler ses variables en Javascript</h1><div class="media"><div class="media__img"><a href="https://twitter.com/share" class="twitter-share-button" data-text="Bien isoler ses variables en Javascript |" data-via="nicoespeon">Tweeter</a></div><div class="media__body brand-face zeta">(19 Mai, 2013)</div></div><p class="islet">Une histoire de fonctions anonymes et auto-exécutantes (IIFE)... Parce-qu'on n'y pense pas assez, et que c'est bien pratique quand même !</p><h2 id="tldr">TL;DR</h2><p>Ne pas se préoccuper de la portée des variables en Javascript, c’est aller au-devant de graves déconvenues. Il est important <strong>d’isoler l’environnement de son script</strong> afin de ne pas modifier involontairement des variables globales lors de son exécution.</p><p>Les <strong>fonctions anonymes auto-exécutantes</strong> (ou <a href="http://en.wikipedia.org/wiki/Immediately-invoked_function_expression">IIFE</a>, selon) permettent donc d’isoler le code sans perturber son exécution :</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// votre code JS</span>
<span class="p">})();</span>
</code></pre></div><p>De plus, elle rendent le code plus flexible et robuste en permettant de créer des alias aux variables globales passées en paramètre :</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// votre code JS</span>
<span class="p">})(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">jQuery</span><span class="p">);</span>
</code></pre></div><h2 id="envelopp-piqu-porte-">Enveloppé, Piqué, Porté(e) !</h2><p>Je laisse les premiers points aux Étoiles et je me concentrerais ici sur la question de <strong>la portée des variables</strong> en Javascript. Ce point, auquel on ne songe pas assez, est en effet susceptible de causer bien des soucis à grande échelle si l’on n’y prend pas garde.</p><p>Pour faire simple, il serait fort regrettable que le script que l’on est en train d’écrire ne se comporte pas comme prévu parce-que la variable <code>gobgob</code> que l’on déclare est déjà utilisée ailleurs et qu’on n’y a pas fait attention.</p><p>Il serait également gênant que notre superbe plugin de slideshow se mettent à planter complètement à l’exécution de notre script. Pourquoi ? Parce-que nous n’aurons pas pris garde au fait que ce magnifique plugin utilise la même variable que nous, et que nous venons tout juste de changer sa valeur (du coup) !</p><p>Pour éviter ce genre de scénario bien fâcheux, il faut <strong>isoler les variables</strong> de notre script du reste de l’environnement. C’est tout à fait réalisable et, si ce plugin avait été si magnifique que ça, c’est ce qu’il aurait fait !</p><h4 id="petit-rappel-sur-la-porte-des-variables-en-js">Petit rappel sur la portée des variables en JS</h4><p>En déclarant une variable comme il se doit, celle-ci est accessible à tout le script dans lequel elle est contenue, y compris dans les fonctions qui y sont déclarées.</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Hey !&quot;</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">maFonction</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Renvoie &quot;Hey !&quot;</span>
<span class="nx">maFonction</span><span class="p">();</span>
</code></pre></div><p>En revanche, une variable proprement déclarée dans une fonction n’est pas accessible à l’extérieur de celle-ci : elle est isolée dans la fonction.</p><p>Cependant, le fait d’omettre le mot clef <code>var</code> lors de la déclaration d’une variable rend celle-ci <strong>globale</strong>, c’est à dire accessible depuis tout le script (ce qui, en général, n’est pas très très propre).</p><div class="highlight"><pre><code class="javascript"><span class="kd">function</span> <span class="nx">maFonction</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Hey !&quot;</span><span class="p">;</span>
    <span class="nx">gubgub</span> <span class="o">=</span> <span class="s2">&quot;Ho !&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">maFonction</span><span class="p">();</span>

<span class="c1">// Renvoie &quot;ReferenceError: gobgob is not defined&quot;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span><span class="p">);</span>

<span class="c1">// Renvoie &quot;Ho !&quot;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gubgub</span><span class="p">);</span>
</code></pre></div><p>Ce que nous souhaitons, c’est faire en sorte que les variables de notre script ne viennent pas modifier d’éventuelles variables qui existeraient déjà ailleurs !</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Hey!&quot;</span><span class="p">;</span>

<span class="c1">// (...)</span>
<span class="c1">// Quelque part, bien loin dans votre JavaScript...</span>
<span class="c1">// ... une surchage sauvage d&#39;une variable existante (et oubliée) apparaît !</span>
<span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Ho!&quot;</span><span class="p">;</span>
</code></pre></div><h2 id="sortez-couverts-">Sortez couverts !</h2><p>Pour résoudre nos soucis, il s’agit donc <strong>d’isoler les variables</strong> afin de limiter leur portée au seul endroit qui nous intéresse et ne pas venir redéfinir par mégarde des variables ou polluer l’environnement (écologie toussa toussa) avec des variables globales qui n’ont pas lieu d’être.</p><p>Pour cela, il s’agit d’envelopper notre code Javascript dans ce que l’on appelle basiquement une <strong>fonction anonyme auto-exécutante</strong> :</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// votre code JS</span>
<span class="p">})();</span>
</code></pre></div><p>Cette encapsulation est donc :</p><ul><li><strong>anonyme</strong> car la fonction ne porte pas de nom</li><li><strong>auto-exécutante</strong> car elle est interprétée directement grâce au petit <code>();</code> final</li></ul><p>Pour reprendre notre exemple précédent :</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Hey !&quot;</span><span class="p">;</span>

<span class="c1">// On enveloppe notre script comme il faut</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Ho!&quot;</span><span class="p">;</span>

    <span class="c1">// Renvoie &quot;Ho!&quot;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span><span class="p">);</span>
<span class="p">})();</span>

<span class="c1">// Renvoie &quot;Hey !&quot; -&gt; bingo !</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span><span class="p">);</span>
</code></pre></div><p>Rien n’est boulversé dans l’exécution du script.</p><p>Par contre, <strong>nous n’avons plus à nous soucier des autres variables</strong> qui peuvent exister à partir du moment où nous travaillons dans notre environnement isolé : nous ne venons pas modifier par mégarde une variable globale !</p><p>En revanche, rien ne nous empêche d’utiliser une variable globale pour autant :</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Hey !&quot;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Renvoie &quot;Hey !&quot;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre></div><h4 id="renommer-des-variables-globales-dans-notre-script">Renommer des variables globales dans notre script</h4><p>Il est également possible de <strong>passer des variables en paramètre</strong>, généralement afin de les redéfinir pour l’usage de notre script. C’est d’ailleurs une bonne pratique à adopter lorsque vous travailler avec une librairie telle que <em>jQuery</em> !</p><p>Imaginez que vous souhaitiez créer un petit script sympatoche. Si vous utilisez <em>jQuery</em>, vous allez probablement utiliser des <code>$</code> à gogo !</p><p>Seulement, que se passe-t-il si demain une autre bibliothèque vient complémenter <em>jQuery</em> et utilise également le <code>$</code> comme référence ? Vous aller passer <em>jQuery</em> <a href="http://api.jquery.com/jQuery.noConflict/">en mode <code>noConflict()</code></a>… et vous allez devoir reprendre votre script pour transformer tous vos <code>$</code> en <code>jQuery</code>.</p><p>Ou alors, vous avez retenu ce que vous avez lu ici et 2 lignes de code vous permettront d’isoler bien proprement votre script, qui s’exécutera quoiqu’il arrive :</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// votre script JS avec des $ tout partout</span>
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>
</code></pre></div><p>L’avantage de cette technique c’est que vous pouvez rapidement switcher de librairie sans modifier votre script, qui gagne donc en flexibilité et stabilité :</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// votre script JS avec des $ tout partout</span>
<span class="p">})(</span><span class="nx">Zepto</span><span class="p">);</span>
</code></pre></div><p class="islet"><strong>Note performance</strong> - Le double effet Kiss Cool de cette technique intervient lors de la minification de votre script. En effet, il sera possible de minifier les noms de toutes vos variables sans affecter le code (puisqu'il s'agit ni plus ni moins d'alias au final), donc de gagner de la place.</p><div class="highlight"><pre><code class="javascript"><span class="c1">// Exemple où les occurrences à `window` ont été minimifiées</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="nb">window</span><span class="p">);</span> <span class="c1">// Renvoie `true`</span>
<span class="p">})(</span><span class="nb">window</span><span class="p">);</span>
</code></pre></div><h4 id="astuce--crer-un-alias-pour-undefined">Astuce : Créer un alias pour <code>undefined</code></h4><p>Une bonne pratique, qui est également utilisée <a href="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.js">dans le code source de <em>jQuery</em></a>, consiste à déclarer un paramètre supplémentaire non défini, qui vaudra alors <code>undefined</code> dans votre script :</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Crée une variable gobgob valant `undefined`</span>
    <span class="kd">var</span> <span class="nx">gobgob</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">);</span>  <span class="c1">// Renvoie `true`</span>

    <span class="c1">// Notre dernière variable est donc un alias pour `undefined`</span>
<span class="p">})(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">jQuery</span><span class="p">);</span>
</code></pre></div><h4 id="astuce-bis--accder-au-variables-en-dehors">Astuce bis : Accéder au variables, en dehors</h4><p><em>Merci <a href="https://twitter.com/fabien0102">@fabien0102</a> pour m’avoir fait remarquer qu’il manquait ce point de détail.</em></p><p>Isoler son code, c’est bien. Mais parfois, on développe un plugin/une librairie et on aimerait bien pouvoir accéder à notre objet de l’extérieur, histoire de pouvoir s’en servir.</p><p>Il existe probablement différentes alternatives, mais en voici une toute simple : il suffit d’attacher notre variable à <code>window</code>, et ça marche.</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Crée une variable gobgob et l&#39;attache à window</span>
    <span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Hey !&quot;</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">gobgob</span> <span class="o">=</span> <span class="nx">gobgob</span><span class="p">;</span>
<span class="p">})(</span><span class="nb">window</span><span class="p">);</span>

<span class="c1">// Renvoie &quot;Hey !&quot;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span><span class="p">);</span>
</code></pre></div><h2 id="le-mot-de-la-fin">Le mot de la fin</h2><p>Cet article français se place dans la lignée des bonnes pratiques Javascript. C’est un premier pas vers l’élaboration de splendides scripts modulaires qui sont les composantes de plus gros projets.</p><p>Ce n’est pas quelque chose de radicalement nouveau pour autant, bien qu’il n’y ait pas masse d’articles francophones sur la question (à ce niveau là, il faut généralement se mettre à la langue de Shakespeare).</p><p>Enfin, je trouvais que cela faisait une bonne mise en pied à l’explication du fonctionnement d’un plugin jQuery (ça c’est du teasing).</p><p>Comme d’habitude, n’hésitez pas à émettre remarques, suggestions et questions aussi diverses que variées ci-dessous.</p><p>Plop !</p><div id="disqus_thread" role="complementary"></div></article></div><div class="grid__item three-tenths portable-one-whole"role="complementary"><!-- Lang navigation --><nav role="navigation"><ul class="nav nav--stacked text--center"><li ><a href="/">English version</a></li><li class="current" ><a href="/fr/">Version française</a></li></ul></nav><!-- About --><aside class="text--justify"><p>Je m'appelle <span class='brand-face'>Nicolas</span> et je suis Consultant chez <a href='http://www.octo.com/'>OCTO Technology</a>.</p><p>Je <a href='/archive'>rédige</a> des articles sur le développement web et la gestion de projets. Je suis <a href='http://www.linkedin.com/profile/view?id=143126897'>LinkedIn</a>, je <a href='https://github.com/nicoespeon/'>code</a> et je <a href='http://twitter.com/nicoespeon'>tweet</a> pas mal aussi.</p><p>J’ai tendance à <a href='https://medium.com/@nicoespeon'>écrire sur Medium</a> désormais, si vous souhaitez suivre mes articles ;-)</p></aside><!-- RSS --><aside><p class="text--center"><a href="http://www.nicoespeon.com/feed.xml"><i class="icon-connection"></i>&nbsp;Restez connectés</a></p></aside><!-- Tweets --><aside class="text--center visuallyhidden--portable"><a class="twitter-timeline" href="https://twitter.com/nicoespeon" data-widget-id="320422386929377280">Tweets de @nicoespeon</a></aside><aside class="visuallyhidden--portable push--top"><h2 class="text--center">Copains</h2><a href="http://iceranking.com">IceRanking.com</a> - (SEO) Cédric Brun, Consultant en Référencement Durable</aside></div></div></div><!-- /container --></div><!-- /main-content --><footer role="contentinfo"><div class="container"><p>&copy; 2017 - <a href="https://twitter.com/nicoespeon">Nicolas (Espeon) Carlo</a><br>Ce site est construit grâce à <a href='https://github.com/mojombo/jekyll'>Jekyll</a> et à <a href='http://inuitcss.com/'>inuit.css</a> de l'excellent <a href='https://twitter.com/csswizardry'>@csswizardry</a>. Le code source est <a href='https://github.com/nicoespeon/nicoespeon.github.io'>hébergé sur GitHub</a>.</p></div></footer><!-- jQuery --><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script>$( function () {/*** This JS code is still small so its better to keep it inline.** Only apply if we are beyond the desk CSS breakpoint on load*/if ( $( window ).width() >= 1024 ) {var $timeline = $( "ul#timeline" );/*** Then hide every label description of the timeline*/$timeline.find( "a.timeline__label" ).each( function () {$( this ).find( "p" ).hide();} );/*** And delegate the visibility effect on hover for each label description*/$timeline.on( "mouseenter mouseleave", "a.timeline__label", function () {$( this ).find( "p" ).stop().toggle( "slow" );} );}/*** Append anchor to page subtitles with IDs (used for blog posts).*/$( "h2[id], h3[id]" ).each( function () {var $title = $( this );var $anchor = $( "<a href='#" + $title.attr( "id" ) + "' class='anchor'><i class='icon-link'></i></a>" );$title.append( $anchor );} );} );</script><!-- Twitter API --><script>!function ( d, s, id ) {var js, fjs = d.getElementsByTagName( s )[0];if ( !d.getElementById( id ) ) {js = d.createElement( s );js.id = id;js.src = "//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore( js, fjs );}}( document, "script", "twitter-wjs" );</script><!-- Google Analytics --><script>var _gaq = _gaq || [];_gaq.push( ['_setAccount', 'UA-39957541-2'] );_gaq.push( ['_setDomainName', 'nicoespeon.com'] );_gaq.push( ['_trackPageview'] );(function () {var ga = document.createElement( 'script' );ga.type = 'text/javascript';ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName( 'script' )[0];s.parentNode.insertBefore( ga, s );})();</script><!-- Disqus --><script>var disqus_shortname = 'nicoespeon';var disqus_url = 'http://nicoespeon.com/fr/2013/05/bien-isoler-ses-variables-en-javascript/';var title = "Bien isoler ses variables en Javascript";(function () {var dsq = document.createElement( 'script' );dsq.type = 'text/javascript';dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName( 'head' )[0] || document.getElementsByTagName( 'body' )[0]).appendChild( dsq );})();</script><noscript>Please enable JavaScript to view the <ahref="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></body></html>