<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, minimum-scale=1.0"><meta name="description" content="Bonne pratique et manipulation des données en jQuery, sans colorants ni conservateurs."><meta property="og:site_name" content="@nicoespeon's blog" /><meta property="og:url" content="http://www.nicoespeon.com/fr/2013/05/jquery-data-et-performance/" /><meta property="og:type" content="article" /><meta property="og:title" content="jQuery, data et performance | @nicoespeon" /><meta property="og:description" content="Bonne pratique et manipulation des données en jQuery, sans colorants ni conservateurs." /><meta property="og:image" content="https://fr.gravatar.com/userimage/27601663/eb6a327f57a4931bfdf6c213af65ed2d.jpg?size=300" /><title>jQuery, data et performance | @nicoespeon</title><link rel="icon" href="/assets/img/icon.png"><link rel="author" href="https://plus.google.com/u/0/108378377887967941980"><!-- DNS prefetch for external resources --><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//platform.twitter.com"><link rel="dns-prefetch" href="//p.twitter.com"><link rel="dns-prefetch" href="//cdn.api.twitter.com"><link rel="dns-prefetch" href="//google-analytics.com"><link rel="stylesheet"href='http://fonts.googleapis.com/css?family=Snippet|Roboto:300,100,700'><link rel="stylesheet" href="/assets/css/nicoespeon.css" media="screen"><link rel="stylesheet" href="/assets/css/nicoespeon-print.css" media="print"></head><body><div id="site"><div class="container"><div class="grid"><div class="grid__item seven-tenths portable-one-whole" role="main"><header class="media" role="banner"><!-- Brand logo --><img src="http://www.gravatar.com/avatar/46978c87c5c75cea5d05a61fa8b7d95b" class="media__img img--circle" alt="My avatar" width="80" height="80"/><!-- Main navigation --><nav class="media__body" role="navigation"><ul class="nav nav--main"><li><a href="/fr/index.html">Accueil</a></li><li><a href="/fr/about.html">À propos</a></li><li><a href="/fr/projects.html">Projets</a></li><li><a href="/fr/worth-reading.html">À Lire</a></li></ul></nav><!-- /navigation --></header><!-- /header --><article role="main"><h1>jQuery, data et performance</h1><div class="media"><div class="media__img"><a href="https://twitter.com/share" class="twitter-share-button" data-text="jQuery, data et performance |" data-via="nicoespeon">Tweeter</a></div><div class="media__body brand-face zeta">(04 Mai, 2013)</div></div><p class="islet">Bonne pratique et manipulation des données en jQuery, sans colorants ni conservateurs.</p><h2 id="tldr">TL;DR</h2><p>jQuery simplifie la manipulation des données rattachées aux éléments.</p><p>L’attribut HTML5 <code>data-*</code> est lié à l’objet <strong>data</strong> de jQuery pour les éléments du DOM.</p><p><code>$.data(element, key[, value])</code> permet de manipuler des données rattachées aux éléments du DOM.</p><p><code>$.fn.data(key[, value])</code> permet de manipuler des données rattachées aux éléments jQuery.</p><p><code>$.data</code> étant plus basique que <code>$.fn.data</code>, il est plus rapide à l’exécution. Il est en revanche moins flexible, moins pratique et il ne permet pas d’accéder aux attributs <code>data-*</code>.</p><div class="highlight"><pre><code class="html"><span class="c">&lt;!-- HTML --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;main-content&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="javascript"><span class="c1">// Javascript</span>
<span class="kd">var</span> <span class="nx">$el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#main-content&#39;</span><span class="p">);</span>

<span class="nx">$el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;plop&#39;</span><span class="p">);</span>    <span class="c1">// rapide</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">$el</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;plop&#39;</span><span class="p">);</span> <span class="c1">// 10 fois plus rapide</span>
</code></pre></div><p>Enfin, ces 2 méthodes ne modifient pas le DOM, contrairement à <code>$.fn.attr</code>.</p><div class="highlight"><pre><code class="javascript"><span class="nx">$el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;plop&#39;</span><span class="p">);</span>
    <span class="c1">// &lt;div id=&quot;main-content&quot;&gt;&lt;/div&gt;</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">$el</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;plop&#39;</span><span class="p">);</span>
    <span class="c1">// &lt;div id=&quot;main-content&quot;&gt;&lt;/div&gt;</span>
<span class="nx">$el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-key&#39;</span><span class="p">,</span> <span class="s1">&#39;plop&#39;</span><span class="p">);</span>
    <span class="c1">// &lt;div id=&quot;main-content&quot; data-key=&quot;plop&quot;&gt;&lt;/div&gt;</span>
</code></pre></div><h2 id="manipuler-des-data-avec-jquery">Manipuler des data avec jQuery</h2><p>Rattacher une information à un élément et la manipuler au fil de l’exécution d’un script est une opération vraiment simple avec jQuery. En effet, la bibliothèque dispose de méthodes permettant de stocker, modifier et supprimer les données relatives à un élément.</p><p>Par ailleurs, il est intéressant de savoir que les attributs <code>data-*</code> introduits par le HTML5 sont automatiquement transformés en objet <strong>data</strong> jQuery et sont donc accessibles par le biais de certaines de ces méthodes.</p><h4 id="fndata">$.fn.data</h4><p>La méthode la plus populaire est <code>$.fn.data</code> qui s’utilise de la manière suivante :</p><div class="highlight"><pre><code class="javascript"><span class="c1">// Affecte la chaîne de caractère &quot;plop&quot; à la clef &quot;key&quot;</span>
<span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;plop&#39;</span><span class="p">);</span>

<span class="c1">// Lit la donnée portant la clef &quot;key&quot;</span>
<span class="nx">elem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre><code class="html"><span class="c">&lt;!-- Code valide en HTML5 --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;elem&quot;</span> <span class="na">data-my-key=</span><span class="s">&quot;hey&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#elem&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;myKey&#39;</span><span class="p">);</span> <span class="c1">// Retourne &quot;hey&quot;</span>
</code></pre></div><p class="islet">Vous noterez que l'on retire <code>data-</code> et l'on supprime les tirets du HTML pour spécifier la clef, avec une notation à la CamelCase conformément à <a href="http://www.w3.org/TR/html5/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes">la spécification W3C</a>.</p><p><a href="http://api.jquery.com/data/">La documentation</a> est simple à assimiler et présente plutôt bien le concept.</p><p>Notez que l’on dispose également de la méthode <code>$.fn.removeData</code> pour nettoyer tout cela si besoin :</p><div class="highlight"><pre><code class="javascript"><span class="nx">elem</span><span class="p">.</span><span class="nx">removeData</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span> <span class="c1">// Bye bye !</span>
</code></pre></div><h4 id="data">$.data</h4><p>Il existe également la méthode jQuery <code>$.data</code> plus bas-niveau, moins connue. Elle remplie quasiment le même rôle, à ceci près que sa syntaxe diffère et qu’elle considère l’élément du DOM associé en paramètre.</p><div class="highlight"><pre><code class="javascript"><span class="c1">// Affecte la chaîne de caractère &quot;plop&quot; à la clef &quot;key&quot;</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;plop&#39;</span><span class="p">);</span>

<span class="c1">// Lit la donnée portant la clef &quot;key&quot;</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">);</span>
</code></pre></div><p>Là encore, je vous invite à jeter un oeil à <a href="http://api.jquery.com/jQuery.data/">la documentation officielle</a>.</p><p>L’on dispose également de la méthode <code>$.removeData</code> pour supprimer des données, ainsi que de la méthode <code>$.hasData</code> pour vérifier si l’élément a des données rattachées ou non :</p><div class="highlight"><pre><code class="javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">hasData</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span>           <span class="c1">// Retourne &quot;true&quot;</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">removeData</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">);</span> <span class="c1">// Bye bye !</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">hasData</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span>           <span class="c1">// Retourne &quot;false&quot;</span>
</code></pre></div><h2 id="performance-vs-puissance">Performance vs. Puissance</h2><p>Quel est l’intérêt d’utiliser <code>$.data</code> quand <code>$.fn.data</code> est plus sexy me direz-vous ?</p><p>Et bien comme la méthode est plus bas-niveau, plus simple, <strong>elle s’exécute aussi bien plus rapidement</strong> !</p><div class="highlight"><pre><code class="javascript"><span class="nx">el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;plop&#39;</span><span class="p">);</span>    <span class="c1">// rapide</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;plop&#39;</span><span class="p">);</span> <span class="c1">// jusqu&#39;à 10 fois plus rapide</span>
</code></pre></div><p>Je vous invite à <a href="jsperf.com/jquery-fn-data-vs-data">tester les performances par vous-même</a>.</p><p>En contrepartie, elle doit rattacher les données à un élément du DOM tandis que <code>$.fn.data</code> peut gérer des données sur toute sorte d’objet jQuery, y compris les évènements :</p><div class="highlight"><pre><code class="javascript"><span class="c1">// Affecte l&#39;index de chaque lien comme donnée de l&#39;événement &quot;click&quot;</span>
<span class="c1">// Quand on clique sur un lien, ça affiche son index</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">index</span><span class="o">:</span><span class="nx">i</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Mon index est &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div><p>Enfin, <code>$.data</code> ne gère pas les attributs HTML5 <code>data-*</code> tandis que <code>$.fn.data</code> si.</p><p>En pratique :- si l’on travaille avec un événement, on utilise <code>$.fn.data</code>- si l’on travaille avec un attribut HTML5 <code>data-*</code>, on utilise <code>$.fn.data</code>- dans tous les autres cas, on utilise <code>$.data</code> parce-qu’il est plus performant</p><h2 id="un-mot-sur-le-dom">Un mot sur le DOM</h2><p>Il est bon de noter que les deux méthodes <code>$.data</code> et <code>$.fn.data</code> ont ceci en commun qu’elles <strong>ne modifient pas le DOM</strong>.</p><p>Plus concrètement, si la méthode <code>$.fn.data</code> permet d’accéder aux attributs <code>data-*</code>, elle ne les modifiera pas (pas dans le DOM). En effet, il ne faut pas se laisser embrouiller par le niveau d’abstraction de la fonction : ce n’est pas l’attribut que vous manipulez par cette méthode mais <strong>un objet jQuery</strong>, créé automatiquement pour l’occasion.</p><p>En contrepartie, la méthode <code>$.fn.attr</code> est une alternative qui permet d’accéder aux attributs du DOM ainsi que de les modifier.</p><div class="highlight"><pre><code class="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;main-content&quot;</span> <span class="na">data-my-key=</span><span class="s">&quot;hey&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#main-content&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;myKey&#39;</span><span class="p">,</span> <span class="s1">&#39;plop&#39;</span><span class="p">);</span>
    <span class="c1">// Change l&#39;objet jQuery mais ne change pas le DOM</span>
    <span class="c1">// &lt;div id=&quot;main-content&quot; data-my-key=&quot;hey&quot;&gt;&lt;/div&gt;</span>
    <span class="c1">// Rq: $(&#39;#main-content&#39;).data(&#39;myKey&#39;) retourne bien &quot;plop&quot;</span>

<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#main-content&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-my-key&#39;</span><span class="p">,</span> <span class="s1">&#39;plop&#39;</span><span class="p">);</span>
    <span class="c1">// Change effectivement le DOM</span>
    <span class="c1">// &lt;div id=&quot;main-content&quot; data-key=&quot;plop&quot;&gt;&lt;/div&gt;</span>
</code></pre></div><p>Dans le premier cas, nous avons bel et bien modifié l’objet jQuery, mais aucune opération n’est menée sur le HTML.</p><p>Dans le second cas en revanche, c’est bel et bien le HTML que l’on modifie.</p><p>En ce qui concerne la performance, il est à noter que <a href="http://jsperf.com/jquery-fn-data-vs-fn-attr">le second est plus rapide que le premier</a>. Une raison à cela est probablement que <code>$.fn.data</code> fait bien plus que juste “accéder” à l’élément : il le caste en fonction de son type.</p><p>Ainsi, cela peut être assez utile pour l’élaboration de plugins ou de widgets :</p><div class="highlight"><pre><code class="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;widget&quot;</span> <span class="na">data-row=</span><span class="s">&quot;2&quot;</span> <span class="na">data-responsive=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.widget&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">myWidget</span><span class="p">(</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;rows&#39;</span><span class="p">),</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;responsive&#39;</span><span class="p">)</span>
    <span class="p">);</span>
<span class="p">});</span>
</code></pre></div><p>En contrepartie, <code>$.fn.attr</code> renverra toujours une chaîne de caractères, ce qui peut être utile dans certains cas.</p><h2 id="le-mot-de-la-fin">Le mot de la fin</h2><p>Voici pour une brève (mais intense !) présentation des méthodes qui existent en jQuery pour manipuler les données.</p><p>Le point sur la performance me semblait intéressant, il ne faut pas se formaliser pour autant : ce n’est pas cela qui boostera considérablement vos scripts. Cela étant, c’est toujours bon à savoir !</p><p>Avec un peu de chance, cela aura été l’un de vos <em>“Aha moment”</em> en JS (<a href="http://hugogiraudel.com/2013/04/30/css-aha-moment/">comme diraient certains</a>) =)</p><p>Plop !</p><div id="disqus_thread" role="complementary"></div></article></div><div class="grid__item three-tenths portable-one-whole"role="complementary"><!-- Lang navigation --><nav role="navigation"><ul class="nav nav--stacked text--center"><li ><a href="/">English version</a></li><li class="current" ><a href="/fr/">Version française</a></li></ul></nav><!-- About --><aside class="text--justify"><p>Je m'appelle <span class='brand-face'>Nicolas</span> et je suis Consultant chez <a href='http://www.octo.com/'>OCTO Technology</a>.</p><p>Je <a href='/archive'>rédige</a> des articles sur le développement web et la gestion de projets. Je suis <a href='http://www.linkedin.com/profile/view?id=143126897'>LinkedIn</a>, je <a href='https://github.com/nicoespeon/'>code</a> et je <a href='http://twitter.com/nicoespeon'>tweet</a> pas mal aussi.</p><p>J’ai tendance à <a href='https://medium.com/@nicoespeon'>écrire sur Medium</a> désormais, si vous souhaitez suivre mes articles ;-)</p></aside><!-- RSS --><aside><p class="text--center"><a href="http://www.nicoespeon.com/feed.xml"><i class="icon-connection"></i>&nbsp;Restez connectés</a></p></aside><!-- Tweets --><aside class="text--center visuallyhidden--portable"><a class="twitter-timeline" href="https://twitter.com/nicoespeon" data-widget-id="320422386929377280">Tweets de @nicoespeon</a></aside><aside class="visuallyhidden--portable push--top"><h2 class="text--center">Copains</h2><a href="http://iceranking.com">IceRanking.com</a> - (SEO) Cédric Brun, Consultant en Référencement Durable</aside></div></div></div><!-- /container --></div><!-- /main-content --><footer role="contentinfo"><div class="container"><p>&copy; 2017 - <a href="https://twitter.com/nicoespeon">Nicolas (Espeon) Carlo</a><br>Ce site est construit grâce à <a href='https://github.com/mojombo/jekyll'>Jekyll</a> et à <a href='http://inuitcss.com/'>inuit.css</a> de l'excellent <a href='https://twitter.com/csswizardry'>@csswizardry</a>. Le code source est <a href='https://github.com/nicoespeon/nicoespeon.github.io'>hébergé sur GitHub</a>.</p></div></footer><!-- jQuery --><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script>$( function () {/*** This JS code is still small so its better to keep it inline.** Only apply if we are beyond the desk CSS breakpoint on load*/if ( $( window ).width() >= 1024 ) {var $timeline = $( "ul#timeline" );/*** Then hide every label description of the timeline*/$timeline.find( "a.timeline__label" ).each( function () {$( this ).find( "p" ).hide();} );/*** And delegate the visibility effect on hover for each label description*/$timeline.on( "mouseenter mouseleave", "a.timeline__label", function () {$( this ).find( "p" ).stop().toggle( "slow" );} );}/*** Append anchor to page subtitles with IDs (used for blog posts).*/$( "h2[id], h3[id]" ).each( function () {var $title = $( this );var $anchor = $( "<a href='#" + $title.attr( "id" ) + "' class='anchor'><i class='icon-link'></i></a>" );$title.append( $anchor );} );} );</script><!-- Twitter API --><script>!function ( d, s, id ) {var js, fjs = d.getElementsByTagName( s )[0];if ( !d.getElementById( id ) ) {js = d.createElement( s );js.id = id;js.src = "//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore( js, fjs );}}( document, "script", "twitter-wjs" );</script><!-- Google Analytics --><script>var _gaq = _gaq || [];_gaq.push( ['_setAccount', 'UA-39957541-2'] );_gaq.push( ['_setDomainName', 'nicoespeon.com'] );_gaq.push( ['_trackPageview'] );(function () {var ga = document.createElement( 'script' );ga.type = 'text/javascript';ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName( 'script' )[0];s.parentNode.insertBefore( ga, s );})();</script><!-- Disqus --><script>var disqus_shortname = 'nicoespeon';var disqus_url = 'http://nicoespeon.com/fr/2013/05/jquery-data-et-performance/';var title = "jQuery, data et performance";(function () {var dsq = document.createElement( 'script' );dsq.type = 'text/javascript';dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName( 'head' )[0] || document.getElementsByTagName( 'body' )[0]).appendChild( dsq );})();</script><noscript>Please enable JavaScript to view the <ahref="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></body></html>