<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, minimum-scale=1.0"><meta name="description" content="A story of immediately-invoked function expression (IIFE)... Know them, it could save your life!"><meta property="og:site_name" content="@nicoespeon's blog" /><meta property="og:url" content="http://www.nicoespeon.com/en/2013/05/properly-isolate-variables-in-javascript/" /><meta property="og:type" content="article" /><meta property="og:title" content="Properly isolate your variables in JavaScript | @nicoespeon" /><meta property="og:description" content="A story of immediately-invoked function expression (IIFE)... Know them, it could save your life!" /><meta property="og:image" content="https://fr.gravatar.com/userimage/27601663/eb6a327f57a4931bfdf6c213af65ed2d.jpg?size=300" /><title>Properly isolate your variables in JavaScript | @nicoespeon</title><link rel="icon" href="/assets/img/icon.png"><link rel="author" href="https://plus.google.com/u/0/108378377887967941980"><!-- DNS prefetch for external resources --><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//platform.twitter.com"><link rel="dns-prefetch" href="//p.twitter.com"><link rel="dns-prefetch" href="//cdn.api.twitter.com"><link rel="dns-prefetch" href="//google-analytics.com"><link rel="stylesheet"href='http://fonts.googleapis.com/css?family=Snippet|Roboto:300,100,700'><link rel="stylesheet" href="/assets/css/nicoespeon.css" media="screen"><link rel="stylesheet" href="/assets/css/nicoespeon-print.css" media="print"></head><body><div id="site"><div class="container"><div class="grid"><div class="grid__item seven-tenths portable-one-whole" role="main"><header class="media" role="banner"><!-- Brand logo --><img src="http://www.gravatar.com/avatar/46978c87c5c75cea5d05a61fa8b7d95b" class="media__img img--circle" alt="My avatar" width="80" height="80"/><!-- Main navigation --><nav class="media__body" role="navigation"><ul class="nav nav--main"><li><a href="/index.html">Home</a></li><li><a href="/about.html">About</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/worth-reading.html">Worth Reading</a></li></ul></nav><!-- /navigation --></header><!-- /header --><article role="main"><h1>Properly isolate your variables in JavaScript</h1><div class="media"><div class="media__img"><a href="https://twitter.com/share" class="twitter-share-button" data-text="Properly isolate your variables in JavaScript |" data-via="nicoespeon">Tweeter</a></div><div class="media__body brand-face zeta">(19 May, 2013)</div></div><p class="islet">A story of immediately-invoked function expression (IIFE)... Know them, it could save your life!</p><h2 id="tldr">TL;DR</h2><p>If you don’t care about variable scoping in JavaScript, you may face some unpleasant troubles. <strong>Properly isolate your script environment</strong> is a best practice to have so you don’t override global variables when it executes.</p><p><strong>Immediately-invoked function expressions</strong> (IIFE) allow you do to that:</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// your JS code</span>
<span class="p">})();</span>
</code></pre></div><p>Moreover, it makes your code flexible and robust so you can create global variables aliases as parameters for your script:</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// your JS code</span>
<span class="p">})(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">jQuery</span><span class="p">);</span>
</code></pre></div><h2 id="its-all-about-scope">It’s all about scope</h2><p>I bet you wouldn’t like your new script not to behave as you want because the <code>gobgob</code> variable you use is already declared somewhere else and you didn’t pay attention for that.</p><p>I would even be worse if your splendid slideshow plugin starts going wrong when your new script is executing. Why? Because you didn’t notice that this plugin use the same variable you do and that you just change its value - if so, it wouldn’t be such a splendid plugin by the way.</p><p>To avoid that kind of scenario, you have to <strong>isolate your script</strong> from the rest of the environment, so it’s still safe. It’s dead easy to do and, if your slideshow plugin were a good one, that’s what it should have done!</p><h4 id="few-reminder-about-scope-in-js">Few reminder about scope in JS</h4><p>If you declare properly a variable, it would be accessible from the whole script which is <em>inside</em> it’s container.</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Hey!&quot;</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">myFonction</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Outputs &quot;Hey!&quot;</span>
<span class="nx">myFonction</span><span class="p">();</span>
</code></pre></div><p>On the contrary, a variable properly declared into a function is not accesible from the outside of this function: the scope is limited to the function.</p><p>However, if you forget to use the <code>var</code> keyword when you declare your variable, you’ll make it <strong>global</strong> which means it would be accessible from anywhere - which is generally not a best practice.</p><div class="highlight"><pre><code class="javascript"><span class="kd">function</span> <span class="nx">myFonction</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Hey!&quot;</span><span class="p">;</span>
    <span class="nx">gubgub</span> <span class="o">=</span> <span class="s2">&quot;Ho!&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">myFonction</span><span class="p">();</span>

<span class="c1">// Outputs &quot;ReferenceError: gobgob is not defined&quot;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span><span class="p">);</span>

<span class="c1">// Outputs &quot;Ho!&quot;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gubgub</span><span class="p">);</span>
</code></pre></div><p>We don’t want our script variables override any other variables which would eventually exists!</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Hey!&quot;</span><span class="p">;</span>

<span class="c1">// (...)</span>
<span class="c1">// Somewhere else far far away in your JavaScript...</span>
<span class="c1">// ... a wild override of an existing (and forgetted) variable appears!</span>
<span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Ho!&quot;</span><span class="p">;</span>
</code></pre></div><h2 id="dont-forget-the-love-glove">Don’t forget the love glove!</h2><p>To resolve our problem, we just need to <strong>isolate variables</strong> so we limit their scope to the code we decided to.</p><p>To do so, we wrap our JavaScript code into what we called an IIFE - or a <strong>self-executing anonymous function</strong> apparently - :</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// your JS code</span>
<span class="p">})();</span>
</code></pre></div><p>This code encapsulation is:</p><ul><li><strong>anonymous</strong> because you don’t name the function</li><li><strong>self-executing</strong> or immediately-invoked thanks to the final little <code>();</code></li></ul><p>Going back to our previous example:</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Hey!&quot;</span><span class="p">;</span>

<span class="c1">// We wrap our script properly</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Ho!&quot;</span><span class="p">;</span>

    <span class="c1">// Outputs &quot;Ho!&quot;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span><span class="p">);</span>
<span class="p">})();</span>

<span class="c1">// Outputs &quot;Hey!&quot; -&gt; bingo !</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span><span class="p">);</span>
</code></pre></div><p>Nothing is changed for script execution.</p><p>But <strong>we don’t have to worry about other variables</strong> which could exist because we now work into a safe environment: we won’t modify a global variable inadvertently!</p><p>However, we can still use global variables inside our code:</p><div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Hey!&quot;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Outputs &quot;Hey!&quot;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre></div><h4 id="rename-global-variables-in-our-script">Rename global variables in our script</h4><p>It’s even possible to <strong>pass variables as parameters</strong> for your script. You can generally redefine them for your script usage, which is good if you’re working with some library such as <em>jQuery</em>.</p><p>Imagine you’d like to create a tiny nice script using <em>jQuery</em>. You’d probably use <code>$</code> everywhere.</p><p>What if I told you we’re now using another library which also uses <code>$</code> as an alias? You’d probably pass <em>jQuery</em> <a href="http://api.jquery.com/jQuery.noConflict/">in <code>noConflict()</code> mode</a>… and you’ll have to change your script to replace <code>$</code> with <code>jQuery</code>.</p><p>Or you’d have listen to me and these two lines of code would have properly isolate your script which would execute, regardless of your environment:</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// your JS script with a bunch of $</span>
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>
</code></pre></div><p>The good part of this technique is that you could quickly switch library without changing anything in your script, which is more flexible and stable:</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// your JS script with a bunch of $</span>
<span class="p">})(</span><span class="nx">Zepto</span><span class="p">);</span>
</code></pre></div><p class="islet"><strong>Performance note</strong> - When you minify your script, it'd minify your variables' name without ruining your code, so it would make it even smaller as a result.</p><div class="highlight"><pre><code class="javascript"><span class="c1">// Example with minification for `window`</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="nb">window</span><span class="p">);</span> <span class="c1">// Outputs `true`</span>
<span class="p">})(</span><span class="nb">window</span><span class="p">);</span>
</code></pre></div><h4 id="tip-1-create-an-alias-for-undefined">Tip 1: Create an alias for <code>undefined</code></h4><p>One of JS best practice that <a href="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.js"><em>jQuery</em> uses in its source code</a> is to declare a last parameter which is not defined and would be equal to <code>undefined</code> in your script:</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Create a gobgob variable which value is `undefined`</span>
    <span class="kd">var</span> <span class="nx">gobgob</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">);</span>  <span class="c1">// Outputs `true`</span>

    <span class="c1">// Our last variable is an alias for `undefined`</span>
<span class="p">})(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">jQuery</span><span class="p">);</span>
</code></pre></div><h4 id="tip-2-still-access-to-variables-from-the-outside">Tip 2: Still access to variables, from the outside</h4><p><em>Thanks <a href="https://twitter.com/fabien0102">@fabien0102</a> for pointing this was missing.</em></p><p>Isolate your code is good. But you’d sometimes need to develop a plugin/a library and you’d like to access the main object from the outside, so you can use it.</p><p>There are a bunch of possibilities but here is, IMHO, the simplest one: you just need to attach your variable to <code>window</code> so it becomes global for the other scripts.</p><div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Create a gobgob variable and attach it to window</span>
    <span class="kd">var</span> <span class="nx">gobgob</span> <span class="o">=</span> <span class="s2">&quot;Hey!&quot;</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">gobgob</span> <span class="o">=</span> <span class="nx">gobgob</span><span class="p">;</span>
<span class="p">})(</span><span class="nb">window</span><span class="p">);</span>

<span class="c1">// Outputs &quot;Hey!&quot;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gobgob</span><span class="p">);</span>
</code></pre></div><h2 id="final-words">Final words</h2><p>This post is not a really new one and you can find a bunch of that kind all over the web. But it’s still a few reminder to start thinking about modular scripts which are components for bigger projects.</p><p>Finally, the most we speak about that, the most developers are likely to use this best practice.</p><p>As usual don’t hesitate to leave me comments, suggestions or even questions if you need to.</p><p>Plop!</p><div id="disqus_thread" role="complementary"></div></article></div><div class="grid__item three-tenths portable-one-whole"role="complementary"><!-- Lang navigation --><nav role="navigation"><ul class="nav nav--stacked text--center"><li class="current" ><a href="/">English version</a></li><li ><a href="/fr/">Version française</a></li></ul></nav><!-- About --><aside class="text--justify"><p>My name is <span class='brand-face'>Nicolas</span> and I'm a french Consultant at <a href='http://www.octo.com/'>OCTO Technology</a>.</p><p>I <a href='/archive'>write</a> posts about web development and project management. I got <a href='http://www.linkedin.com/profile/view?id=143126897'>LinkedIn</a>, I <a href='https://github.com/nicoespeon/'>code</a> and I <a href='http://twitter.com/nicoespeon'>tweet</a> too.</p><p>I tend to <a href='https://medium.com/@nicoespeon'>post on Medium</a> now, in case you want to keep updated ;-)</p></aside><!-- RSS --><aside><p class="text--center"><a href="http://www.nicoespeon.com/feed.xml"><i class="icon-connection"></i>&nbsp;Stay tuned</a></p></aside><!-- Tweets --><aside class="text--center visuallyhidden--portable"><a class="twitter-timeline" href="https://twitter.com/nicoespeon" data-widget-id="320422386929377280">Tweets de @nicoespeon</a></aside><aside class="visuallyhidden--portable push--top"><h2 class="text--center">Friends</h2><a href="http://iceranking.com">IceRanking.com</a> - (SEO) Cédric Brun, Consultant en Référencement Durable</aside></div></div></div><!-- /container --></div><!-- /main-content --><footer role="contentinfo"><div class="container"><p>&copy; 2017 - <a href="https://twitter.com/nicoespeon">Nicolas (Espeon) Carlo</a><br>The website is built upon <a href='https://github.com/mojombo/jekyll'>Jekyll</a> and <a href='http://inuitcss.com/'>inuit.css</a> from the excellent <a href='https://twitter.com/csswizardry'>@csswizardry</a>. Source code is <a href='https://github.com/nicoespeon/nicoespeon.github.io'>hosted on GitHub</a>.</p></div></footer><!-- jQuery --><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script>$( function () {/*** This JS code is still small so its better to keep it inline.** Only apply if we are beyond the desk CSS breakpoint on load*/if ( $( window ).width() >= 1024 ) {var $timeline = $( "ul#timeline" );/*** Then hide every label description of the timeline*/$timeline.find( "a.timeline__label" ).each( function () {$( this ).find( "p" ).hide();} );/*** And delegate the visibility effect on hover for each label description*/$timeline.on( "mouseenter mouseleave", "a.timeline__label", function () {$( this ).find( "p" ).stop().toggle( "slow" );} );}/*** Append anchor to page subtitles with IDs (used for blog posts).*/$( "h2[id], h3[id]" ).each( function () {var $title = $( this );var $anchor = $( "<a href='#" + $title.attr( "id" ) + "' class='anchor'><i class='icon-link'></i></a>" );$title.append( $anchor );} );} );</script><!-- Twitter API --><script>!function ( d, s, id ) {var js, fjs = d.getElementsByTagName( s )[0];if ( !d.getElementById( id ) ) {js = d.createElement( s );js.id = id;js.src = "//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore( js, fjs );}}( document, "script", "twitter-wjs" );</script><!-- Google Analytics --><script>var _gaq = _gaq || [];_gaq.push( ['_setAccount', 'UA-39957541-2'] );_gaq.push( ['_setDomainName', 'nicoespeon.com'] );_gaq.push( ['_trackPageview'] );(function () {var ga = document.createElement( 'script' );ga.type = 'text/javascript';ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName( 'script' )[0];s.parentNode.insertBefore( ga, s );})();</script><!-- Disqus --><script>var disqus_shortname = 'nicoespeon';var disqus_url = 'http://nicoespeon.com/en/2013/05/properly-isolate-variables-in-javascript/';var title = "Properly isolate your variables in JavaScript";(function () {var dsq = document.createElement( 'script' );dsq.type = 'text/javascript';dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName( 'head' )[0] || document.getElementsByTagName( 'body' )[0]).appendChild( dsq );})();</script><noscript>Please enable JavaScript to view the <ahref="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></body></html>