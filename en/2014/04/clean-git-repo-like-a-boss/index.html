<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/component---src-templates-post-template-jsx.8973a9913c53eab5adc6.css">html{--hue:210;--accent-hue:330;--background-color:hsl(var(--hue),0%,100%);--separator-bg-color:hsl(var(--hue),0%,90%);--box-light-bg-color:hsl(var(--hue),0%,92%);--box-light-bg-hover-color:hsl(var(--hue),0%,87%);--text-color:hsl(var(--hue),0%,13%);--text-secondary-color:hsl(var(--hue),0%,33%);--subtitle-color:hsl(var(--hue),0%,53%);--focus-color:hsl(var(--hue),100%,57%);--link-color:hsl(var(--hue),100%,57%);--link-secondary-color:hsl(var(--accent-hue),100%,74%);--highlight-border-color:hsl(var(--accent-hue),100%,74%);--highlight-bg-color:hsl(var(--accent-hue),100%,94%);--code-bg-color:#f5f2f0;--code-text-color:#212121;--code-shadow-color:#fff;--code-selection-color:#b6d9fc;--code-punctuation-color:#999;--code-property-color:#8f0505;--code-selector-color:#4d9900;--code-operator-color:#a65959;--code-operator-bg-color:#f7f7f7;--code-keyword-color:#0054a8;--code-function-color:#dd4b94;--code-variable-color:#f07800}html[data-theme=dark]{--background-color:hsl(var(--hue),0%,8%);--separator-bg-color:hsl(var(--hue),0%,25%);--box-light-bg-color:hsl(var(--hue),0%,20%);--box-light-bg-hover-color:hsl(var(--hue),0%,30%);--text-color:hsl(var(--hue),0%,68%);--text-secondary-color:hsl(var(--hue),0%,55%);--subtitle-color:hsl(var(--hue),0%,40%);--focus-color:hsl(var(--hue),40%,60%);--link-color:hsl(var(--hue),40%,60%);--link-secondary-color:hsl(var(--accent-hue),60%,50%);--highlight-border-color:hsl(var(--accent-hue),100%,34%);--highlight-bg-color:hsl(var(--accent-hue),30%,20%);--code-bg-color:#2a2622;--code-text-color:#d4d4d4;--code-shadow-color:#1a1a1a;--code-selection-color:#064789;--code-comment-color:#6f7f90;--code-punctuation-color:grey;--code-property-color:#f96666;--code-selector-color:#9c6;--code-operator-color:#b34d4d;--code-operator-bg-color:#333;--code-keyword-color:#71a1d0;--code-function-color:#c63980;--code-variable-color:#d97f26}html[data-theme=dark] img{-webkit-filter:brightness(.8);filter:brightness(.8)}
/*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 2.5rem}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 .125rem;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}html{font-size:100;background-color:var(--background-color);color:var(--text-color)}body{line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:Roboto,Helvetica Neue,Helvetica,Arial,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:500}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:auto}hr,img{border:0;display:block}hr{color:var(--text-color);height:26px;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,var(--text-color) 0,var(--text-color) 15px,transparent 0,transparent 26px);width:6.25rem}a{color:var(--link-color);text-decoration:none}a:active,a:focus,a:hover{color:var(--link-secondary-color)}b,strong{font-weight:500}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto;margin-left:0;margin-right:0}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:var(--text-color);font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.layout{max-width:66.875rem;margin-left:auto;margin-right:auto}.layout:after,.layout:before{content:"";display:table}.layout:after{clear:both}.content__inner{padding:1.5625rem 1.25rem}.anchor svg{fill:var(--text-secondary-color)}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}.content{width:calc(58.275% - .78125rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(12n){margin-right:0;float:right}.content:nth-child(12n+1){clear:both}.content__inner{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.content{width:calc(66.6% - .625rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(3n){margin-right:0;float:right}.content:nth-child(3n+1){clear:both}.content__inner{padding:2.5rem 2.1875rem}}code[class*=language-],pre[class*=language-]{color:var(--code-text-color);background:none;text-shadow:0 1px var(--code-shadow-color);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:var(--code-selection-color)}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:var(--code-bg-color)}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:var(--code-comment-color)}.token.punctuation{color:var(--code-punctuation-color)}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:var(--code-property-color)}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:var(--code-selector-color)}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:var(--code-operator-color);background:var(--code-operator-bg-color)}.token.atrule,.token.attr-value,.token.keyword{color:var(--code-keyword-color)}.token.function{color:var(--code-function-color)}.token.important,.token.regex,.token.variable{color:var(--code-variable-color)}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.tags__list-item-link{color:var(--text-color)}.tags__list-item-link:focus,.tags__list-item-link:hover{color:var(--focus-color);border-bottom:1px solid var(--focus-color)}.categories__list-item-link{color:var(--text-color)}.categories__list-item-link:focus,.categories__list-item-link:hover{color:var(--focus-color);border-bottom:1px solid var(--focus-color)}ul.twitter{list-style:none;padding-left:0;margin-bottom:2rem}ul.twitter li{display:inline;margin-right:1rem}.post-single__inner{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.post-single__title{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.post-single__subtitle{font-size:.9rem;max-width:40rem;text-align:center;font-style:italic;margin:.40625rem auto 0}.post-single__body figure{margin-bottom:1.625rem}.post-single__body figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.post-single__body figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.post-single__body a{text-decoration:underline}.post-single__body .gatsby-highlight{max-width:40rem;margin-left:.9375rem;margin-right:.9375rem;margin-bottom:1.625rem}.post-single__body .gatsby-highlight-code-line{background-color:var(--highlight-bg-color);display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid var(--highlight-border-color)}.post-single__body{max-width:40rem;margin-left:auto;margin-right:auto}.post-single__footer{max-width:40rem;line-height:1.625rem;margin:1.625rem .9375rem 3.25rem}.post-single__footer-text a{text-decoration:underline}.post-single__meta{max-width:40rem;margin-left:auto;margin-right:auto;display:flex}.post-single__date{flex-grow:1;font-style:italic}.post-single__comments{flex-grow:1;text-align:right}.post-single__tags{margin-bottom:.8125rem}.post-single__tags-list{list-style:none;margin:0 -.3125rem;padding:0}.post-single__tags-list-item{display:inline-block;margin:.625rem .3125rem}.post-single__tags-list-item-link{background:var(--box-light-bg-color);text-decoration:none;border:0;border-radius:.1875rem;color:var(--text-secondary-color);line-height:1.625;padding:.5rem 1rem}.post-single__tags-list-item-link:focus,.post-single__tags-list-item-link:hover{color:var(--text-color);background:var(--box-light-bg-hover-color);border:0}.post-single__button-container{text-align:center}.post-single__button{display:inline-block;margin-right:1rem;font-size:1rem;padding:0 1rem;height:35px;line-height:2.1875rem;text-align:center;color:var(--text-secondary-color);background:var(--box-light-bg-color);font-weight:400;border-radius:.1875rem;margin-top:1.625rem}.post-single__button:focus,.post-single__button:hover{cursor:pointer;color:var(--text-color);background:var(--box-light-bg-hover-color);border:0}.post-single__button:last-child{margin-right:0}@media screen and (min-width:685px){.post-single__body .gatsby-highlight,.post-single__footer{margin-left:auto;margin-right:auto}}@media screen and (min-width:960px){.post-single__inner{padding:0}.post-single__title{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem}.post-single__subtitle{font-size:1rem;margin-bottom:2.4375rem}.post-single__body,.post-single__body p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}.post-single__button{position:fixed;margin:0;left:20px}.post-single__button--home{top:30px}.post-single__button--theme{top:81px}}</style><meta name="generator" content="Gatsby 2.0.22"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,700" rel="stylesheet"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">Clean your git repo, like a boss</title><meta data-react-helmet="true" name="description" content="How to properly rebase your repo, removing what should never have been in there without broking your history."/><link rel="shortcut icon" href="/icons-ad72c5f34acd111a2daec190afc34979/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/icons-ad72c5f34acd111a2daec190afc34979/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/icons-ad72c5f34acd111a2daec190afc34979/favicon-32x32.png"/><link rel="manifest" href="/icons-ad72c5f34acd111a2daec190afc34979/manifest.json"/><meta name="mobile-web-app-capable" content="yes"/><meta name="theme-color" content="#fff"/><meta name="application-name" content="nicoespeon.github.io"/><link rel="apple-touch-icon" sizes="57x57" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-152x152.png"/><link rel="apple-touch-icon" sizes="167x167" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-167x167.png"/><link rel="apple-touch-icon" sizes="180x180" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-180x180.png"/><link rel="apple-touch-icon" sizes="1024x1024" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-1024x1024.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/><meta name="apple-mobile-web-app-title" content="nicoespeon.github.io"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-320x460.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-640x920.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-640x1096.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-750x1294.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-1182x2208.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-1242x2148.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-748x1024.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-768x1004.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-1496x2048.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-1536x2008.png"/><link as="script" rel="preload" href="/component---src-templates-post-template-jsx-fe37b511731a90ee6c68.js"/><link as="script" rel="preload" href="/app-a28781cee54de6f2bd9c.js"/><link as="script" rel="preload" href="/2-9d62d26dd2cdaa76a942.js"/><link as="script" rel="preload" href="/0-1fc3bea78341134a4e47.js"/><link as="script" rel="preload" href="/webpack-runtime-b29c5a8cde5df9f9593e.js"/><link rel="preload" href="/static/d/624/path---en-2014-04-clean-git-repo-like-a-boss-e-6-a-8d9-KxB1ySLXxp3PQSPaz7LKm4J17g.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="layout"><div><div><div class="post-single__button-container"><a class="post-single__button post-single__button--home" href="/">← Articles</a><div class="post-single__button post-single__button--theme" role="button" tabindex="0">Dark<!-- --> theme</div></div><div class="post-single"><div class="post-single__inner"><h1 class="post-single__title">Clean your git repo, like a boss</h1><p class="post-single__subtitle">☕ 4 min read</p><div class="post-single__body"><h2 id="the-context"><a href="#the-context" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The context</h2>
<p>The life of a git repo could last and change a lot. Conventions often move with our knowledge and mastering of that stuff.</p>
<p>And there comes the day where you look at your project and realize that it wasn’t such a good idea to commit those <em>external libraries / compiled outputs / videos and other media / &#x3C;your error here></em>.</p>
<p>I personally did a bunch of mistakes with git:</p>
<ul>
<li>one day I realized a bit late that if you commit a lot of audio files in your project, then you’ll make it grow insanely. 5 minutes to perform a simple <code class="language-text">git clone</code> is waaaaaay toooo looooooong.</li>
<li>few time ago, I even managed to commit the whole <code class="language-text">vendor/</code> folder of a project by mistake. It didn’t play well with the nice GitHub stats of the project. That’s a tough job to follow the activity of the team when there is a 20.000 updates peak on the very first week.</li>
</ul>
<p>And then you realize that:</p>
<ul>
<li>it’s pointless to revert the faulty commit(s), it won’t remove the indexed modifications from the history</li>
<li>the project may not be young, it’d be sad to rebase and re-write every commits from the last 3 months and loose information such as the author / the date</li>
<li>and even sometimes you’ll have your faulty files committed with other fixes and killer-features</li>
</ul>
<p>Need another use case? Just think about Bernard who committed confidential information in a environment config file which should never have been versioned -have you heard about a guy called Murphy?.</p>
<p>Now you can figure out that situation when you open the Internet, searching for the magic git command. Here you go, this is precisely what’s this post about -at least, the magic command I know.</p>
<h2 id="magic-happens-here"><a href="#magic-happens-here" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Magic happens here</h2>
<p>Let’s say I would like to <strong>remove every MP3 files committed by mistake</strong> from a whole project. Plus, <strong>I don’t want to change the author of each commit, neither the date</strong> - but still I want to remove all trace from those files in the history to reduce the size of my repo.</p>
<p>To do so, I mystically wave my hand in the air and write the following incantation with the other:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">git filter-branch -f --tree-filter &quot;rm -rf \*.mp3&quot; --prune-empty -- --all</code></pre></div>
<p>Which would transform this history:</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/dirty-repo-9bc37cbec88d16d9268d1ef41cee0eca-f7e1d.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 86.06965174129354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACfUlEQVQ4y2VUXU/UQBTt/3/20V9gfFACApKQgEGJuyCaiLsua8AXcD/bbmem03bmeD/a3aJNTu7HTG/PnXumyWA4w2rlwI+xQGEIBZBvAOc0tlbRX2c/NFHei2rkSY7ffMCfx4UEddmgthVqVwuacmc7dOuNb9pCkWzcFk3GL18ge/ilUUG0llQ8TxWbDEjXZHMgozgjf7Wk3Irom5Zd3FJkP9nfG2I+yyRRlhGuhIBbstRy6Z/Dec3zcXi/azW2RZPzszFubm6FelVFKhqkcAfOebLeK/5di72WhaGldg4/7mEw+aSDaTYoo4GLBYFsMPDRwYZC8mW0kjchF7hgO45acLVY4+rHZ1yPB5J2tUUVPHwot+C4g29KlI0TP0QeTJAzjC2S9TLF5egSV9OhzoWYEAdi4UCvwjIjspQR3wi4gxJxy60nmwW1PNk/xMPRiWbmNMUVT5QmnhdqGWmuMdusFeo6RVzQfkJMM8QmIFlmOUbnZ5heXEi9wAukXgGpOdK4//M3hVoec10jVpVYbj1Z5EvcvT/G79NT1dNirrpLWYebnQbl+mTqr1diuVBsW+6QvH51jen9HKaiA6cPFe0VM041J3osVXemvYq8x/U02H+Syc9HfB/d4u5+LAnraRT0ZV9XKGtPvldbtzmO2/UqdPCoY61TdkWGk8EBhtNL1WHIRIOsORs3W3DOiwY7PapWec0E0i7pMZCEkr23X/Dt60TZmYiCjszQcTnbglr0fAXJLx3vUctr7Bs6Zkv7q/YIkncHV5jNUgnkmvkduphtH/1cTb+whhCCjiU5Ohzh6Ul/Ds5FGGJpbZSvc6w59W3LSv6Hhgk8HwiL5C+RuiU02PAD0AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Dirty git repository"
        title=""
        src="/static/dirty-repo-9bc37cbec88d16d9268d1ef41cee0eca-c83f1.png"
        srcset="/static/dirty-repo-9bc37cbec88d16d9268d1ef41cee0eca-569e3.png 240w,
/static/dirty-repo-9bc37cbec88d16d9268d1ef41cee0eca-93400.png 480w,
/static/dirty-repo-9bc37cbec88d16d9268d1ef41cee0eca-c83f1.png 960w,
/static/dirty-repo-9bc37cbec88d16d9268d1ef41cee0eca-f7e1d.png 1206w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>Into this clean and shiny one:</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/clean-repo-01ac1cdb9ead771b8a6e8c336e5f821b-c2c2d.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 69.04376012965965%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7UlEQVQ4y21U227TQBD1//8JvMEDRPQFJIQSpWpLoQ2NWqEAIiENaRLvzd71DHPZtdMWSycznt2dnDM74+p0usL7e4P8eAdoDaChV0bwiNZyXMG+c/hoHUCO9rYavT3D5XIrL00D6D1gCIPl2LEt4HWOpcSZQBIC/VSvX33G2/lSEjpi6JgFwRq1zILZFduzzeuxLQyVYrVZ/8XRxzc4X81UdmewAYcBrID9Fjz5LscHeDC032LbNX3Sarfd4+lsgpOrT8oyUpIuHKGhA23vMwL5Ci/JEqQh4cPmAaffxji9GUvQxFo2+s5lS0yz78jnuE01umSIedZ79FSH3QGn12OcXCtDG40cLmwK09Bb/98YI9IfVD8Xv/Dy7gKvFpcqOWVGVLcmQ5KQbSHkWoYcd8KYz5RaVi9fnOHibou+pgDV1tV0MXyD3GdusN6qz2vmQEpoXxvwueTt5oAX83ORLQxbYpeajICeEAQkP7VHawq9JC1DhIjV6vcST8YjvF3fSINywbVlnMhwnbYGg2XKJZW2yXHX1bKvhYYb+wvOvv5QdhZECqPI9Lm5C0qzOzs0eL3XcqRIkk/eneOf9e7Z6D0dt6ejx1PFNkbAjvqv60D78MP77zTLe01YNvKYMaOgKL7PLH35aJBN6fGl/AOJVz3TV6aILwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Clean git repository"
        title=""
        src="/static/clean-repo-01ac1cdb9ead771b8a6e8c336e5f821b-c83f1.png"
        srcset="/static/clean-repo-01ac1cdb9ead771b8a6e8c336e5f821b-569e3.png 240w,
/static/clean-repo-01ac1cdb9ead771b8a6e8c336e5f821b-93400.png 480w,
/static/clean-repo-01ac1cdb9ead771b8a6e8c336e5f821b-c83f1.png 960w,
/static/clean-repo-01ac1cdb9ead771b8a6e8c336e5f821b-c2c2d.png 1234w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>Dates and authors are still there, which wouldn’t have been true with a classic rebase. Still, the history <strong>has been rewritten</strong>: SHA1 of commits which have been rewritten are different.</p>
<h2 id="its-a-kind-of-magic"><a href="#its-a-kind-of-magic" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>It’s a kind of magic</h2>
<p>Let’s see what is this looooong mystical command about.</p>
<h3 id="git-filter-branch"><a href="#git-filter-branch" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">git filter-branch</code></h3>
<p>The <code class="language-text">filter-branch</code> command will rewrite a large number of commit in a scriptable way. In other words, it will rewrite the history regarding the options you give.</p>
<h3 id="-f"><a href="#-f" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">-f</code></h3>
<p>The <code class="language-text">-f</code> option forces <code class="language-text">git filter-branch</code> to start even if there is an existing temporary <code class="language-text">refs/original/</code> directory already. Git will use this directory to perform some backup before going further.</p>
<p>It’s not mandatory then, but if the backup can’t be created, git will tell you to use it anyway.</p>
<h3 id="--tree-filter-shell-command"><a href="#--tree-filter-shell-command" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">--tree-filter &quot;&lt;shell command&gt;&quot;</code></h3>
<p>This option will check every commit of your tree and execute the given shell command.</p>
<p>I previously used <code class="language-text">rm -rf *.mp3</code> to ensure there will not be any MP3 file surviving this operation. In this case, I needed to ensure the command is forced -this is for the <code class="language-text">-rf</code> part- so the cleaning won’t stop if there is an error because of <em>no-mp3-file-in-this-commit</em> reason.</p>
<p><strong>Note</strong> - In case you don’t want to actually delete these files but just remove them from the git history, prefer to perform a <code>—index-filter “git rm -rf —cached —ignore-unmatch *.mp3”</code> instead.</p>
<h3 id="--prune-empty"><a href="#--prune-empty" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">--prune-empty</code></h3>
<p>We prune any commit that would eventually be empty after we cleaned the history.</p>
<h3 id="-----all"><a href="#-----all" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">-- --all</code></h3>
<p>The first <code class="language-text">--</code> will ensure we don’t consider <code class="language-text">--all</code> as a parameter for <code class="language-text">--prune-empty</code>, but as another option. And so git will consider every branches of the history to perform the cleaning here.</p>
<h2 id="final-words"><a href="#final-words" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Final words</h2>
<p>If you’re many to work on the project, please remember that <strong>rewrite the history is not a genuine action</strong>, whatever the method you use. Then, if you really need to do that kind of manipulation, it will be easier for you colleagues to simply clone the new shiny repo.</p>
<p>If you fear that your manipulation won’t work as expected, just clone the repo somewhere else before doing your stuff. So you’d be able to get it back in case something is going wrong.</p>
<p><strong>Note</strong> - A good idea is to perform that kind of operations in another branch. If you’re satisfied with the result, just reset hard the <code class="language-text">master</code> branch onto this one and you’re all set.</p>
<p>Here you go. I hope that could help you… but that you won’t need to use it too often!</p></div><div class="post-single__meta"><span class="post-single__date">Published 23 Apr 2014</span><span class="post-single__comments"><a href="https://mobile.twitter.com/search?q=undefined" target="_blank" rel="noopener noreferrer"><span role="img" aria-label="Speech balloon">💬</span> <!-- -->Discuss this article on Twitter</a></span></div></div><div class="post-single__footer"><hr/><div class="post-single__tags"><ul class="post-single__tags-list"><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/tags/git/">git</a></li></ul></div><div class="post-single__footer-text">I write about web development, agile practices and personal organization.<ul class="twitter"><li><a class="twitter-share-button" href="https://twitter.com/intent/tweet?via=nicoespeon" data-size="large">Tweet</a></li><li><a class="twitter-follow-button" href="https://twitter.com/nicoespeon" data-show-count="false" data-size="large">Follow @nicoespeon</a></li></ul></div></div></div></div></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-39957541-2', 'auto', {});
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-post-template-jsx","jsonName":"en-2014-04-clean-git-repo-like-a-boss-e6a","path":"/en/2014/04/clean-git-repo-like-a-boss/"};window.dataPath="624/path---en-2014-04-clean-git-repo-like-a-boss-e-6-a-8d9-KxB1ySLXxp3PQSPaz7LKm4J17g";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-a28781cee54de6f2bd9c.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-5f2b74aaa9780afd7bf0.js"],"component---src-templates-page-template-jsx":["/component---src-templates-page-template-jsx.20eefe64b5c91dc9fdf9.css","/component---src-templates-page-template-jsx-58ac45933bb0bf6d3254.js"],"component---src-templates-post-template-jsx":["/component---src-templates-post-template-jsx.8973a9913c53eab5adc6.css","/component---src-templates-post-template-jsx-fe37b511731a90ee6c68.js"],"component---src-templates-tag-template-jsx":["/component---src-templates-tag-template-jsx.34b8bc1aa60cfb20f0d8.css","/component---src-templates-tag-template-jsx-4d1353b0eb21b1b39ec1.js"],"component---src-templates-category-template-jsx":["/component---src-templates-category-template-jsx.34b8bc1aa60cfb20f0d8.css","/component---src-templates-category-template-jsx-6f2742fbc3298b407e3a.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-7856d8e49ab062d7bb70.js"],"component---src-pages-categories-jsx":["/component---src-pages-categories-jsx-d747233b22c5f74e6799.js"],"component---src-pages-fr-categories-jsx":["/component---src-pages-fr-categories-jsx-af2ca80329593aff3b82.js"],"component---src-pages-fr-index-jsx":["/component---src-pages-fr-index-jsx.34b8bc1aa60cfb20f0d8.css","/component---src-pages-fr-index-jsx-2ef5c52e595de12b8581.js"],"component---src-pages-fr-tags-jsx":["/component---src-pages-fr-tags-jsx-287f1f55c3c9a087eb29.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx.34b8bc1aa60cfb20f0d8.css","/component---src-pages-index-jsx-f009cd138e1df3aeee40.js"],"component---src-pages-tags-jsx":["/component---src-pages-tags-jsx-7714f8a09ce64c52a289.js"]};/*]]>*/</script><script src="/webpack-runtime-b29c5a8cde5df9f9593e.js" async=""></script><script src="/0-1fc3bea78341134a4e47.js" async=""></script><script src="/2-9d62d26dd2cdaa76a942.js" async=""></script><script src="/app-a28781cee54de6f2bd9c.js" async=""></script><script src="/component---src-templates-post-template-jsx-fe37b511731a90ee6c68.js" async=""></script><script>window.twttr = (function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0],
                  t = window.twttr || {};
                if (d.getElementById(id)) return t;
                js = d.createElement(s);
                js.id = id;
                js.src = "https://platform.twitter.com/widgets.js";
                fjs.parentNode.insertBefore(js, fjs);

                t._e = [];
                t.ready = function(f) {
                  t._e.push(f);
                };

                return t;
              }(document, "script", "twitter-wjs"));</script></body></html>