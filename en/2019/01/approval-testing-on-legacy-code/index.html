<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/component---src-templates-post-template-jsx.c98be2ba4ac4b2de096b.css">html{--hue:210;--accent-hue:330;--background-color:hsl(var(--hue),0%,100%);--separator-bg-color:hsl(var(--hue),0%,90%);--box-light-bg-color:hsl(var(--hue),0%,92%);--box-light-bg-hover-color:hsl(var(--hue),0%,87%);--text-color:hsl(var(--hue),0%,13%);--text-secondary-color:hsl(var(--hue),0%,33%);--subtitle-color:hsl(var(--hue),0%,53%);--focus-color:hsl(var(--hue),100%,57%);--link-color:hsl(var(--hue),100%,57%);--link-secondary-color:hsl(var(--accent-hue),100%,70%);--highlight-border-color:hsl(var(--accent-hue),100%,74%);--highlight-link-color:hsl(var(--accent-hue),100%,88%);--highlight-bg-color:hsl(var(--accent-hue),100%,94%);--code-bg-color:#f5f2f0;--code-text-color:#212121;--code-shadow-color:#fff;--code-selection-color:#b6d9fc;--code-punctuation-color:#999;--code-property-color:#8f0505;--code-selector-color:#4d9900;--code-operator-color:#a65959;--code-operator-bg-color:#f7f7f7;--code-keyword-color:#0054a8;--code-function-color:#dd4b94;--code-variable-color:#f07800}html[data-theme=dark]{--background-color:hsl(var(--hue),0%,8%);--separator-bg-color:hsl(var(--hue),0%,25%);--box-light-bg-color:hsl(var(--hue),0%,20%);--box-light-bg-hover-color:hsl(var(--hue),0%,30%);--text-color:hsl(var(--hue),0%,68%);--text-secondary-color:hsl(var(--hue),0%,55%);--subtitle-color:hsl(var(--hue),0%,40%);--focus-color:hsl(var(--hue),40%,60%);--link-color:hsl(var(--hue),40%,60%);--link-secondary-color:hsl(var(--accent-hue),60%,50%);--highlight-border-color:hsl(var(--accent-hue),100%,34%);--highlight-link-color:hsl(var(--accent-hue),100%,30%);--highlight-bg-color:hsl(var(--accent-hue),30%,20%);--code-bg-color:#2a2622;--code-text-color:#d4d4d4;--code-shadow-color:#1a1a1a;--code-selection-color:#064789;--code-comment-color:#6f7f90;--code-punctuation-color:grey;--code-property-color:#f96666;--code-selector-color:#9c6;--code-operator-color:#b34d4d;--code-operator-bg-color:#333;--code-keyword-color:#71a1d0;--code-function-color:#c63980;--code-variable-color:#d97f26}html[data-theme=dark] img{-webkit-filter:brightness(.8);filter:brightness(.8)}
/*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 2.5rem}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 .125rem;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}html{font-size:100;background-color:var(--background-color);color:var(--text-color)}body{border-top:5px solid var(--link-secondary-color);line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:Roboto,Helvetica Neue,Helvetica,Arial,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:500}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:auto}hr,img{border:0;display:block}hr{color:var(--text-color);height:26px;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,var(--text-color) 0,var(--text-color) 15px,transparent 0,transparent 26px);width:6.25rem}a{color:var(--link-color);text-decoration:none;text-underline-position:unset}a:active,a:focus,a:hover{color:var(--link-secondary-color);text-decoration:underline}.link-underlined,.with-links a[href^="/"],.with-links a[href^=mailto],a[href^=http]{color:var(--text-color);font-weight:500;text-decoration:none;background:linear-gradient(180deg,transparent .9em,var(--highlight-link-color) 0,var(--highlight-link-color))}.link-underlined:active,.link-underlined:focus,.link-underlined:hover,.with-links a[href^="/"]:active,.with-links a[href^="/"]:focus,.with-links a[href^="/"]:hover,.with-links a[href^=mailto]:active,.with-links a[href^=mailto]:focus,.with-links a[href^=mailto]:hover,a[href^=http]:active,a[href^=http]:focus,a[href^=http]:hover{color:var(--link-secondary-color);background:none;text-decoration:none}.link-underlined.no-underline,.with-links a[href^="/"].no-underline,.with-links a[href^=mailto].no-underline,a[href^=http].no-underline{background:none}b,strong{font-weight:500}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto;margin-left:0;margin-right:0}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:var(--text-color);font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.layout{max-width:66.875rem;margin-left:auto;margin-right:auto}.layout:after,.layout:before{content:"";display:table}.layout:after{clear:both}.content__inner{padding:1.5625rem 1.25rem}.anchor svg{fill:var(--text-secondary-color)}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}.content{width:calc(58.275% - .78125rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(12n){margin-right:0;float:right}.content:nth-child(12n+1){clear:both}.content__inner{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.content{width:calc(66.6% - .625rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(3n){margin-right:0;float:right}.content:nth-child(3n+1){clear:both}.content__inner{padding:2.5rem 2.1875rem}}code[class*=language-],pre[class*=language-]{color:var(--code-text-color);background:none;text-shadow:0 1px var(--code-shadow-color);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:var(--code-selection-color)}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:var(--code-bg-color)}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:var(--code-comment-color)}.token.punctuation{color:var(--code-punctuation-color)}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:var(--code-property-color)}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:var(--code-selector-color)}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:var(--code-operator-color);background:var(--code-operator-bg-color)}.token.atrule,.token.attr-value,.token.keyword{color:var(--code-keyword-color)}.token.function{color:var(--code-function-color)}.token.important,.token.regex,.token.variable{color:var(--code-variable-color)}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.tags__list-item-link{color:var(--text-color)}.tags__list-item-link:focus,.tags__list-item-link:hover{color:var(--focus-color);border-bottom:1px solid var(--focus-color)}.categories__list-item-link{color:var(--text-color)}.categories__list-item-link:focus,.categories__list-item-link:hover{color:var(--focus-color);border-bottom:1px solid var(--focus-color)}ul.twitter{list-style:none;padding-left:0;margin-bottom:2rem}ul.twitter li{display:inline;margin-right:1rem}.highlighted,.highlighted__text{position:relative}.highlighted__text:before{content:" ";display:block;height:90%;width:100%;position:absolute;top:-1px;left:-1px;background:hsla(var(--accent-hue),100%,75%,.3);-webkit-transform:rotate(4deg);transform:rotate(4deg);border-radius:20% 25% 20% 24%;padding:.3125rem .0625rem .1875rem}.form-inline{display:flex;flex-direction:column}.form-inline__input{padding:.625rem 1.25rem;margin:0 0 .625rem}.form-inline__submit{padding:.9375rem 3.125rem;align-self:center;color:#fff;font-weight:700;background:var(--link-secondary-color);border:none;box-shadow:inset 0 1px 0 hsl(var(--accent-hue),100%,90%),0 1px 3px rgba(0,0,0,.2)}.form-inline__submit:hover{cursor:pointer;background:hsl(var(--accent-hue),100%,75%)}.form-inline__submit:active{background:hsl(var(--accent-hue),90%,60%);border-color:hsl(var(--accent-hue),90%,60%);box-shadow:0 2px 0 hsla(0,0%,100%,.15),inset 0 2px 2px rgba(0,0,0,.1)}@media screen and (min-width:685px){.form-inline{flex-direction:row;flex-wrap:nowrap}.form-inline__input{margin:0 .625rem 0 0}.form-inline__name{width:25%}.form-inline__email{width:45%}.form-inline__submit{width:30%;padding:.9375rem 1.25rem}}.post-single__inner{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.post-single__title{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.post-single__subtitle{font-size:.9rem;max-width:40rem;text-align:center;margin:.40625rem auto 0}.post-single__line-through{display:inline-block;position:relative}.post-single__line-through:after,.post-single__line-through:before{content:"";position:absolute;height:2%;border-bottom:2px solid var(--link-secondary-color);top:49%;-webkit-transform:translateY(-50%);transform:translateY(-50%);width:50%}.post-single__line-through:before{right:100%;margin-right:.9375rem}.post-single__line-through:after{left:100%;margin-left:.9375rem}.post-single__body figure{margin-bottom:1.625rem}.post-single__body figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.post-single__body figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.post-single__body .gatsby-highlight{max-width:40rem;margin-left:.9375rem;margin-right:.9375rem;margin-bottom:1.625rem}.post-single__body .gatsby-highlight-code-line{background-color:var(--highlight-bg-color);display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid var(--highlight-border-color)}.post-single__body{max-width:40rem;margin-left:auto;margin-right:auto}.post-single__footer{max-width:40rem;line-height:1.625rem;margin:1.625rem .9375rem 3.25rem}.post-single__footer-text a{text-decoration:underline}.post-single__meta{max-width:40rem;margin-left:auto;margin-right:auto;display:flex}.post-single__date{flex-grow:1;font-style:italic}.post-single__comments{flex-grow:1;text-align:right}.post-single__tags{margin-bottom:.8125rem}.post-single__tags-list{list-style:none;margin:0 -.3125rem;padding:0}.post-single__tags-list-item{display:inline-block;margin:.625rem .3125rem}.post-single__tags-list-item-link{background:var(--box-light-bg-color);text-decoration:none;border:0;border-radius:.1875rem;color:var(--text-secondary-color);line-height:1.625;padding:.5rem 1rem}.post-single__tags-list-item-link:focus,.post-single__tags-list-item-link:hover{color:var(--text-color);background:var(--box-light-bg-hover-color);border:0}.post-single__button-container{text-align:center}.post-single__button{display:inline-block;margin-right:1rem;font-size:1rem;padding:0 1rem;height:35px;line-height:2.1875rem;text-align:center;color:var(--text-secondary-color);background:var(--box-light-bg-color);font-weight:400;border-radius:.1875rem;margin-top:1.625rem}.post-single__button:focus,.post-single__button:hover{cursor:pointer;color:var(--text-color);background:var(--box-light-bg-hover-color);border:0}.post-single__button:last-child{margin-right:0}@media screen and (min-width:685px){.post-single__body .gatsby-highlight,.post-single__footer{margin-left:auto;margin-right:auto}}@media screen and (min-width:960px){.post-single__inner{padding:0}.post-single__title{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem}.post-single__subtitle{font-size:1rem;margin-bottom:2.4375rem}.post-single__body,.post-single__body p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}.post-single__button{position:fixed;margin:0;left:20px}.post-single__button--home{top:30px}.post-single__button--theme{top:81px}.post-single__line-through:after,.post-single__line-through:before{width:100%}}</style><meta name="generator" content="Gatsby 2.0.22"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,700" rel="stylesheet"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">&quot;I need to change this code, but it has no test&quot; — @nicoespeon&#x27;s blog</title><meta data-react-helmet="true" name="description" content="An introduction to &quot;Approval Testing&quot; in JavaScript with Jest."/><meta data-react-helmet="true" property="og:url" content="https://www.nicoespeon.com/en/2019/01/approval-testing-on-legacy-code/"/><meta data-react-helmet="true" property="og:title" content="&quot;I need to change this code, but it has no test&quot;"/><meta data-react-helmet="true" property="og:description" content="An introduction to &quot;Approval Testing&quot; in JavaScript with Jest."/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@nicoespeon"/><meta data-react-helmet="true" name="twitter:title" content="&quot;I need to change this code, but it has no test&quot;"/><meta data-react-helmet="true" name="twitter:description" content="An introduction to &quot;Approval Testing&quot; in JavaScript with Jest."/><meta data-react-helmet="true" property="og:image" content="https://www.nicoespeon.com/static/photo-396585ecc56bb47ee41d2021a5a1ab08.jpg"/><meta data-react-helmet="true" name="twitter:image" content="https://www.nicoespeon.com/static/photo-396585ecc56bb47ee41d2021a5a1ab08.jpg"/><link rel="shortcut icon" href="/icons-ad72c5f34acd111a2daec190afc34979/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/icons-ad72c5f34acd111a2daec190afc34979/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/icons-ad72c5f34acd111a2daec190afc34979/favicon-32x32.png"/><link rel="manifest" href="/icons-ad72c5f34acd111a2daec190afc34979/manifest.json"/><meta name="mobile-web-app-capable" content="yes"/><meta name="theme-color" content="#fff"/><meta name="application-name" content="nicoespeon.github.io"/><link rel="apple-touch-icon" sizes="57x57" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-152x152.png"/><link rel="apple-touch-icon" sizes="167x167" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-167x167.png"/><link rel="apple-touch-icon" sizes="180x180" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-180x180.png"/><link rel="apple-touch-icon" sizes="1024x1024" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-1024x1024.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/><meta name="apple-mobile-web-app-title" content="nicoespeon.github.io"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-320x460.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-640x920.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-640x1096.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-750x1294.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-1182x2208.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-1242x2148.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-748x1024.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-768x1004.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-1496x2048.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-1536x2008.png"/><link as="script" rel="preload" href="/component---src-templates-post-template-jsx-b0c88465e57e8189bbf9.js"/><link as="script" rel="preload" href="/app-a28781cee54de6f2bd9c.js"/><link as="script" rel="preload" href="/2-91086bbd293eb1ddadc5.js"/><link as="script" rel="preload" href="/0-bd3cfe82c996ec44cdd4.js"/><link as="script" rel="preload" href="/webpack-runtime-bf0ace88c74dbb51fc86.js"/><link rel="preload" href="/static/d/705/path---en-2019-01-approval-testing-on-legacy-code-f-1-a-1c2-TbMnwdERqlr6kgYvIAQGW0BlL0.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="layout"><div><div><div class="post-single__button-container"><a class="post-single__button post-single__button--home" href="/">← Articles</a><div class="post-single__button post-single__button--theme" role="button" tabindex="0">Dark<!-- --> theme</div></div><div class="post-single"><div class="post-single__inner"><h1 class="post-single__title">&quot;I need to change this code, but it has no test&quot;</h1><p class="post-single__subtitle"><span class="post-single__line-through">☕☕☕ 13 min read</span></p><div class="post-single__body"><p>Here’s the deal: you need to change the code to make this awesome new feature work, but that code is not covered by an automated test. How do you know you didn’t break anything when you’re done?</p>
<p>That’s a typical scenario I frequently face.</p>
<p>I see different approaches in such a situation:</p>
<ol>
<li>
<p>🤞 <strong>Cross fingers</strong>, do the change and hope nothing breaks. Manually test different use cases you know. After all, you’re just adding a feature. You know the codebase, more or less. What could go wrong?</p>
</li>
<li>
<p>🤔 <strong>Spend time to understand</strong>, test and refactor the code before changing it. <a href="https://twitter.com/kentbeck/status/250733358307500032">“Make the change easy, then make the easy change”</a>. Sure, it will take some time. You didn’t estimate that task to take that much time actually. That’s unexpected complexity. But, in the end, you will leave codebase in a better state and you’ll be able to go faster.</p>
</li>
<li>
<p>📸 <strong>Take a snapshot of existing code behavior</strong>. Consider it a black box and capture enough of its behavior to feel confident touching it.</p>
</li>
</ol>
<p>I clearly think the first approach is shooting yourself in the foot − except if you know you won’t need to maintain that code. Heck, it seems you’re maintaining this code already, otherwise, you wouldn’t have this question in the first place! If you want to keep moving fast without breaking everything, there is a better, more professional way.</p>
<p>The second approach would be ideal. Working effectively with legacy code requires putting the existing code into a test harness, first. Then, you can refactor. But, it takes skills to write good tests. You should practice these skills though, they will help you with these – so common – scenarios. Now, I hear you: client demo is next week and you need to ship that cool feature before. You need a pragmatic solution to the problem. You’re gonna take this shortcut consciously so you can deliver, then you’ll pay the technical debt back. Now, are you stuck with approach #1 then?</p>
<p>Nope. Approach #3 is more… pragmatic. You have to put your code under test before you touch it anyway. But, who said you need to completely understand current code to do so? What you want is to know if you break existing behavior when you touch the code. This, you can do with <strong>Approval Testing</strong>.</p>
<p>The main idea is:</p>
<ul>
<li>take a snapshot of existing code behavior, in all possible variations</li>
<li>use test coverage to discover parts of the code not covered with the variations</li>
<li>use mutations to ensure you detect any broken behavior</li>
</ul>
<p><strong>You don’t need to understand existing code to do so.</strong> That’s the good news.</p>
<p>There is a pre-requisite though: you need to take a snapshot of your code behavior, meaning that you <strong>should be able to stringify the output of your code</strong>, including side-effects. If your codebase was not designed with tests in mind, you probably need to rely on <a href="https://www.oreilly.com/library/view/working-effectively-with/0131177052/">Michael Feather’s book</a> to help you get started.</p>
<p>Now, let see how you can do that in JavaScript.</p>
<h2 id="approval-testing-in-javascript"><a href="#approval-testing-in-javascript" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Approval Testing in JavaScript</h2>
<p>My personal go-to for JavaScript testing nowadays is <a href="https://jestjs.io/">Jest</a>.</p>
<p>It is simple to set up – almost no configuration needed. It has a wonderful test runner baked in, with a powerful watch mode. Finally, and that’s what you’re looking for, it can take snapshots.</p>
<figure>
  <img src="/jest-runner-88925241a8fcb472f4d8cc8479a7174f.gif" alt="Jest runner in action">
  <figcaption>Jest runner in action &#x2013; damn it&apos;s so cool!</figcaption>
</figure>
<p>Snapshots are powerful. But they are a <em>test-after</em> technique. I usually recommend to practice <a href="https://en.wikipedia.org/wiki/Test_driven_development">Test-Driven Developement</a>, so you should barely need snapshots. Actually, <strong>snapshots have very few valid use-cases</strong>. Putting tests on existing code, before refactoring it, is one of these.</p>
<p>Now, I need an example. I’ll use the <a href="http://iamnotmyself.com/2011/02/13/refactor-this-the-gilded-rose-kata/">Gilded Rose kata</a> to illustrate that. It’s an exercise to practice refactoring techniques, which is really convenient here. I made a <a href="https://github.com/nicoespeon/kata-gilded-rose-js">JS starter</a> of the kata that you can use.</p>
<p>So you have 2 classes: <code class="language-text">Shop</code> and <code class="language-text">Item</code>. <code class="language-text">Item</code> is pretty simple:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Item</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> sellIn<span class="token punctuation">,</span> quality<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token keyword">this</span><span class="token punctuation">.</span>sellIn <span class="token operator">=</span> sellIn
    <span class="token keyword">this</span><span class="token punctuation">.</span>quality <span class="token operator">=</span> quality
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Then you have <code class="language-text">Shop</code> which takes a list of <code class="language-text">items</code> and have a method <code class="language-text">updateQuality()</code> that will update the <code class="language-text">quality</code> and <code class="language-text">sellIn</code> attributes of every item. There is a bunch of logic that’s currently supposed to work. It is not pretty though, so I won’t put it here but give you <a href="https://github.com/nicoespeon/kata-gilded-rose-js/blob/954274fb04741e9c2992f9b31482daca366e0055/gilded-rose.js#L14-L69">a link to the beast</a> instead.</p>
<p>Your goal: change <code class="language-text">updateQuality()</code> so it deals with <code class="language-text">&quot;Conjured&quot;</code> items too (they degrade in quality twice as fast as normal items).</p>
<p>There is no test. A good idea is to refactor this code first – make the change easy, remember?</p>
<p>Let me show you how to apply the Approval Testing technique in such a scenario.</p>
<h3 id="1-generate-an-output-you-can-snapshot"><a href="#1-generate-an-output-you-can-snapshot" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Generate an output you can snapshot</h3>
<p>The first step is to generate a snapshot from <code class="language-text">updateQuality()</code>. It doesn’t return a string, but it changes <code class="language-text">items</code>. Thus, my first move is to write a function returning something which captures the changes so Jest can take a snapshot of it:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// I put that code in my test file, since it's test-related.</span>

<span class="token keyword">function</span> <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> sellIn<span class="token punctuation">,</span> quality<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> gildedRose <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Shop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> sellIn<span class="token punctuation">,</span> quality<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> items <span class="token operator">=</span> gildedRose<span class="token punctuation">.</span><span class="token function">updateQuality</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>I could have returned <code class="language-text">items</code>, but I’m simplifying things a bit here: I’m only testing a shop with one item. That’s because I already know the behavior is the same regardless the number of items. It might not be your case. You should adapt to your situation, this is the tricky part.</p>
<p>Now I have a <code class="language-text">doUpdateQuality(name, sellIn, quality)</code> I can call from my tests. It will instantiate the shop, call the method I’m testing and return me the updated item.</p>
<p>My next move is to write the first test, taking a snapshot from the output:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should update quality'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> sellIn<span class="token punctuation">,</span> quality<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// …</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If you’re not familiar with Jest snapshot testing, I suggest you take a few minutes to have a look at <a href="https://jestjs.io/docs/en/snapshot-testing#snapshot-testing-with-jest">their documentation</a>. I will wait 😉</p>
<h3 id="2-using-test-coverage-to-find-all-input-combinations"><a href="#2-using-test-coverage-to-find-all-input-combinations" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Using test coverage to find all input combinations</h3>
<p>At this point, I generated a first snapshot, given a set of parameters. Jest will tell me if any regression happens to that scenario. Can I go refactor <code class="language-text">updateQuality()</code> now? Nope. Because I’m not covering all the code with this snapshot. This, I can know thanks to the test coverage!</p>
<p>To generate test coverage, I run Jest with the <code class="language-text">--coverage</code> option.</p>
<p>I find the <code class="language-text">html</code> report to be the best in this scenario. To do so, I need to configure Jest options. This can be done in a config file, or quickly in <code class="language-text">package.json</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>
  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"gilded-rose-kata"</span><span class="token punctuation">,</span>
  <span class="token comment">// …</span>
  <span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token string">"jest"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"jest"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"coverageReporters"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">"html"</span>
      <span class="token comment">// I could add "text" or "text-summary" to see output in the console</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Then, I run <code class="language-text">yarn test --coverage</code> (or <code class="language-text">npm run test -- --coverage</code>), which generates a <code class="language-text">coverage/</code> folder.</p>
<p>I open the <code class="language-text">coverage/index.html</code> file:</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/coverage-1-a3b44c81d9f13b612fb7923841071d85-d02bf.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 97.87878787878788%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAADKElEQVQ4y41Ui3KbOhD1/3/STdJMH3bT9N72pnFix8TGNm8LhBAIgcCcLthN0oybKTNndoVgtTp7dkezsMKNb/Bg+5jfTbG213i0LCSMYXj2HdAR9vvDuuue0e+9ejfaxBxeViAuFJI8QyQ4WQkvZihMDb1vkdcVKnTgRX7wuz1U20CTDVNOvkFJ66zSGO3O3iM+/4jd+Rjxu89g5xPwS7IXn8DejZFcTsgfD3509oG++3TYGzBG8M977MgfQHFGmsXgWxeB5WJ1a2E7teBO5xCuj8wLwOwN8iBAk2bP4IKsONrs4KcHf2S6BpFaoSEq1m4Ke7tGwEI4voeqMWh7GvH3z6gmTuLMQUM/57JCyjm01uA8QVkWR9J7vru/wsgYA0GpVlX9fEz3wh0+fOl3b2eodQmexohjiZUdYGM78DYBiuIexjhHNfyexa/gJwOWpUIsfJJZQ0EqgkRJV87ziLbLkz+9lSUFLJGKFEpRYNJkStcvdT5sGqqUqWuCQUOLlrTWkfZOcffroFFPfCgstNQJP25u4W19yCKjTAtkQtFhHIwzCLJ1pYaAb2U9ZMjTZFikIkcYCUSRhx1JR0oBVjPYcgM/9yAqAdWUSHSCmJDVEqlOf8+wvypL3KEvd74Dd7VCynJEvg++C8FI1DzZgUtGSiigCYWWyJVArRXaIwVPATVlqKMQzcZDTh3iXt3CntxiNZ6QnWA9+YLg+xTW9TW2366x+e8rlv9eIZhPUVEfv5bToSg8HRYNkd7jj88weY6tc0KbTxkq6ueWESePDrY3K4R3FqLZDMHdDNH9AvFiTf1Mtyg1tMxhiKan0fW6KH3AOmQwKwfV/RLB1znChyXY0kK4sJCut2BrB4H9CObYCNfEsetAZDFKKpBuNKq2eiEbVUIkHHvSWkeaK0iHvVxkJqi3BUqVQ2oBXiZQnUZN46IfGanJhirndQ5l1HPAiq5hKMN6YaP6MUfx/wzbDzewzq6wODvH48UlVhcf4X3+hthawuRUaSFhpDoo/9SVFfHX9nONcbTULYUXQbo9XGSEnOZi4ZO4tx7NyB4kfnpXSznU5mVRfgJ5QPp/u0qpuQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Coverage output with a lot of red lines"
        title=""
        src="/static/coverage-1-a3b44c81d9f13b612fb7923841071d85-c83f1.png"
        srcset="/static/coverage-1-a3b44c81d9f13b612fb7923841071d85-569e3.png 240w,
/static/coverage-1-a3b44c81d9f13b612fb7923841071d85-93400.png 480w,
/static/coverage-1-a3b44c81d9f13b612fb7923841071d85-c83f1.png 960w,
/static/coverage-1-a3b44c81d9f13b612fb7923841071d85-d02bf.png 1320w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>All the red lines, I don’t test.</p>
<figure>
  <blockquote>
    <p>Test coverage can only tell you<br>what code is not tested, nothing else.</p>
  </blockquote>
</figure>
<p>Let’s figure out another combination that would cover more lines… An item with a positive quality should do:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should update quality'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>I run the test again. A new snapshot is generated.</p>
<p>Coverage report is updated:</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/coverage-2-04a789346aece6e4a881623da856728a-5b83d.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 97.87556904400606%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC1klEQVQ4y5VUbW/TMBjs//9FvHxASIgvgAZjY+tKmzTvadzEzrudtMfZiG0t0waWTo4d5XLn5x4vrtIBF4nB0k9x8+Manu9jtVqhKAo8Hsfj0eF8nO8tgjhFmAkU+xJCFMiyDPv9HlEUoaoqdF0HpZSby7J06PseTdO4Oc9zt/fn/WLoO1h03YBh0HweYbTBOI5cD/ezhSV4DLtniR7vLbQxTkFRKARBjiTKkYaxU9C2LVXavzf3ll8CCQdk6g7TNMP3BTabNZI0JvmWCnrM80TM+NdBwhFCRSTUVDWipCJrpSz3tND9VZQXFRpalpWC1vpR6c6r+3ylTxRaW6UUrHCDjZdi64WItxma9juM8RzZ8Xg4UfFUXO4JrS0hE8yHiUUYiJpWB9oXfK2f/Og5lQtbail/500wi5VUJKzdy2kC7JHYGNnZFuhc7blqErZI5YoKD/j69RuiIEHT1S4ySjGsskRRCUhVQo+9I3xOtVNYlpVbSNkw+YrdEmG3S1GrCmLcYaM8xCqA7OnE9BC9cKjHGnKUpwq7rkVebl1ptR6RJGw9oVwbCrFzPV23PAbDjppHjEQ/sfU0W4/k02xOErDoB2t5aXcwTwY31ze0XSAMAoShh2Drs7clol1CbJEUMWIib3ZoqPBwmP+2vGeYXRHsgeP/x4nlgYTdTmDOCqilj+DLHbLLW+Tfr5BeXnH+AXGzRhPFmFraljVM0/Lv89NFsYSaZIaBHvlh+nmJbOWh8DbIfq5RBSFEmCD11ygiH5nvoYpDJkDwLHkLEfZcH2LD/Enm72hDR7RUoGTLCks0tUTPm6YeJMp+D+pj1A8wRDUpSK1Qa0bMtA+EIxVOVKhv1xgurtF8uUbw7gKr1x+xfPUaqzdvsX7zHvGHTxC3K2hVY2DvG0USbZ623Io9DnWLuWLV2Cktb/A6ZVx4e1s02Q5tXkHGXKcJVMKMMl6ad+bxrCi/AA2KCClRYBLfAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Coverage output with less red lines"
        title=""
        src="/static/coverage-2-04a789346aece6e4a881623da856728a-c83f1.png"
        srcset="/static/coverage-2-04a789346aece6e4a881623da856728a-569e3.png 240w,
/static/coverage-2-04a789346aece6e4a881623da856728a-93400.png 480w,
/static/coverage-2-04a789346aece6e4a881623da856728a-c83f1.png 960w,
/static/coverage-2-04a789346aece6e4a881623da856728a-5b83d.png 1318w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>Yay, less red lines!</p>
<p>So you get the idea: during this phase, I need to find all the possible combinations that would cover all the code. No more red lines.</p>
<p>Let’s fast-forward a bit. Here’s what I’ve got:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should update quality'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Aged Brie'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>
    <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/coverage-3-77c53f9aeb0d0f9bc39da61b93d4378e-2c575.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 101.74326465927099%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC80lEQVQ4y41UaY/bNhDV//9HOdqP3U2RoNkgAda3XVsHRYmHJIoidbwO5WODxtmExoDjEfU0w/dmoqfE4lPi8LyP8eXLP9gfDlgsF2AsQ1jT5TdO483/aYz+RxlTKISFUi1UqSG4hCgU0pihMx6DG2GqFoOfoEUN2ziMHnBtT/sESe/0dCbErXGIHldv8GH9Fg/Ld3jc/InH9Xv8vfmD/Hf4sCF/S/767P+1fIMH8h8vdo0F/2H1dn4WybpAwo/Yxycsthusd2tsNs/IyhO4ypDkR+QyQWUF6k6dzV53+RK7WNT3HrzaYRyA478K8SkGzxmSOIHrHIZ+pGcjfndFnbPI9R5936MUBnmeo64rcH7er2uapt+yyHsPKRVCpvdWYI7OzYevwK9maK0lQIGybJBmEjkjn/auO9FH4rvZvQYcmbYBlycC6KhcRcYIXKIolhiG7Jbd92CvArZtO5fsvUPwg3nf4eV8kOyv7/H6fM6Q6Q2s7XA4pNQhHFVTzaA1ibXSNSqlZ/NE4Dj0P7nr6ZqhAS/Pbda2A7FbI8tS2lPqAgFuGDZyi1gdIRsON3jUrobuNFrfwniDIWjulqFpqPXyORAIEtReJQEJwaG1gmokOAHpTsL0Bp76rukbSBJxAKtchX7sXwCbtsJJfp0DQUKfPn7E8ZBju9tjt1tiv9ui4CV1C0dM3ZPJFLnKwWqGwhQkfPdjyYVgl8BE6U9wzpNZMjdbT91iLWVG1YQ7b5oGnnQ7jOM9UgiwZHOAF5yyOxJIT/fZEYhB+GCQVEckAa+L+gJY4yTOJWutsVrsiRQaGMlptkBQUVZIsgyCyhaihK70/IHxjnSiUEYhs1vA2h7GkGRqSaVVNCA6IqFGYQsImjiSJkwggxuOpE6hiJyyLW9MzzrMxHaevmGt11/x7ekzyqJFHAddxsjShK6jIMZpmF5IuFf9XHJrCVCt5iEQVk1ZLZ5X1HoVGLUhYwkylpKUNOlV0kTKUVHJSik46q7/l/wf5KUDByaCJPkAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Coverage output with no red line"
        title=""
        src="/static/coverage-3-77c53f9aeb0d0f9bc39da61b93d4378e-c83f1.png"
        srcset="/static/coverage-3-77c53f9aeb0d0f9bc39da61b93d4378e-569e3.png 240w,
/static/coverage-3-77c53f9aeb0d0f9bc39da61b93d4378e-93400.png 480w,
/static/coverage-3-77c53f9aeb0d0f9bc39da61b93d4378e-c83f1.png 960w,
/static/coverage-3-77c53f9aeb0d0f9bc39da61b93d4378e-2c575.png 1262w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>No more red lines, but I still have these <code class="language-text">E</code> symbols. These symbols mean that I’m covering the <code class="language-text">if</code> case, but I’m missing the <code class="language-text">else</code> clause – that’s why only 68.57% of branches are covered. I need to cover them too:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should update quality'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Aged Brie'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Aged Brie'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="gatsby-highlight-code-line">  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Sulfuras, Hand of Ragnaros'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="gatsby-highlight-code-line">  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Sulfuras, Hand of Ragnaros'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span>  <span class="token function">expect</span><span class="token punctuation">(</span>
    <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">  <span class="token function">expect</span><span class="token punctuation">(</span>
</span><span class="gatsby-highlight-code-line">    <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="gatsby-highlight-code-line">  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="gatsby-highlight-code-line">  <span class="token function">expect</span><span class="token punctuation">(</span>
</span><span class="gatsby-highlight-code-line">    <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">)</span>
</span><span class="gatsby-highlight-code-line">  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>So far, so good. I’m covering every line and branch. Can I go refactor <code class="language-text">updateQuality()</code> now?</p>
<p>Well… not yet. Remember when I said test coverage can only tell you “what code is not tested”? That means it doesn’t tell you if the covered code is properly tested.</p>
<p>This is why setting a test coverage objective to ensure test quality doesn’t work. Test coverage tells you parts that are not tested – and that might be fine not to test these parts. Other than that, it says nothing.</p>
<p>To me, good test coverage comes as a side-effect of a good testing strategy (TDD). It’s not a target.</p>
<h3 id="3-use-mutations-to-verify-snapshots"><a href="#3-use-mutations-to-verify-snapshots" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Use mutations to verify snapshots</h3>
<p>To ensure the covered code is actually tested, I’m gonna introduce little mutations in the code.</p>
<p>The goal here is to see the test fail. If I change the existing code and a test fail, I’ll feel safe refactoring this code! When the test has failed, I revert the mutation and move to another line.</p>
<p>What mutations should you introduce? Again, it depends on what you’re testing – sorry. Usually, mutate the side-effects that you’re capturing in your snapshot. In my case, that means I don’t have to change <code class="language-text">if</code>s, but only the updates to <code class="language-text">item</code>. There are 8 of them.</p>
<p>Let’s start with the first assignment, line 22:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">!=</span> <span class="token string">'Sulfuras, Hand of Ragnaros'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>quality <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>quality <span class="token operator">-</span> <span class="token number">1</span>
<span class="token punctuation">}</span></code></pre></div>
<p>I’ll introduce a little mutation, just to check:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">!=</span> <span class="token string">'Sulfuras, Hand of Ragnaros'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>quality <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>quality <span class="token operator">-</span> <span class="token number">2</span>
<span class="token punctuation">}</span></code></pre></div>
<p>I run my tests again:</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-49d4c.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 38.7%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA10lEQVQoz5WSa26DMBCEOUfxg2XXLwhVQqWo97/YdHFCQ0hp1R+fxpat2dHYzel8RZ4uKGVEjAVEAdYLjOvRmg7GUlXre1AUdOGOPNQzV7We0HzOV5zOHwhphKQBxjPe1GA1W1n2bfsHeqeZ44h3KZiUizKHEdnJzeAXtsO2NIWzGjByHDBoyqJKHdf41tFN97hH6hfDIQREktpdxxGkuJ5rL37V3Xo5N+7AsISsieS7t7WLFzXPXW0f7MkwJe1vmiASD3s54seE3AckSfD6Tcwy+Z+me74Agqjb140/D1gAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="A snapshot failed"
        title=""
        src="/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-c83f1.png"
        srcset="/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-569e3.png 240w,
/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-93400.png 480w,
/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-c83f1.png 960w,
/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-23e13.png 1440w,
/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-10d8f.png 1920w,
/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-49d4c.png 2000w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>Great! I know my test will catch any regression here. I can revert my mutation.</p>
<p>Let’s move on the other ones. I introduce a similar mutation line 33:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>quality <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>quality <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>quality <span class="token operator">+</span> <span class="token number">2</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Run tests again and…</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/passing-tests-53842161570902bb6f2a34eaa3782299-41e23.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 572px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 60.48951048951049%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACWUlEQVQozz2S6XbaQAyFeQmSAN7wboPHG94NcRNIIKSQNu0T9B36qz199FuNCPmhczRjz9XVJ400X0CNShj5GoonoGU9dDprywJ62kJZlgiEQF/ZiIWLOCnRND38IEKSrtC0axhzB9OZDkWdY5RXLR6ej0jKFnnZYP24R1z2KLoB7eYBadnRYx+eY0A3LNi2D4tC0y3MTYdzKTRTjItgVw/o6nuUWYs0LpFSVdv2EIYRh+eF9PMc41sVk6nGcXM7+8zvJuqnoIzR8HONzY8ex197NF8rjG9mMC0PjhsiXMRwvQVFiIBalHdz0+V76Uzm8tu1XXb49ucJ3//u8f5vj9PvHUzTw9PzCx63z3h7e8f+8IqSsByPJwzDFmlW4Hz+zuxWqxr9esDtnQpVMy8OJxMN+apCVXcoioYfRyKlc08DWJHjKT1QuE3Zngx5lq6uIcVk++yQrRKjuefACQJ0NIyy6lh4GSVcqOvvUdNkw4XAqqg5T7OSCwfEWbpumjXlghx+QJ4qOldRP1go2hyaJqcawNBdDmVmEhKfGeuGzetyZWfZl7uRVJcuJHTJpG037DCKUpguCfkkGrnwclqdLODcMC7r4rgB/+f5CzbDDGuyKuHLNgraQ3mWeZ5XhMCHm/jItimKl5wig+gFbCuASyJxkqPtNiz6yVDy2e722O0OzOQ6rfF4BsOxsGyWEGvi9JggHgREJ0gsZF6RyFDT8ESc8dLLt6PhyxYnWoPT+RsOtCLH1zMPYTrVSdBG8hAjKEIUx5wEYxSHHO4ygIhyLJYxu5SDkuik6H9c0G6CRLzXBgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="All tests passing"
        title=""
        src="/static/passing-tests-53842161570902bb6f2a34eaa3782299-41e23.png"
        srcset="/static/passing-tests-53842161570902bb6f2a34eaa3782299-c2b80.png 240w,
/static/passing-tests-53842161570902bb6f2a34eaa3782299-bf6fa.png 480w,
/static/passing-tests-53842161570902bb6f2a34eaa3782299-41e23.png 572w"
        sizes="(max-width: 572px) 100vw, 572px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>That’s not good.</p>
<p>Before going further, I revert the mutation in the code. <strong>Don’t let mutations live long.</strong></p>
<p>Then, at that point, I need to think a bit about the code – yeah, I lied, but you don’t have to understand <em>all</em> the code. How could this happen? I suspect that a further update makes me take another path in the following logic, resulting in a similar result with my given combinations. Looking at the lines of code I want to mutate, I find this one to be interesting:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">!=</span> <span class="token string">'Sulfuras, Hand of Ragnaros'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sellIn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sellIn <span class="token operator">-</span> <span class="token number">1</span>
</span><span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sellIn <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// …</span>
<span class="token punctuation">}</span></code></pre></div>
<p>That means if <code class="language-text">sellIn</code> is <code class="language-text">0</code>, then it doesn’t execute the rest of the code. I try to add another combination:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should update quality'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Aged Brie'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Aged Brie'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Sulfuras, Hand of Ragnaros'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Sulfuras, Hand of Ragnaros'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>
    <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>
    <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>
    <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">  <span class="token function">expect</span><span class="token punctuation">(</span>
</span><span class="gatsby-highlight-code-line">    <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</span><span class="gatsby-highlight-code-line">  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>I generate the new snapshot, then retry the mutation:</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-14179.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABQ0lEQVQoz41SW3LCMAzMMUoejh3JrzwoSckA0x6gZ+n9/7eyoZ0yA4WPtSTbI620KuL+hDAf0C9H+H4AEYM4whgL63qEcYdaEapao27MQxRfyzs+t3uspw+s6xHOD3BhgGoJL6VCKfhJ9kzSYtIOx2nBPK8Y+i36MKKPE7yN4M6heYLVVUIlx0wBi3EYtMVO/DeKGXMX4Jtzu8+iSAyitBmEaWgZQdjFBGHLNqBpDRrdib3gni//aiUM69rAyQUbgpW5ddKmIY9OoMlCM8FYFstof33Ksb7c5zciKClQJJqeHUbv87w2SYiqvcKmFPsHVaVvI7VcysHCZhhfhZkFOxFDBCEOmaURxl5UTyuUYmIprDpUzW3FM0MtLS/ThCn2cDI3LTuY0GrO63OOOccJ/61QTpg+WVGXRGkl1VObj9S8l/QbCpMWNshtG48AAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="A snapshot is now failing"
        title=""
        src="/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-c83f1.png"
        srcset="/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-569e3.png 240w,
/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-93400.png 480w,
/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-c83f1.png 960w,
/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-23e13.png 1440w,
/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-14179.png 1532w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p><img src="/yes-ff326b278cccfa096e43ed222b460064.gif"></p>
<p>It worked!</p>
<p>I revert my mutation and continue to the next assignment. I do that until I know all of them are <em>actually</em> covered with tests.</p>
<p>Hopefully, I didn’t found other false positive for coverage. Here’s the final list of tests:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should update quality'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Aged Brie'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Aged Brie'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Sulfuras, Hand of Ragnaros'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Sulfuras, Hand of Ragnaros'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>
    <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>
    <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>
    <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>
    <span class="token function">doUpdateQuality</span><span class="token punctuation">(</span><span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Can I go refactor <code class="language-text">updateQuality()</code> now?</p>
<p>Yes! All the code is now covered by snapshots. A wrong move and I’ll automatically know that. I can now refactor the code without introducing bugs. Then I’ll add the feature 🤘</p>
<h3 id="4-these-tests-are-technical-debt"><a href="#4-these-tests-are-technical-debt" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. These tests are technical debt</h3>
<p>If you apply this recipe, remember this: you accepted to take technical debt here. You traded well-written tests against snapshots of existing behavior to get a test harness faster so you can refactor.</p>
<p>Snapshots are powerful, but they don’t help you understand what the code is supposed to do. Once the code is refactored, you should pay the debt back: write proper, comprehensive tests on your clean code to replace your snapshots. If you do so, this part of the codebase will be easier to maintain in the future, and you’ll add new features faster.</p>
<h2 id="introducing-jest-extended-snapshot"><a href="#introducing-jest-extended-snapshot" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introducing jest-extended-snapshot</h2>
<p>Looking at the resulting test code, I thought that was a lot of boilerplate code in a single <code class="language-text">it</code>!</p>
<p>So I refactored it with a custom Jest matcher: <code class="language-text">toVerifyAllCombinations()</code>.</p>
<p>With it, the previous code could be written the following:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should update quality'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>doUpdateQuality<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toVerifyAllCombinations</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span>
      <span class="token string">'foo'</span><span class="token punctuation">,</span>
      <span class="token string">'Aged Brie'</span><span class="token punctuation">,</span>
      <span class="token string">'Backstage passes to a TAFKAL80ETC concert'</span><span class="token punctuation">,</span>
      <span class="token string">'Sulfuras, Hand of Ragnaros'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>It will generate all possible combinations of the following arguments, call <code class="language-text">doUpdateQuality()</code> with each and take a snapshot of all results.</p>
<p>I like it because it expresses the intention better: “current behavior should be preserved for all these scenarios”.</p>
<p>I extracted that into a library so you can use it too: <a href="https://github.com/nicoespeon/jest-extended-snapshot#readme">jest-extended-snapshot</a> 👹</p>
<h2 id="inspiration"><a href="#inspiration" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Inspiration</h2>
<p>I discovered Approval Testing thanks to <a href="https://twitter.com/emilybache">Emily Bache</a>. She made a very nice 20-min screencast where she runs a demo of this very example, in Java:</p>
<div>
          <div
            class="gatsby-resp-iframe-wrapper"
            style="padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 1.0725rem"
          >
            <iframe src="https://www.youtube.com/embed/zyM2Ep28ED8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
          "></iframe>
          </div>
          </div>
<p>You can read more about Approval Testing on <a href="http://approvaltests.com/">http://approvaltests.com/</a>.</p>
<p>They have a library to do that in JS, with Mocha: <a href="https://github.com/approvals/Approvals.NodeJS">https://github.com/approvals/Approvals.NodeJS</a></p></div><div class="post-single__meta"><span class="post-single__date">Published 12 Jan 2019</span><span class="post-single__comments"><i class="icon-twitter"></i><a href="https://mobile.twitter.com/search?q=undefined" target="_blank" rel="noopener noreferrer">Discuss this article on Twitter</a></span></div></div><div class="post-single__footer"><div class="post-single__tags"><ul class="post-single__tags-list"><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/tags/tests/">tests</a></li><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/tags/legacy-code/">legacy code</a></li><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/tags/jest/">jest</a></li></ul></div><hr/><form action="https://nicoespeon.us4.list-manage.com/subscribe/post?u=ca05d369ee1b4a4e803dce32c&amp;id=2fd39e1501" method="post" name="mc-embedded-subscribe-form" target="_blank"><span class="highlighted"><h2>Wanna learn more about<!-- --> <span class="highlighted__text">VS Code</span>?</h2></span><p>I frequently publish tips and tutorials. Subscribe to get<!-- --> <a href="https://us4.campaign-archive.com/home/?u=ca05d369ee1b4a4e803dce32c&amp;id=2fd39e1501" target="_blank" rel="noreferrer noopener">emails like this</a> <!-- -->before anyone else!</p><div class="form-inline"><input type="name" class="form-inline__input form-inline__name" placeholder="Name" name="FNAME"/><input type="email" class="form-inline__input form-inline__email" placeholder="Email" name="EMAIL" required=""/><div style="position:absolute;left:-5000px" aria-hidden="true"><input type="text" name="b_ca05d369ee1b4a4e803dce32c_2fd39e1501" tabindex="-1" value=""/></div><button class="form-inline__submit" type="submit">Subscribe <i class="icon-paper-plane"></i></button></div></form><hr/><div class="post-single__footer-text">I write about VS Code, web development and life in general.<ul class="twitter"><li><a class="twitter-share-button" href="https://twitter.com/intent/tweet?via=nicoespeon" data-size="large">Tweet</a></li><li><a class="twitter-follow-button" href="https://twitter.com/nicoespeon" data-show-count="false" data-size="large">Follow @nicoespeon</a></li></ul></div></div></div></div></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-39957541-2', 'auto', {});
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-post-template-jsx","jsonName":"en-2019-01-approval-testing-on-legacy-code-f1a","path":"/en/2019/01/approval-testing-on-legacy-code/"};window.dataPath="705/path---en-2019-01-approval-testing-on-legacy-code-f-1-a-1c2-TbMnwdERqlr6kgYvIAQGW0BlL0";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-a28781cee54de6f2bd9c.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-5f2b74aaa9780afd7bf0.js"],"component---src-templates-page-template-jsx":["/component---src-templates-page-template-jsx.20eefe64b5c91dc9fdf9.css","/component---src-templates-page-template-jsx-2867f11da2fec411d3ff.js"],"component---src-templates-post-template-jsx":["/component---src-templates-post-template-jsx.c98be2ba4ac4b2de096b.css","/component---src-templates-post-template-jsx-b0c88465e57e8189bbf9.js"],"component---src-templates-tag-template-jsx":["/component---src-templates-tag-template-jsx.bb9f1ae7f8c8c8c3586c.css","/component---src-templates-tag-template-jsx-6008984e887a89241ec3.js"],"component---src-templates-category-template-jsx":["/component---src-templates-category-template-jsx.bb9f1ae7f8c8c8c3586c.css","/component---src-templates-category-template-jsx-eaa51ffdd1352a22a76a.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-196164e16922a532708f.js"],"component---src-pages-categories-jsx":["/component---src-pages-categories-jsx-4e437ac387c574170b30.js"],"component---src-pages-fr-categories-jsx":["/component---src-pages-fr-categories-jsx-09608d7ad04422a55941.js"],"component---src-pages-fr-index-jsx":["/component---src-pages-fr-index-jsx.bb9f1ae7f8c8c8c3586c.css","/component---src-pages-fr-index-jsx-f0d4183c08caefb35687.js"],"component---src-pages-fr-tags-jsx":["/component---src-pages-fr-tags-jsx-3b74bc543621602ede45.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx.bb9f1ae7f8c8c8c3586c.css","/component---src-pages-index-jsx-6f01bef27b5d2850d753.js"],"component---src-pages-tags-jsx":["/component---src-pages-tags-jsx-f74e5e1d4b4c8c3d4754.js"]};/*]]>*/</script><script src="/webpack-runtime-bf0ace88c74dbb51fc86.js" async=""></script><script src="/0-bd3cfe82c996ec44cdd4.js" async=""></script><script src="/2-91086bbd293eb1ddadc5.js" async=""></script><script src="/app-a28781cee54de6f2bd9c.js" async=""></script><script src="/component---src-templates-post-template-jsx-b0c88465e57e8189bbf9.js" async=""></script><script>window.twttr = (function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0],
                  t = window.twttr || {};
                if (d.getElementById(id)) return t;
                js = d.createElement(s);
                js.id = id;
                js.src = "https://platform.twitter.com/widgets.js";
                fjs.parentNode.insertBefore(js, fjs);

                t._e = [];
                t.ready = function(f) {
                  t._e.push(f);
                };

                return t;
              }(document, "script", "twitter-wjs"));</script></body></html>