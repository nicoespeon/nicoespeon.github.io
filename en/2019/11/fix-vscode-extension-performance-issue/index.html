<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/component---src-templates-post-template-jsx.8973a9913c53eab5adc6.css">html{--hue:210;--accent-hue:330;--background-color:hsl(var(--hue),0%,100%);--separator-bg-color:hsl(var(--hue),0%,90%);--box-light-bg-color:hsl(var(--hue),0%,92%);--box-light-bg-hover-color:hsl(var(--hue),0%,87%);--text-color:hsl(var(--hue),0%,13%);--text-secondary-color:hsl(var(--hue),0%,33%);--subtitle-color:hsl(var(--hue),0%,53%);--focus-color:hsl(var(--hue),100%,57%);--link-color:hsl(var(--hue),100%,57%);--link-secondary-color:hsl(var(--accent-hue),100%,74%);--highlight-border-color:hsl(var(--accent-hue),100%,74%);--highlight-bg-color:hsl(var(--accent-hue),100%,94%);--code-bg-color:#f5f2f0;--code-text-color:#212121;--code-shadow-color:#fff;--code-selection-color:#b6d9fc;--code-punctuation-color:#999;--code-property-color:#8f0505;--code-selector-color:#4d9900;--code-operator-color:#a65959;--code-operator-bg-color:#f7f7f7;--code-keyword-color:#0054a8;--code-function-color:#dd4b94;--code-variable-color:#f07800}html[data-theme=dark]{--background-color:hsl(var(--hue),0%,8%);--separator-bg-color:hsl(var(--hue),0%,25%);--box-light-bg-color:hsl(var(--hue),0%,20%);--box-light-bg-hover-color:hsl(var(--hue),0%,30%);--text-color:hsl(var(--hue),0%,68%);--text-secondary-color:hsl(var(--hue),0%,55%);--subtitle-color:hsl(var(--hue),0%,40%);--focus-color:hsl(var(--hue),40%,60%);--link-color:hsl(var(--hue),40%,60%);--link-secondary-color:hsl(var(--accent-hue),60%,50%);--highlight-border-color:hsl(var(--accent-hue),100%,34%);--highlight-bg-color:hsl(var(--accent-hue),30%,20%);--code-bg-color:#2a2622;--code-text-color:#d4d4d4;--code-shadow-color:#1a1a1a;--code-selection-color:#064789;--code-comment-color:#6f7f90;--code-punctuation-color:grey;--code-property-color:#f96666;--code-selector-color:#9c6;--code-operator-color:#b34d4d;--code-operator-bg-color:#333;--code-keyword-color:#71a1d0;--code-function-color:#c63980;--code-variable-color:#d97f26}html[data-theme=dark] img{-webkit-filter:brightness(.8);filter:brightness(.8)}
/*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 2.5rem}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 .125rem;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}html{font-size:100;background-color:var(--background-color);color:var(--text-color)}body{line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:Roboto,Helvetica Neue,Helvetica,Arial,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:500}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:auto}hr,img{border:0;display:block}hr{color:var(--text-color);height:26px;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,var(--text-color) 0,var(--text-color) 15px,transparent 0,transparent 26px);width:6.25rem}a{color:var(--link-color);text-decoration:none}a:active,a:focus,a:hover{color:var(--link-secondary-color)}b,strong{font-weight:500}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto;margin-left:0;margin-right:0}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:var(--text-color);font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.layout{max-width:66.875rem;margin-left:auto;margin-right:auto}.layout:after,.layout:before{content:"";display:table}.layout:after{clear:both}.content__inner{padding:1.5625rem 1.25rem}.anchor svg{fill:var(--text-secondary-color)}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}.content{width:calc(58.275% - .78125rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(12n){margin-right:0;float:right}.content:nth-child(12n+1){clear:both}.content__inner{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.content{width:calc(66.6% - .625rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(3n){margin-right:0;float:right}.content:nth-child(3n+1){clear:both}.content__inner{padding:2.5rem 2.1875rem}}code[class*=language-],pre[class*=language-]{color:var(--code-text-color);background:none;text-shadow:0 1px var(--code-shadow-color);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:var(--code-selection-color)}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:var(--code-bg-color)}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:var(--code-comment-color)}.token.punctuation{color:var(--code-punctuation-color)}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:var(--code-property-color)}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:var(--code-selector-color)}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:var(--code-operator-color);background:var(--code-operator-bg-color)}.token.atrule,.token.attr-value,.token.keyword{color:var(--code-keyword-color)}.token.function{color:var(--code-function-color)}.token.important,.token.regex,.token.variable{color:var(--code-variable-color)}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.tags__list-item-link{color:var(--text-color)}.tags__list-item-link:focus,.tags__list-item-link:hover{color:var(--focus-color);border-bottom:1px solid var(--focus-color)}.categories__list-item-link{color:var(--text-color)}.categories__list-item-link:focus,.categories__list-item-link:hover{color:var(--focus-color);border-bottom:1px solid var(--focus-color)}ul.twitter{list-style:none;padding-left:0;margin-bottom:2rem}ul.twitter li{display:inline;margin-right:1rem}.post-single__inner{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.post-single__title{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.post-single__subtitle{font-size:.9rem;max-width:40rem;text-align:center;font-style:italic;margin:.40625rem auto 0}.post-single__body figure{margin-bottom:1.625rem}.post-single__body figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.post-single__body figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.post-single__body a{text-decoration:underline}.post-single__body .gatsby-highlight{max-width:40rem;margin-left:.9375rem;margin-right:.9375rem;margin-bottom:1.625rem}.post-single__body .gatsby-highlight-code-line{background-color:var(--highlight-bg-color);display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid var(--highlight-border-color)}.post-single__body{max-width:40rem;margin-left:auto;margin-right:auto}.post-single__footer{max-width:40rem;line-height:1.625rem;margin:1.625rem .9375rem 3.25rem}.post-single__footer-text a{text-decoration:underline}.post-single__meta{max-width:40rem;margin-left:auto;margin-right:auto;display:flex}.post-single__date{flex-grow:1;font-style:italic}.post-single__comments{flex-grow:1;text-align:right}.post-single__tags{margin-bottom:.8125rem}.post-single__tags-list{list-style:none;margin:0 -.3125rem;padding:0}.post-single__tags-list-item{display:inline-block;margin:.625rem .3125rem}.post-single__tags-list-item-link{background:var(--box-light-bg-color);text-decoration:none;border:0;border-radius:.1875rem;color:var(--text-secondary-color);line-height:1.625;padding:.5rem 1rem}.post-single__tags-list-item-link:focus,.post-single__tags-list-item-link:hover{color:var(--text-color);background:var(--box-light-bg-hover-color);border:0}.post-single__button-container{text-align:center}.post-single__button{display:inline-block;margin-right:1rem;font-size:1rem;padding:0 1rem;height:35px;line-height:2.1875rem;text-align:center;color:var(--text-secondary-color);background:var(--box-light-bg-color);font-weight:400;border-radius:.1875rem;margin-top:1.625rem}.post-single__button:focus,.post-single__button:hover{cursor:pointer;color:var(--text-color);background:var(--box-light-bg-hover-color);border:0}.post-single__button:last-child{margin-right:0}@media screen and (min-width:685px){.post-single__body .gatsby-highlight,.post-single__footer{margin-left:auto;margin-right:auto}}@media screen and (min-width:960px){.post-single__inner{padding:0}.post-single__title{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem}.post-single__subtitle{font-size:1rem;margin-bottom:2.4375rem}.post-single__body,.post-single__body p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}.post-single__button{position:fixed;margin:0;left:20px}.post-single__button--home{top:30px}.post-single__button--theme{top:81px}}</style><meta name="generator" content="Gatsby 2.0.22"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,700" rel="stylesheet"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">Find and fix performance issues of your VS Code Extension</title><meta data-react-helmet="true" name="description" content="I fixed a performance issue on a VS Code Extension I&#x27;m developing. Let me share with you what I learned."/><link rel="shortcut icon" href="/icons-ad72c5f34acd111a2daec190afc34979/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/icons-ad72c5f34acd111a2daec190afc34979/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/icons-ad72c5f34acd111a2daec190afc34979/favicon-32x32.png"/><link rel="manifest" href="/icons-ad72c5f34acd111a2daec190afc34979/manifest.json"/><meta name="mobile-web-app-capable" content="yes"/><meta name="theme-color" content="#fff"/><meta name="application-name" content="nicoespeon.github.io"/><link rel="apple-touch-icon" sizes="57x57" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-152x152.png"/><link rel="apple-touch-icon" sizes="167x167" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-167x167.png"/><link rel="apple-touch-icon" sizes="180x180" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-180x180.png"/><link rel="apple-touch-icon" sizes="1024x1024" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-icon-1024x1024.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/><meta name="apple-mobile-web-app-title" content="nicoespeon.github.io"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-320x460.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-640x920.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-640x1096.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-750x1294.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-1182x2208.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-1242x2148.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-748x1024.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-768x1004.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-1496x2048.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" href="/icons-ad72c5f34acd111a2daec190afc34979/apple-touch-startup-image-1536x2008.png"/><link as="script" rel="preload" href="/component---src-templates-post-template-jsx-fe37b511731a90ee6c68.js"/><link as="script" rel="preload" href="/app-a28781cee54de6f2bd9c.js"/><link as="script" rel="preload" href="/2-9d62d26dd2cdaa76a942.js"/><link as="script" rel="preload" href="/0-1fc3bea78341134a4e47.js"/><link as="script" rel="preload" href="/webpack-runtime-dde33867ef247f03f606.js"/><link rel="preload" href="/static/d/610/path---en-2019-11-fix-vscode-extension-performance-issue-f-2-c-297-OKvJbeFtOTlvil4mk3btDJPg70A.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="layout"><div><div><div class="post-single__button-container"><a class="post-single__button post-single__button--home" href="/">← Articles</a><div class="post-single__button post-single__button--theme" role="button" tabindex="0">Dark<!-- --> theme</div></div><div class="post-single"><div class="post-single__inner"><h1 class="post-single__title">Find and fix performance issues of your VS Code Extension</h1><p class="post-single__subtitle">☕ 7 min read</p><div class="post-single__body"><p>I’m developing a VS Code Extension that provides intuitive automated refactorings in JavaScript and TypeScript. It’s called <a href="https://vscode-abracadabra.com/">Abracadabra</a>.</p>
<p>Recently, I looked for performance bottlenecks to make it faster. In this article, I’ll explain how I did that, so you can do the same.</p>
<h2 id="how-do-you-know-you-need-to-improve-performances"><a href="#how-do-you-know-you-need-to-improve-performances" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How do you know you need to improve performances?</h2>
<p>When I make things, I try to follow the mantra:</p>
<blockquote>
<p>“Make it work, make it right, make it fast.”</p>
<p>— Kent Beck</p>
</blockquote>
<p>Abracadabra is a side-project. I first developed the features I needed and shipped that. As I learned along the way, I kept refactoring the code to improve readability, thus maintainability. During this process, I took decisions I knew were a bit naive from a performance standpoint, but they simplify a lot the development. A few months after the first release, I had developed more than 20 automated refactorings. Today, it makes me much more productive when I code.</p>
<p>Most refactorings are exposed as VS Code <a href="https://code.visualstudio.com/docs/editor/refactoring#_code-actions-quick-fixes-and-refactorings">Quick Fixes</a>. Regarding where your cursor is, VS Code will tell you the relevant refactorings you can perform through the lightbulb 💡</p>
<p>To determine what are the relevant refactorings, Abracadabra naively tries to perform each of them. Each refactoring that could change the code would be considered relevant. Any time the cursor changes position, VS Code would ask Abracadabra the same question: what are the relevant refactorings on this code, from the current selection? Hence, any time the cursor changes position, Abracadabra recomputes all refactorings of the catalog, again.</p>
<p>That doesn’t sound very performant, does it?</p>
<p>Indeed, <a href="https://github.com/nicoespeon/abracadabra/issues/18#issue-472611520">I thought about it at the beginning</a>, 2 weeks after the very first release. However, <strong>it wasn’t needed at that time</strong>. At that time, despite the theory, I couldn’t feel performance issues from usage. Thus, the naive implementation was fine. It kept the code simple, allowing me to develop more and understand the problem better.</p>
<p>Improving performance implies writing less naive, harder to maintain code to make it fast enough for the users.</p>
<p>Improving performance is a tradeoff on code maintainability.</p>
<p>That’s why I think you shouldn’t improve performance without measuring it. <strong>Measure performance.</strong> That’s how you know if you need to improve it or if it’s good enough.</p>
<h2 id="how-to-measure-the-performance-of-a-vs-code-extension"><a href="#how-to-measure-the-performance-of-a-vs-code-extension" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to measure the performance of a VS Code Extension?</h2>
<p>VS Code provides quite a good tooling to do so.</p>
<h3 id="show-running-extensions"><a href="#show-running-extensions" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Show Running Extensions</h3>
<p>The first thing you need to do is to <a href="https://code.visualstudio.com/api/get-started/your-first-extension#debugging-the-extension">debug your extension</a>. You certainly want to measure performance before and after your changes. Debugging your extension opens an extension host that will compile your extension code, so you can run it live.</p>
<p>In the Extension Host, open the Palette (<code class="language-text">⌘ ⇧ P</code> / <code class="language-text">Ctrl Shift P</code>) and search for <strong>Show Running Extensions</strong>.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/show-running-extensions-8f7a0eb252f077560dd728ed263883a6-db395.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 14.309484193011649%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAoElEQVQI133MUQvBUADF8b27G7aEsEvYbgwzY7MptiWU8v0/zd9VPCh5+HUezukYI3dI22nh1Go4wqQhrDeTplnHtv5pYJuWprdC0NU/xuF0IUwLZHLHS67E6VE7sctKgjDBn0eoYPPF/+SrW+Wo+IzaVKgwx1jsSzrpg97+QaCPo6zAX26RXoA7ndMfz+hPfhgrBn6IXFfI6IyMbwxmO56KwFW/vKf7QQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="show running extensions"
        title=""
        src="/static/show-running-extensions-8f7a0eb252f077560dd728ed263883a6-c83f1.png"
        srcset="/static/show-running-extensions-8f7a0eb252f077560dd728ed263883a6-569e3.png 240w,
/static/show-running-extensions-8f7a0eb252f077560dd728ed263883a6-93400.png 480w,
/static/show-running-extensions-8f7a0eb252f077560dd728ed263883a6-c83f1.png 960w,
/static/show-running-extensions-8f7a0eb252f077560dd728ed263883a6-db395.png 1202w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>That will open a tab wich list your running extensions:</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/running-extensions-33f5f2bc71e36d546afcaea79b002a17-02ac4.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 46.45669291338583%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABTklEQVQoz32S2XKDMAxFee2SBGxjY3YISxM60742zfpTpH9/KxGaZKalD2ck7LlCurJj4hw2zlBULap2hWbVoaxbuMpABvEkfpgiSApYIi5qooKyCRzfphDaonp5Rdu9DVRth6JeQfgBZp7CXPiYeyOU8xnfpWWDOK+QUMEwLRBlFRdMhm5cqa8sBEdDBdQ0VPimMaTxh84dTa0rSpruHVFew/UtpIkgiKlx+S7MliiaDnm9Rt6skdFEbIHDc3MBTV6yLz/85x+j7MVHHWVXBg+FDuGpANmyRUl/Yu9K8lDS+cyVkyPzHTMshbq1SU4aSx2SUJLBihDkxz2e9O8Yv8UFwa9ghLVy1Dtz2vKzCeFnJR6VHjEj+hdPJHyg6NFTC+ipmWVzibTxRUgjfx1P6Jn9Hv32E+fjccjPB+J0usUhP6DffPzBhjQ79LstvgHiNfOKu9DeYgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="running extensions"
        title=""
        src="/static/running-extensions-33f5f2bc71e36d546afcaea79b002a17-c83f1.png"
        srcset="/static/running-extensions-33f5f2bc71e36d546afcaea79b002a17-569e3.png 240w,
/static/running-extensions-33f5f2bc71e36d546afcaea79b002a17-93400.png 480w,
/static/running-extensions-33f5f2bc71e36d546afcaea79b002a17-c83f1.png 960w,
/static/running-extensions-33f5f2bc71e36d546afcaea79b002a17-02ac4.png 1270w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>The first thing you can see from this tab is the <em>Startup Activation</em> time. It tells you the time each extension took to activate.</p>
<p>As a rule of thumb, if your extension takes more than 500ms to activate, there’s probably something you could do to speed that up—it’d be a good idea to <a href="https://code.visualstudio.com/api/working-with-extensions/bundling-extension">bundle your extension</a> if you don’t do that already.</p>
<p>If you’re below that, I’d say that’s OK. Around 100-200ms is great. Below is amazing 😉👍</p>
<p>Now, that was for startup activation time. But if you’re probably concerned with your extension <em>runtime</em> performance. So how can we track that?</p>
<h3 id="record-extension-profile"><a href="#record-extension-profile" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Record Extension profile</h3>
<p>On the top right, you have a series of icons that will allow you to record a performance profile of the extension at runtime.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/running-extensions-icons-3db68c794980c76ea1af041b0191879e-41965.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 326px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 20.858895705521473%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAtUlEQVQY001Q2Q6CMBDkCzw4C7RgPRARgWCCZyT6aGLi///MymxS4sOmuzOd2WktR0iyg5hwotxQ0cwLGUMPbOoKxswcyAV5UTJq/rUWmu2+pvWuZGDuR5QfGlJ6wz2E9fFEWVGxaZSuqO0uA9aNPBb4ccqmFoC8bFiAfuIIuvUvKqqWk+Hy+/Ol870fuIDUMmP++ngyL5QmqTNexIZIFSaahSY2jO1Ajk80X4IZBROTyPDmi35iEWuV+clEtwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="running extensions icons"
        title=""
        src="/static/running-extensions-icons-3db68c794980c76ea1af041b0191879e-41965.png"
        srcset="/static/running-extensions-icons-3db68c794980c76ea1af041b0191879e-f1b80.png 240w,
/static/running-extensions-icons-3db68c794980c76ea1af041b0191879e-41965.png 326w"
        sizes="(max-width: 326px) 100vw, 326px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>Click on the record button (the dot in the circle). It will turn red, meaning it’s recording.</p>
<p>Then, go back to your code. Trigger your extension. In the case of Abracadabra, I was suspecting performance issues on Quick Fixes, so I moved my cursor around the code, to trigger Quick Fixes.</p>
<p>When you’re done, go back to the <strong>Running Extension</strong> tab and stop the recording. Then, click on the most-left icon to download the <code class="language-text">.cpuprofile</code> you just recorded.</p>
<p>This CPU profile can be loaded in some DevTools. You can use the DevTools available in VS Code! Open the Palette again, and search for <strong>Toggle Developer Tools</strong>.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/toggle-devtools-ef334f5651b471517fc094a67de59ac9-bb136.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 14.572864321608039%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAq0lEQVQI123Kyw7BQACF4a6ZtkosSNUlQnW0JaWmoxlEkLDy/g/zmyBWFt/iXJxRGNHxA7yGwG+6lqBlBcIlcD3L/6slvM8uxFvbijpdHH15ouoz2tyozJW9uZDXD5bVFbmqSHJFkpU/CytdVyh9pNgZ5O5Gou5I9Xj/nbg8Idcly0KTbWvSjUZuahKbw5UhinN6wyn98Yz+6Gs8ZzCZMYgLwtRYB8LsZPuYF9+mVlp1mOl+AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="toggle devtools"
        title=""
        src="/static/toggle-devtools-ef334f5651b471517fc094a67de59ac9-c83f1.png"
        srcset="/static/toggle-devtools-ef334f5651b471517fc094a67de59ac9-569e3.png 240w,
/static/toggle-devtools-ef334f5651b471517fc094a67de59ac9-93400.png 480w,
/static/toggle-devtools-ef334f5651b471517fc094a67de59ac9-c83f1.png 960w,
/static/toggle-devtools-ef334f5651b471517fc094a67de59ac9-bb136.png 1194w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>If you’re familiar with Chrome DevTools, well, it’s the same. Open the <strong>JavaScript Profiler</strong> tab. This one is hidden: you need to reach for the 3 dots menu → More tools → JavaScript Profiler.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/javascript-profiler-4471a5826d07181f434e2e3643c4e52a-518f5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 53.45454545454545%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB3ElEQVQoz4WTW08TURSF+2f9G76jEp9JfFIkPvho1EJCCAZIfKlYKr3MrXPp3O+XFmnn88xQtQiNO1lZZ59k1l77ZE3HNE10XScMQ2RZpul930dRlJYNw2jvTDugN5DoD2Uc1yOKI/I0JVQkIk8lSVLiyKejqiqO42BZFkEQtCJRFP05e55PlmWkWU4QpShmyMy2kWQFW7AhhjXDNSF8KQd0lsslq9WKhn+fN/vNu1ogE65sYaARMoWJZgPDaLbysBwhyH+qrus17vqiKJjIKv3BNVNduNN0NMFhFLdDOn8/uI9tNa8KXEtDmVwz02XKxIXbnJvcJ3a1+w43xeaLhXj4BD8IWy7Kivm8QjJjDk5nvD2e8u7MZ/8s4815zuvzir3j6KEga9GyyJiqE66+f8OzTao8ZjWPGWkee0ce+19CXp3EvDzM2e0W7Hwu2elW2xzW6G7GSU/nw+mAr0Of/jTnYpwz0GI8S2U8vCIJZnCTtoPqRcyyCh8KrtYrf+ylPH3vs/sp5sXhgmdHP3lycMvzbo4qj+n/GBGEUQs/aDgW+fQfWZk7l1WZiWxNUKQRnmMyMzTKLCQV4XVct81q8zP8i87jEanbMI8mEr3LfhuRhhVtSiJy2GRyW/0C9xQ7HP+6pUUAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="javascript profiler"
        title=""
        src="/static/javascript-profiler-4471a5826d07181f434e2e3643c4e52a-c83f1.png"
        srcset="/static/javascript-profiler-4471a5826d07181f434e2e3643c4e52a-569e3.png 240w,
/static/javascript-profiler-4471a5826d07181f434e2e3643c4e52a-93400.png 480w,
/static/javascript-profiler-4471a5826d07181f434e2e3643c4e52a-c83f1.png 960w,
/static/javascript-profiler-4471a5826d07181f434e2e3643c4e52a-518f5.png 1100w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>From there, you can start profiling JS—but we already did that using VS Code Running Extension. You also have a <strong>Load</strong> button you can use to load your <code class="language-text">.cpuprofile</code>.</p>
<p><em>Note: on Mac OS, if your finder doesn’t show all file extensions, it might save the file as <code class="language-text">.cpuprofile.txt</code> and you won’t notice. If you can’t it that in DevTools, use the terminal to rename it with the proper extension (remove the <code class="language-text">.txt</code> part).</em></p>
<h3 id="analyze-the-profile"><a href="#analyze-the-profile" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Analyze the profile</h3>
<p>I prefer to use the Flame Chart, it’s much more visual.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/flame-chart-a2a10140a5d2011060ca1e0616b3b661-d50df.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 29.9860529986053%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABRUlEQVQY0z2Qy0rDUBCG88Ru3fgELlxUFAUREXEhIiI+gFshQgMSStqm5H47SXNtQtPkd+YEO/AzA2fmO/+M4jgOgiCAZdmI45hqH7NXFWcPKk7vf3By/Y23Lx1J5NNbKHtYYRjCdV0EkcBiZcFY29jYARTLnkDb7RZ1XaMsSzw9v2B2dYubu0ecX1zi/eMTnu8jihiWEMiTvU3ToChKlFUtVZQVFNvxsLEcxEkioaxUCJimCY8ciDia3Hg+8jyHECmM5RpJIgjaYDgc0Pc9DiyqFcP4haqqmM816LoOTdOQZRmaXSt/7boObdshLwrKrcyeH8Bxfeyoh2PEFOxaSVNBgPTojmEMEWk2uagq1LRaEEbyHLzJcm1SFhNsHKU4BG2mMJVV0SCLh/r9Xg6wqqrEjpwxsCB3fMOFsZInGIbhCP0H/gGy8byzxJP9jwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="flame chart"
        title=""
        src="/static/flame-chart-a2a10140a5d2011060ca1e0616b3b661-c83f1.png"
        srcset="/static/flame-chart-a2a10140a5d2011060ca1e0616b3b661-569e3.png 240w,
/static/flame-chart-a2a10140a5d2011060ca1e0616b3b661-93400.png 480w,
/static/flame-chart-a2a10140a5d2011060ca1e0616b3b661-c83f1.png 960w,
/static/flame-chart-a2a10140a5d2011060ca1e0616b3b661-d50df.png 1434w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/flame-chart-2-04285138b2cdd14bbd50ec39d0f0ab5c-71b64.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 70.51162790697674%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACwElEQVQ4y11SaXPaQAzl//+QfumVhPuGgIFwQwg2PtcXYAzGQIDQtLzKdptk4hnNWz1JTyuvYrZtwTQNWJYBXdchyVroG4b+CRkM04LGotyoxgzj7zkGYoxZUBQT8/maCAcqcynoRP4nZPoKlr2FaSyhqiYYm2Ox2LzlM8YQK2d5ZG9EtCse2uUNOlUPD4TtyuYfeh9wHcabxSUS30aoZkx07rfkrzFqbXE8nhGbNCTwdRq3twHrrt8s8D9z/3m5vUC/yENtO6GvdVxYEw/XP6CRqwx2zsa+sceO24Xmcz7sgg234mLPvfOBBXke50FOyVhX16Hv13wc+gdcf18RU+8ZrMIcXmNHiX6Ibt2DlFFglxYR98E23BZ2ZQE5q8K5X8NvUoO6D3+wpxuSoE7jzktLEnov2pKolmdYVBzsWodQZENNAt6t0a8o0YPk9TDOCgYcmmQ3OESCYllC68sD1lSg5hiGP8Ywizae4jz634eYJSUoGQ0ijRicpbQCKStjcjfFlHJGPx8xoAdSKhpwDf5hnWF6y9P1HYhJEXxcgJbTqFAmERFCQqBGGokqECgmE7ICI06FklXAJ3jMEjPoNR3BF5txKoa3U4iUNE4KeMpQ97SEISU+pmbkS5hSYcAP6FZBTChomBA/Ts/QvXnEOCFCbZiRINfV8SOlIF02Ec9rSFByPK/ilsZKUJM7ukmyqIfnr/EpUiUdhZqBdEmjs0pxieIMXHcRCY4FF82uAc08YSp6ZLRn7BkzxQ9R0g6EB0h0FiRa/PGWin3UOh7qnS1yVQtFboXh9BAJWosjZEWhF7rQptNO+Ru8vp7x63IK7fLBcH0Bs84kekJ3ckJvcka5uSJhH7xyQfAqMd064qGnYDjRIchLMGMLx33BfHnE3Dli6Z4jW52Je4aoHTHiA7Ej+k8nVFsrcL0dZupLKPgXCHfmWw/fDKwAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="flame chart 2"
        title=""
        src="/static/flame-chart-2-04285138b2cdd14bbd50ec39d0f0ab5c-c83f1.png"
        srcset="/static/flame-chart-2-04285138b2cdd14bbd50ec39d0f0ab5c-569e3.png 240w,
/static/flame-chart-2-04285138b2cdd14bbd50ec39d0f0ab5c-93400.png 480w,
/static/flame-chart-2-04285138b2cdd14bbd50ec39d0f0ab5c-c83f1.png 960w,
/static/flame-chart-2-04285138b2cdd14bbd50ec39d0f0ab5c-23e13.png 1440w,
/static/flame-chart-2-04285138b2cdd14bbd50ec39d0f0ab5c-10d8f.png 1920w,
/static/flame-chart-2-04285138b2cdd14bbd50ec39d0f0ab5c-71b64.png 2150w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>I’ll suppose you know <a href="https://developer.mozilla.org/en-US/docs/Tools/Performance/Flame_Chart">how to interpret Flame Charts</a>.</p>
<p>From this specific one, we can see 2 things:</p>
<ol>
<li>The extension <code class="language-text">parse()</code> the code repeatedly, which adds up and takes a lot of time in the end.</li>
<li>It runs one <code class="language-text">provideCodeActions()</code> per refactoring, which could also be optimized.</li>
</ol>
<p>That’s even clearer if we zoom in a bit:</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/flame-chart-2-zoomed-in-546da4efc8ba0afe5f9f5884671d469a-9aef4.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 25.119846596356666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABE0lEQVQY04WN3VKCYBRFef8nqalpQq00QkvBxDE1RS1KSNAyLUEsfnLG1adXedXFmj17n3P2kbSsSevSxjHCf7FrIeNWRE/30GQTS5vzfOuLfClY4bZXSAfyPbLiohpfqCJUxdFOjdWeFsW8oPvcNITXXQ6zPRR9zlX1k1J9KXZ8jM43klIe0ej6DIYRze6Mu847lpMKEiw7+aMpfSukZX5Qrr1SrC6otSMK12PO1RE5xUGrz5C0ms3Qttls1vykMWEYkApNkmiPOI5YrxOCZUTF8DjODXYFmYLF6cUjJ2cD8Wi6LXyh2X7A7D8xdCZMZwF+ELPwIxbBH4TflnkTH73ucZQxRcGYfMlBqbwh5y2KmssvbpZjKhvHz8IAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Flame chart before optimization, it's wide and has a lot of operations"
        title=""
        src="/static/flame-chart-2-zoomed-in-546da4efc8ba0afe5f9f5884671d469a-c83f1.png"
        srcset="/static/flame-chart-2-zoomed-in-546da4efc8ba0afe5f9f5884671d469a-569e3.png 240w,
/static/flame-chart-2-zoomed-in-546da4efc8ba0afe5f9f5884671d469a-93400.png 480w,
/static/flame-chart-2-zoomed-in-546da4efc8ba0afe5f9f5884671d469a-c83f1.png 960w,
/static/flame-chart-2-zoomed-in-546da4efc8ba0afe5f9f5884671d469a-23e13.png 1440w,
/static/flame-chart-2-zoomed-in-546da4efc8ba0afe5f9f5884671d469a-10d8f.png 1920w,
/static/flame-chart-2-zoomed-in-546da4efc8ba0afe5f9f5884671d469a-9aef4.png 2086w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>So I went back to the code and optimized for that.</p>
<p>I parsed the code only once, then gave the AST to all refactorings. Then, I collected the list of available refactorings and provided them to VS Code only once. Here’s the same profiling, after the changes:</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/flame-chart-after-optimization-0823b0473fd68eaefd9560c5a201d677-29c8d.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 91.63722025912838%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAACo0lEQVQ4y6VUaVfaQBTl//+KfuiXarWtYj2loiwJiCKGQCDBo0kgG0vIVkHW28cEKljb04Vz7rnvzh3uvMlkkuh0OlBVDe12zLreXus2NI1YX7HOxja+TlrXY2ispjnkGYaBhGWb6PZsOF2LoWMZsBwTNtUxNjXN6TnMc3bGY7D/UnMJSVSRS9dRq1iQxQHkmotmtQ+lPkST9AoKG9vyiNnctbfiluRC1SwkykUVe2/KuEgaKKRc8IRCarjm3Xrbe/ap/uLiMj3E6HGBRFux0Czcw6wPYNT6MMTeM7+sxf7P3lqb0gCzpzkStmCjeSDDzboIuBB+PthB8EK/6uWoLoSYj6hDS7QhH7Vg57rwigGGBf/vwfvwSkEcaFfp5M4ceIWAGf8EjgIv14GmYKF2KMG4sH506G2tzhba0a942x36dz7K7yoQPojoZvvw+OD/OhybTxAORNweVmGc27Tii8DCb4LWnstvB9pjCHu3aCUV+JyHkCaFtHXGfwoKDGnLi1Vg5I2RPaqDP1HQyNObT8ffyA8h5T00+ZB0hAYXoLkBH3NjU/NxrVyGmKwCvfEYxxkV6VKETDlE9spA/kpBS38kjFCjZ6xaUzyYv8KEsWpNMJlS4Gg2Q5rTkMo6ECTqSunAog8E+y3n6Pd7mM+mhAlm0wnjjWaYT2NNvFxS4JxSM7yGvU8ihHoXkmxAVlq4u1dhOz1o9Fkbej6CMIIfhAgIHmnPpxuyhSj6hsWCAhfTJXLFNt4fS7itOdStjmRKwul5C8WbAaqNCBW6r1zJQEWKUBY9XHAPqNRD5EsmimUT10KPtIvZfInEamc3dOn36WDkuyEFaUietXGUekCGXoXr2gSZoo1DOrQMPeczro+3+zf4fG6yOR9PZXzNWTSnR4HAd8s7FeBtU+zbAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Flame chart after optimization, it's narrow and shows less operations"
        title=""
        src="/static/flame-chart-after-optimization-0823b0473fd68eaefd9560c5a201d677-c83f1.png"
        srcset="/static/flame-chart-after-optimization-0823b0473fd68eaefd9560c5a201d677-569e3.png 240w,
/static/flame-chart-after-optimization-0823b0473fd68eaefd9560c5a201d677-93400.png 480w,
/static/flame-chart-after-optimization-0823b0473fd68eaefd9560c5a201d677-c83f1.png 960w,
/static/flame-chart-after-optimization-0823b0473fd68eaefd9560c5a201d677-23e13.png 1440w,
/static/flame-chart-after-optimization-0823b0473fd68eaefd9560c5a201d677-29c8d.png 1698w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>Much. Better. 😘👌</p>
<h3 id="anecdote-optimizing-for-performance-makes-code-less-intuitive"><a href="#anecdote-optimizing-for-performance-makes-code-less-intuitive" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Anecdote: optimizing for performance makes code less intuitive</h3>
<p>As you can see, profiling Abracadabra made me confident the problem was essentially due to every individual refactoring reparsing the same code. This was naive and I optimized so the code is now only parsed once.</p>
<p>But when I did so, I created issues that didn’t exist before! I had to tackle them.</p>
<p>Indeed, all refactorings now share the reference to the same AST. If one refactoring were to modify that reference, that would cause problems to the others. Cloning the AST could sound like a solution. I actually tried that and measure the performances after. It was worse. In fact, cloning the AST between each refactoring was <strong>more expensive</strong> than parsing the code each time.</p>
<p>That’s the heart of performance optimization: don’t guess, measure. Sometimes you’ll guess right. Sometimes, you won’t.</p>
<p>The actual fix was to ensure each refactoring wouldn’t mutate the AST when running for Quick Fixes. I had to introduce a bit more complexity in the code to optimize it. That’s usually the case when you optimize for performances. That’s why I follow Kent Beck’s mantra. If the code is simple enough, it’s easy to tweak it where necessary, for performance reasons.</p>
<p>Oh and a useful tip: when you do that, leave a comment to explain why this part of the code is not simpler. Your future-self and colleagues will thank you.</p>
<h2 id="conclusion"><a href="#conclusion" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>If you’re developing a VS Code Extension, I hope this guide would have helped you to find and fix performance issues.</p>
<p>If you have a problem with your VS Code performances in general, I suggest you read <a href="https://github.com/microsoft/vscode-wiki/blob/master/Performance-Issues.md">their wiki page on performance issues</a>,</p>
<p>If you’re using VS Code to code in JavaScript or TypeScript, I can only recommend you give a try to <a href="http://bit.ly/vscode-abracadabra">Abracadabra</a>. I craft these automated refactorings so they are useful and quick to use. It should save you a lot of time every day. It does for me 🙂</p>
<p>Finally, I wish I made you think twice about handling performance issues. Make it work, make it right, make it fast. What do you think?</p></div><div class="post-single__meta"><span class="post-single__date">Published 26 Nov 2019</span><span class="post-single__comments"><a href="https://mobile.twitter.com/search?q=undefined" target="_blank" rel="noopener noreferrer"><span role="img" aria-label="Speech balloon">💬</span> <!-- -->Discuss this article on Twitter</a></span></div></div><div class="post-single__footer"><hr/><div class="post-single__tags"><ul class="post-single__tags-list"><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/tags/vscode/">vscode</a></li><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/tags/performance/">performance</a></li><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/tags/side-project/">side-project</a></li></ul></div><div class="post-single__footer-text">I write about web development, agile practices and personal organization.<ul class="twitter"><li><a class="twitter-share-button" href="https://twitter.com/intent/tweet?via=nicoespeon" data-size="large">Tweet</a></li><li><a class="twitter-follow-button" href="https://twitter.com/nicoespeon" data-show-count="false" data-size="large">Follow @nicoespeon</a></li></ul></div></div></div></div></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-39957541-2', 'auto', {});
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-post-template-jsx","jsonName":"en-2019-11-fix-vscode-extension-performance-issue-f2c","path":"/en/2019/11/fix-vscode-extension-performance-issue/"};window.dataPath="610/path---en-2019-11-fix-vscode-extension-performance-issue-f-2-c-297-OKvJbeFtOTlvil4mk3btDJPg70A";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-a28781cee54de6f2bd9c.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-5f2b74aaa9780afd7bf0.js"],"component---src-templates-page-template-jsx":["/component---src-templates-page-template-jsx.20eefe64b5c91dc9fdf9.css","/component---src-templates-page-template-jsx-58ac45933bb0bf6d3254.js"],"component---src-templates-post-template-jsx":["/component---src-templates-post-template-jsx.8973a9913c53eab5adc6.css","/component---src-templates-post-template-jsx-fe37b511731a90ee6c68.js"],"component---src-templates-tag-template-jsx":["/component---src-templates-tag-template-jsx.34b8bc1aa60cfb20f0d8.css","/component---src-templates-tag-template-jsx-4d1353b0eb21b1b39ec1.js"],"component---src-templates-category-template-jsx":["/component---src-templates-category-template-jsx.34b8bc1aa60cfb20f0d8.css","/component---src-templates-category-template-jsx-6f2742fbc3298b407e3a.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-7856d8e49ab062d7bb70.js"],"component---src-pages-categories-jsx":["/component---src-pages-categories-jsx-d747233b22c5f74e6799.js"],"component---src-pages-fr-categories-jsx":["/component---src-pages-fr-categories-jsx-af2ca80329593aff3b82.js"],"component---src-pages-fr-index-jsx":["/component---src-pages-fr-index-jsx.34b8bc1aa60cfb20f0d8.css","/component---src-pages-fr-index-jsx-2ef5c52e595de12b8581.js"],"component---src-pages-fr-tags-jsx":["/component---src-pages-fr-tags-jsx-287f1f55c3c9a087eb29.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx.34b8bc1aa60cfb20f0d8.css","/component---src-pages-index-jsx-f009cd138e1df3aeee40.js"],"component---src-pages-tags-jsx":["/component---src-pages-tags-jsx-7714f8a09ce64c52a289.js"]};/*]]>*/</script><script src="/webpack-runtime-dde33867ef247f03f606.js" async=""></script><script src="/0-1fc3bea78341134a4e47.js" async=""></script><script src="/2-9d62d26dd2cdaa76a942.js" async=""></script><script src="/app-a28781cee54de6f2bd9c.js" async=""></script><script src="/component---src-templates-post-template-jsx-fe37b511731a90ee6c68.js" async=""></script><script>window.twttr = (function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0],
                  t = window.twttr || {};
                if (d.getElementById(id)) return t;
                js = d.createElement(s);
                js.id = id;
                js.src = "https://platform.twitter.com/widgets.js";
                fjs.parentNode.insertBefore(js, fjs);

                t._e = [];
                t.ready = function(f) {
                  t._e.push(f);
                };

                return t;
              }(document, "script", "twitter-wjs"));</script></body></html>