{"data":{"site":{"siteMetadata":{"title":"@nicoespeon's blog","subtitles":{"en":"I write about web development, agile practices and personal organization.","fr":"J’écris sur le développement web, les pratiques agiles et l’organisation personnelle."},"author":{"name":"Nicolas Carlo","twitter":"nicoespeon"},"url":"https://www.nicoespeon.com"}},"markdownRemark":{"id":"38a68bdd-6cad-5394-951e-6ff859797410","html":"<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.62516212710766%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACCElEQVQoz1VS2W7bMBDU/39Kgb4XSIMESd3EdpwmtnPYlg9JtmQdPHTwJqWsohZICQoYLciZ5cx6bdt2n6vtelAq+la8GKtb11proeJaN4sny2wO+FQdJ8exj9fCCPj1gjBgnPWX/7HsyZYK6rRbJ6uHeFrL2ra2YDmR+Ca8nh7Hk9P4IZ68pEuvc92nZKerWmrRaCZsz+qcE0pwzYH0QHYAoJ1GNr2Ma7do83R+9AKyn6dPwnAexUkRLNPFa7YIUSCkgMZTdp7F09+H27Q69wquW6fviCHK6V008hrecMutMyBvjdZKMNNs8jVlRDk5im6u9j+NtsaZSpSM8SAJhBawJ6d7b3gneEMIBpDVyYX/Y0e2s+N0l2yhwljvSED399HIgYgx/TGWbcnGAz5llZQySRJUoAIXjWmklpQSxprXfBmeA+gWpJhqBndyls2T56v9pfdevIGTUDIWSM0Qj9YauDDGtKZgT1zF17vLAB/SJl0kz2u02qBVrStvSPItf4V4XeeYYqv8nXICdYRRFIVK6R32L/2LdbGSVgb0ENenYS48+GBbZwklUsk/yeP3xbdxeAcxKqXO6PzLvx0SqsoKI/x1ov4a1nuQZU3dQNW0+iVf+GiTVdnjZpahbDgAXEIIMAjSJQL/dxmmAt5ZliXgLfGX2SIqw2MdwXh1X5bQfE92iBeAPwAKbaGykjsl9gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"cover\"\n        title=\"\"\n        src=\"/static/cover-75379648f7083acdb0f5acd535838e5c-c83f1.png\"\n        srcset=\"/static/cover-75379648f7083acdb0f5acd535838e5c-569e3.png 240w,\n/static/cover-75379648f7083acdb0f5acd535838e5c-93400.png 480w,\n/static/cover-75379648f7083acdb0f5acd535838e5c-c83f1.png 960w,\n/static/cover-75379648f7083acdb0f5acd535838e5c-23e13.png 1440w,\n/static/cover-75379648f7083acdb0f5acd535838e5c-69a3e.png 1542w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>I currently work as a web developer at Busbud.</p>\n<p>Part of our stack is the public website that you can see at <a href=\"https://www.busbud.com/\">https://www.busbud.com</a>. The first commit of its source code was made on January 2011. Today is December 12th, 2018. It has been almost 8 years!</p>\n<p>For 8 years, the codebase has been growing. Today, code is still constantly updated to add new features, adopt or remove experiments, fix bugs… As we work, we need to deal with existing, working, legacy code and ensure nothing breaks when we change it.</p>\n<p>Today, I’d like to tell you about the styles part.</p>\n<h2 id=\"a-lot-of-sass-files\"><a href=\"#a-lot-of-sass-files\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A lot of Sass files…</h2>\n<p>A choice has been made, long time ago, to use <a href=\"https://sass-lang.com/\">Sass</a> as a pre-processor for our stylesheets.</p>\n<p>This is great. It simplifies maintenance of styles thanks to variables, mixins and other niceties Sass brings to us.</p>\n<p>Among the niceties, we do use <code class=\"language-text\">@import</code> a lot. It allows us to import partial files into others and compile them into a single CSS stylesheet. Again: this is great. It allows us to split styles into smaller chunks (convenient for development) and get a single stylesheet in the end (convenient for production).</p>\n<p>But <code class=\"language-text\">@import</code> creates dependency relationships between Sass files. Today, we face issues of dependency graph management in a growing codebase. Now, I’m not talking about critical problems like circular dependencies − Sass does a great job dealing with that. I’m talking about understanding the dependency graph as a whole. It usually boils down to these questions:</p>\n<ul>\n<li>In which final CSS will this style be compiled to?</li>\n<li>Will this style be compiled into a CSS file where it’s not needed?</li>\n<li>Is there any file not imported anymore?</li>\n<li>Is there any (useless) duplicated import of the same partial?</li>\n</ul>\n<p>These are tricky questions to answer when you have a lot of files.</p>\n<p>The dependency graph of our codebase is not trivial. It started with a bunch of Sass files along Jade templates ; now we miss a clear architecture to maintain our styles with ease. Hopefully, we’ve identified this technical debt, and we’re taking actions to pay it back.</p>\n<p>But, until then, we have to work with this complicated Sass codebase.</p>\n<p>Now, to visualise what we’re working with, I realised we need a tool to turn on the light.</p>\n<h2 id=\"turn-on-the-light-please\"><a href=\"#turn-on-the-light-please\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Turn on the light, please</h2>\n<p>I first went to <a href=\"https://www.npmjs.com/package/sass-graph\">sass-graph</a>. It’s a library which computes the dependency graph of a Sass codebase. Unfortunately, it was only able to output some sort of graph in my terminal, or a JSON structure. But to answer rapidly previous questions, I needed something <strong>visual</strong>.</p>\n<p>Thus, I decided to <em>plug</em> sass-graph with a rendering library:</p>\n<figure>\n  <blockquote>\n    <p><a href=\"https://github.com/nicoespeon/sass-graph-viz\">sass-graph-viz</a></p>\n    <footer>\n      <cite>Draw a visual graph of Sass dependencies</cite>\n    </footer>\n  </blockquote>\n</figure>\n<p>The difference is that sass-graph-viz generates a visual graph of dependencies in the browser.</p>\n<p>You can use it as a CLI tool, as illustrated in this gif (a demo of v1):</p>\n<p><img src=\"/demo-07ef05a2624944f6de4b49250710b39d.gif\"></p>\n<p>You can quickly try it out with npx: <code class=\"language-text\">npx sass-graph-viz path/to/your/scss</code></p>\n<p>Or, you can install it with npm: <code class=\"language-text\">npm i -g sass-graph-viz</code></p>\n<p>Then use it in your terminal:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ sassgraphviz --help\n  Usage: sassgraphviz [options] &lt;target&gt;\n\n  Options:\n    -e, --exclude-externals  Omit files that are not under given target\n    -s, --simple             Generate a simpler visualization (not recommended for complex graphs)\n    -p, --port &lt;port&gt;        Port to use [3000]\n    -h, --help               Output usage information\n\n  Examples:\n    sassgraphviz assets/scss\n    sassgraphviz .\n    sassgraphviz main.scss\n    sassgraphviz main.scss -s -e -p 3001</code></pre></div>\n<p>Alternatively, you can use the alias <code class=\"language-text\">sgv</code> if <code class=\"language-text\">sassgraphviz</code> is too cumbersome to type.</p>\n<h2 id=\"how-is-this-built\"><a href=\"#how-is-this-built\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How is this built?</h2>\n<p>It’s merely a plug of something that generates the dependency graph (sass-graph) and a graph rendering library. It exposes a CLI for convenient usage, and uses the browser to render the graph.</p>\n<p>For graph rendering, I first went for <a href=\"https://github.com/mdaines/viz.js\">viz.js</a> because the API was simple and the result looked great.</p>\n<p>The core idea of sass-graph-viz is:</p>\n<ol>\n<li>Expose a CLI command to get the path to the directory I want to parse</li>\n<li>Delegates to sass-graph the generation of dependencies graph</li>\n<li>Translate sass-graph’s Graph into my own <code class=\"language-text\">Graph</code> model</li>\n<li>Delegates to viz.js the rendering of the <code class=\"language-text\">Graph</code> in the browser</li>\n</ol>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 450px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 175.99999999999997%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAjCAYAAACU9ioYAAAACXBIWXMAABYlAAAWJQFJUiTwAAADc0lEQVRIx6VWi1baQBD1///JVgsCR5LykISqpVUegUAiD3kl+7id2SSIBaK0OWdOltndm5mde2e5QM6jtT7Lz8/FqQ3ZJik14kgak+LNfwr0Q8BRP8ZkBIRjHgvEW/WvgGZkgCqVe9Tqv+AN4v8HDHyNRr2LZrOL4eCMCPfPZj9ln6IaDTT8IRkDRurgWPbBTwAqKJUYP0EQYuyPzTjzfwiYl8ZyucR8Pv8UhQ4iFELgpljEzc0NqtUqSvS2bRuWZePu7g4W+0olVC0LURQdRvh32CIWcFotKkQDjuNSMZoGpNVy4Lpt1Gs11Gp1Ax5F8cFxXXzEfH7W6xVeXxf4jKp2EbIKtmuJzUpgvYyNrV4jKAm4rQdUShY0jdmXzfPazUpC7FV+B/gyERh5GrMXYMoWki9Ixv5QGQ7Op6kvTI3mJj7ZUDAa9FuE2ixuNnpUjDsqxk+yBzp8B7e3D3R+fUPscqWNRuPZ+CzrEcVCA/X6s/mITim2A5yFGg/3IcpllyrYMYBmI4E7jkcbn/Ct0IT9vYOrqxp9uGU+3nKGCCcHgCBAgfEwiZTTnqVpzUxaCuORNHPTIJ0nm5MFxPfAFyYovQ+o1FubyizaClOI8SigM/RNgeIt6/n9OiU/TRu9o81qtUw9+nO02W8KbJmOXcdBoVDE5eWlGWfZ/L3+aITHFg36fVRvqwT4Bb1u9+S6XYR5jSHzrSjl5fI19ancBnEQIStGxGpXFH7ufzxSlLYZs4/n2Y7dMe8ApSBF9KihekyFRAVMi2FfU5U10YorTsqheb5n+k+CPqDyAGmTF+HrVxuFYgPXVzaur2t0p7QN0ZncpbJjlFOuuOg9b0jHOh/Q92Ji/8BIjOVVp7fjeiRDF+22b0CbzR4su2MA4zxAJigLnaX0MklUweZ7ktKVxsfGN6HxU8PY7zQn7xQllTEppPGFId0p40mahUzmyLTai+59hMepk/2eTqd0UQW5a07SZp+smfQWizlms+k734fEPpZ6tBFm/w/3EbeVhIfbtTDSOyWGk4DML68rsZjBdGuP/uNw+xr2JJYLeS4gqYVuyM7jHJdfqoYqtv2TOOji6Yk6zyJZcxZgTIC/O0tD4FrtNyoEVqQu3X3eEqA6FzBJedSnLj1LOzelyyn7niJAef4Z8pv/GHFhoo1M30m31jlF+QNHkpjzGNOv7wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"graph core idea\"\n        title=\"\"\n        src=\"/static/graph-core-idea-bc4c3d421000b69878f99d28bb1672a8-b0fbe.png\"\n        srcset=\"/static/graph-core-idea-bc4c3d421000b69878f99d28bb1672a8-bd530.png 240w,\n/static/graph-core-idea-bc4c3d421000b69878f99d28bb1672a8-b0fbe.png 450w\"\n        sizes=\"(max-width: 450px) 100vw, 450px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>Now you might wonder: what’s the point in parsing sass-graph outputs into another <code class=\"language-text\">Graph</code> model?</p>\n<p>I’d say this is the heart of the lib. This is my domain. Now, it’s probably really thin and might feel <em>useless</em>, but I have a few arguments in favor of this choice:</p>\n<ol>\n<li>The rendering lib doesn’t need all of the details sass-graph generates in its “Graph” modelling.</li>\n<li>The “Graph” from sass-graph doesn’t quite fit the rendering lib expected format anyway. A parsing is necessary at some point.</li>\n<li>Maybe I’ll swap sass-graph for another tool, if I found a better one. If so, I’d better not tie the rendering lib to sass-graph implementation.</li>\n<li>I don’t know yet all the features I’ll need to implement with the rendered graph. I don’t want to be limited by sass-graph capacity.</li>\n</ol>\n<p>I quickly got it working for simple structures with viz.js. It helped me set up the architecture of the solution, exposing a CLI command to generate the graph.</p>\n<p>For example, running <code class=\"language-text\">sass-graph-viz assets/scss/</code> would produce following result:</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 822px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 68.61313868613139%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXklEQVQ4y32TW8+CMAyG+f8/ysR7LrwzRsADkQjiWSNyqnmalOzD+TVZNrru3dN2BH3fC+bOtr7f7zqu16tUVfW177NgLOSK3W43ieNYsiyT4/EoTdN4Y78E3dF1nW5AtNvtZL1eS5qmKmo2PuP6At9NbdvK4XCQx+Oh6dZ1rbRQ2oWuuRqBOd/vt6Z0uVwkz3MVwWazmZRlOVBzkaXPtwujhNCcTiclYJ5Op0pIMOJRFKkIa+jYm0wmUhSFPJ9P9ZPFQGhi1Gmz2WgQAVCQMj72oObw+XxWOmo6n891Hz8aKkiqiO73ex0cgARhyPAhyJpYBiWwRtlFkA81tFTM6TaHVLjdCLDX66UZWMyfGo477HsO2GKxkNVqpRmEYfjzZ/h6h74giEiPN7ndbiVJEvX5zgRjEt/bon78OczL5VLXdNnepHv2p6Dro6s0jroxM2iO79/+l3DsHzfOB/EBYDNCcjWWorIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"simple graph\"\n        title=\"\"\n        src=\"/static/simple-graph-f77f5025b5b613c1d7604fd5a82a28dd-18c80.png\"\n        srcset=\"/static/simple-graph-f77f5025b5b613c1d7604fd5a82a28dd-fd329.png 240w,\n/static/simple-graph-f77f5025b5b613c1d7604fd5a82a28dd-51707.png 480w,\n/static/simple-graph-f77f5025b5b613c1d7604fd5a82a28dd-18c80.png 822w\"\n        sizes=\"(max-width: 822px) 100vw, 822px\"\n      />\n    </span>\n  </span>\n  </p>\n<h2 id=\"but-my-graphs-are-more-complex-than-that\"><a href=\"#but-my-graphs-are-more-complex-than-that\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>But my graphs are more complex than that!</h2>\n<p>Otherwise, I wouldn’t have needed this tool anyway.</p>\n<p>I moved to more realistic examples, running the tool against the codebase I was working on. There I confirmed I needed a better rendering lib to handle complex graphs.</p>\n<p>I found <a href=\"http://visjs.org/\">vis.js</a> − yeah, the one-letter difference is subtle. The lib showcases very cool, interactive graphs and the API looked nice. It was the solution I was looking for!</p>\n<p>As the graph generation, the domain and the rendering were independent, is was really just about plugging another rendering adapter. One that would do the rendering with vis.js.</p>\n<p>I enhanced the CLI a bit so vis.js became the default rendering lib and viz.js would be opt-in (with the <code class=\"language-text\">-s, --simple</code> option). I also provided a shorthand alias, so I wouldn’t need to type <code class=\"language-text\">sassgraphviz</code> every time.</p>\n<p>At that point, running <code class=\"language-text\">sgv assets/scss/</code> on previous example would produce following graph:</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 784px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 59.43877551020408%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVQoz5WTX0vDMBTF+7kFHwQRRJhMFHwQ/AoFn3wQBHUboqyCTGWMIWxs6/51Nm1ZbtJjk9qadXXMS0PSm/DLPfe0FpKI4zgfKvpBD4+DBjpeG0kW+jH2N4VVBrzq2ti/2cPl8wUY95GdMec/gcWDXC4REEMUhwiXIZjPVi4sGzKWeqh1XqGSpZKBYGu3cs6xbVimhDlNUWxBtu95HlzX1XBdlZQQJMCWDK3ZKz7mb4k6nlYYUICXaRP3o1uIWKCsr47jwLZtDVU5EgQeEd4nLVTqRzipVTAMBymwMarh8O4A1YdjfPpdDVDyzd5GUQTGWKkpC+6Bkf/rspAC48jF06wOkjwHptAfeULkgLKWZPmVHmqHlSlmEcmaiNYAmZFFeO5yJpEkaegXLTDhY/SnPQ3c9lu0zFszqIKdO6fYvd7BWaOq302p//5T1DxkA3TmbT0XDdoU3yDMpcAuZ5XGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"graph\"\n        title=\"\"\n        src=\"/static/graph-47b11755a0e01f2545b784d352084143-949f9.png\"\n        srcset=\"/static/graph-47b11755a0e01f2545b784d352084143-101f6.png 240w,\n/static/graph-47b11755a0e01f2545b784d352084143-bee96.png 480w,\n/static/graph-47b11755a0e01f2545b784d352084143-949f9.png 784w\"\n        sizes=\"(max-width: 784px) 100vw, 784px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>Few things to say here:</p>\n<ul>\n<li>Unlike previous graph, this one is interactive. You can zoom, select and move nodes, as showcased in demo gif.</li>\n<li>We visually distinct regular Sass files (e.g. <code class=\"language-text\">main.scss</code>) from partials (e.g. <code class=\"language-text\">_header.scss</code>). Partials are meant to be imported. I thought the distinction would be interesting.</li>\n</ul>\n<p>And here’s where the separation of the domain started to pay off: I realised that I could add features to my graph, so it would be more useful. Identifying partial files is not the role of sass-graph, nor the one of the rendering lib. This belongs to the domain I created here. That also means it can be unit tested really easily: no need to manipulate actual Sass files, nor to spy on the browser.</p>\n<h2 id=\"features-i-want-moar\"><a href=\"#features-i-want-moar\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Features, I want moar!</h2>\n<p>From usage, I noticed few quirks that I fixed. I also identified (and implemented) useful features.</p>\n<p>The first one is the ability to exclude “external files” from the rendered graph. By “external files” I mean files that are outside the scope of the target folder. For example, we do import some source files from Bootstrap package which lives in <code class=\"language-text\">node_modules/</code> − which is probably not the best idea, but these things happen. As I certainly can’t change all of these Bootstrap Sass files, I’d prefer they don’t show up and clutter my graph. I want to think about what I <em>can</em> change.</p>\n<p>So here it is: <code class=\"language-text\">sgv -e assets/scss/</code> will omit these external nodes from the generated graph.</p>\n<p>Another feature from sass-graph-viz is the ability to focus on a file only. It’s very handy to only see a subset of the Sass files, the ones that are linked to a specific file. Intuitively, <code class=\"language-text\">sgv assets/scss/core.scss</code> does the trick and focus on <code class=\"language-text\">core.scss</code> dependencies (parents and children) only.</p>\n<p>The last feature I wanted to highlight is the guidance the tool can provide. After all, since it computes the dependency graph of my Sass files, it could certainly detect suspicious patterns. One I identified was “the orphan partial” pattern. An “orphan partial” is a partial file that doesn’t have a parent. Which is weird, as partials are meant to be imported. These are likely dead code we can remove. And it paid off: I was able to detect some of them in our codebase, and get rid of these unused files!</p>\n<p>Typically, the tool would render suspicious nodes in red, like so:</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 45.56451612903226%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9klEQVQoz51SywrCMBDM/x/04AcoiKce/AkPFhGKYLVa76W1Ldrah2kydgMVk/oAF5awm8zszm4Y/jQppTqbqkK83SL2PEjOwX6BOiCdQgotJquiCM54DGc2Q5PnOqFJYILN7sw8GXsFqwdSj6krsuv9Aj89ouC3Humrs171D/LX4Qqj5RD7yFVxV6hHqC7bwfIsgxQNvcQtDTE/WJhuJvAuLvImUwTkZVHqigzpDO1mPMvCYjBA6Dh0izIMcIoP2J1dlLzQWldjEKI3zychJao0RREE6gt823YHzlo1vu+jrus3HX4AdxLfbT1JEti2jbz9JibhAxsEvwpy8YY6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"orphan nodes\"\n        title=\"\"\n        src=\"/static/orphan-nodes-dfed4e1542a62f05391030e2b7f5180d-c83f1.png\"\n        srcset=\"/static/orphan-nodes-dfed4e1542a62f05391030e2b7f5180d-569e3.png 240w,\n/static/orphan-nodes-dfed4e1542a62f05391030e2b7f5180d-93400.png 480w,\n/static/orphan-nodes-dfed4e1542a62f05391030e2b7f5180d-c83f1.png 960w,\n/static/orphan-nodes-dfed4e1542a62f05391030e2b7f5180d-da6c5.png 992w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  </p>\n<h2 id=\"this-was-fun\"><a href=\"#this-was-fun\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>This was fun</h2>\n<p>I had a great time building this little tool. So far, it was useful to understand the relationship between all of these Sass files. It might become useless when we’ll solve the root cause of this mess, but it’s a handy tool to work with a complicated Sass codebase.</p>\n<p>I hope it might be useful to you, if you face such situation. If you do, let me know about it!</p>\n<p>If you have any comment, I’ll be happy to reply here or directly on <a href=\"https://github.com/nicoespeon/sass-graph-viz/issues\">GitHub issues</a>.</p>\n<p>PS: If you’re into <a href=\"http://fideloper.com/hexagonal-architecture\">Hexagonal Architecture</a>, what I described may sounds like ports &#x26; adapters. It is. Just, I didn’t made interfaces &#x26; the hexagon explicit yet (functions and types were simple enough to do so).</p>","fields":{"tagSlugs":["/tags/sass/","/tags/dataviz/","/tags/legacy-code/"],"slug":"/en/2018/12/tool-work-with-complicated-sass-codebases/"},"timeToRead":7,"frontmatter":{"title":"I built a tool to work with complicated Sass codebases","tags":["sass","dataviz","legacy code"],"date":"2018-12-12T00:00:00.000Z","description":"Introducing sass-graph-viz, a tool to draw a visual graph of Sass dependencies."}}},"pageContext":{"slug":"/en/2018/12/tool-work-with-complicated-sass-codebases/"}}