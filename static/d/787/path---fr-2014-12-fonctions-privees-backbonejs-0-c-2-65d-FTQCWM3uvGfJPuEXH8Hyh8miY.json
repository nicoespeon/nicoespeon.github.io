{"data":{"site":{"siteMetadata":{"title":"@nicoespeon's blog","subtitles":{"en":"I write about web development, agile practices and personal organization.","fr":"J’écris sur le développement web, les pratiques agiles et l’organisation personnelle."},"author":{"name":"Nicolas Carlo","twitter":"nicoespeon"},"disqusShortname":"nicoespeon","url":"https://www.nicoespeon.com"}},"markdownRemark":{"id":"7b23fc12-06b8-5d83-b0e4-a701990c119d","html":"<h2 id=\"fonctions-privées-cest-à-dire-\"><a href=\"#fonctions-priv%C3%A9es-cest-%C3%A0-dire-\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fonctions privées, c’est-à-dire ?</h2>\n<p>Pour faire simple et concis : une fonction / méthode privée est une méthode qui n’est pas exposée et ne peut donc pas être appelée “de l’extérieur”.</p>\n<p>Il s’agit donc d’une notion de <strong>portée</strong>, ni plus ni moins.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">yolo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">privateMethod</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"can't be accessed outside of `yolo()`\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">var</span> privateVar <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n\n  <span class=\"token comment\">// ici, on peut appeler `privateMethod` si ça nous chante.</span>\n  <span class=\"token comment\">// ici, `privateVar` vaut `true`.</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token string\">\"that's all you've got from me!\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ici, `privateMethod` n'existe pas.</span>\n<span class=\"token comment\">// ici, `privateVar` n'est pas défini.</span>\n\n<span class=\"token function\">yolo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// affiche \"that's all you've got from me!\"</span></code></pre></div>\n<p>Cette notion prend tout son sens lorsqu’on utilise le <em>module pattern</em>.</p>\n<p>Pour en savoir plus sur ce point, je vous recommande cet article parmi tous les autres : <a href=\"http://toddmotto.com/mastering-the-module-pattern\">Mastering the module pattern</a>, simple et efficace.</p>\n<p>Et donc concrètement, ça donne ce genre de code :</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> MyModule <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// tout un tas de trucs encapsulés -> privés si pas exposés.</span>\n  <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">_cantTouchThis</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'I just met you!'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">var</span> _nbOfCats <span class=\"token operator\">=</span> <span class=\"token number\">3</span>\n\n  <span class=\"token comment\">// ce que l'on retourne lorsque la fonction est exécutée</span>\n  <span class=\"token comment\">// -> ce qu'on expose (= public).</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    nbOfRainbows<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n    sayHi<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hi!'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    logNumberOfRainbows<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>nbOfRainbows<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    logNumberOfCats<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>_nbOfCats<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    touchThis<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hey!'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">_cantTouchThis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Ceci nous permet donc de toucher à la partie publique, <strong>l’interface</strong>, sans pour autant avoir accès à la partie privée :</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">MyModule<span class=\"token punctuation\">.</span>nbOfRainbows <span class=\"token operator\">=</span> <span class=\"token number\">42</span>\nMyModule<span class=\"token punctuation\">.</span><span class=\"token function\">logNumberOfRainbows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// affiche \"42\"</span>\nMyModule<span class=\"token punctuation\">.</span><span class=\"token function\">logNumberOfCats</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// affiche \"3\"</span>\nMyModule<span class=\"token punctuation\">.</span><span class=\"token function\">touchThis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// affiche \"Hey!\" \"I just met you!\"</span></code></pre></div>\n<h2 id=\"fonctions-privées-et-pour-quoi-faire-\"><a href=\"#fonctions-priv%C3%A9es-et-pour-quoi-faire-\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fonctions privées… Et pour quoi faire ?</h2>\n<p>Question légitime. Personnellement, je vois l’intérêt d’une fonction privée ainsi :</p>\n<ul>\n<li>elle <strong>simplifie l’interface publique</strong> en s’occupant des détails techniques d’implémentation</li>\n<li>elle <strong>n’a pas à être testée unitairement</strong></li>\n</ul>\n<p>Le premier point coule généralement de source. Le second point découle du premier, mais rend souvent perplexe. Je m’explique…</p>\n<h2 id=\"tests-unitaires-et-fonctions-privées\"><a href=\"#tests-unitaires-et-fonctions-priv%C3%A9es\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tests unitaires et fonctions privées</h2>\n<p>Pour tester notre module, on l’instancie, puis on va prendre chacune de ses méthodes et vérifier leur sortie à partir d’une entrée (variables + contexte). On teste <em>unitairement</em> les méthodes exposées en prenant garde de faire varier l’entrée pour tester tous les cas de figure et obtenir une bonne couverture de tests.</p>\n<p>On peut d’ailleurs résumer la pratique du <strong>Test Driven Development</strong> (TDD) :</p>\n<ul>\n<li>écrire d’abord le test avec les cas de figures requis pour une fonctionnalité</li>\n<li>coder la méthode afin de passer ces tests</li>\n<li>retravailler le code à la fin pour le nettoyer. Tant que les tests passent on sait qu’on n’a rien cassé.</li>\n</ul>\n<p>L’étape de <em>refactor</em> vient en dernier car l’objectif est de produire un code qui fonctionne, puis de faire des optimisations.</p>\n<p>Pour revenir à la question des méthodes privées : elles ne sont pas exposées, donc <em>techniquement</em> elles ne sont pas testées unitairement. Pas directement en fait.</p>\n<h2 id=\"quelques-considérations-sur-les-fonctions-privées\"><a href=\"#quelques-consid%C3%A9rations-sur-les-fonctions-priv%C3%A9es\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Quelques considérations sur les fonctions privées</h2>\n<p>Le point sur les tests unitaires peut laisser perplexe selon la manière dont on considère et utilise la notion de fonction privée. Je dirais qu’il y a 2 façons de voir les choses :</p>\n<ol>\n<li>je code tout en privé et j’expose que ce qui doit l’être <em>in fine</em></li>\n<li>les fonctions privées sont le fruit du refactor de mes fonctions publiques</li>\n</ol>\n<h3 id=\"comment-choisir-entre-privé-et-public-\"><a href=\"#comment-choisir-entre-priv%C3%A9-et-public-\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Comment choisir entre privé et public ?</h3>\n<p>Si on considère que l’on fait du TDD… on développe l’interface publique <strong>avant</strong> (puisque c’est ce que testent les tests).</p>\n<p>Personnellement, je code mes tests (qui ne passent pas), puis mon interface publique : les méthodes publiques ou les <em>event handlers</em> (petit point là-dessus plus bas, pour ceux qui s’interrogent). Rien de privé chez moi à ce stade.</p>\n<p>Les fonctions privées proviennent de l’étape de refactor, finalement. Et puis si je n’ai pas le temps de nettoyer, au moins ça marche.</p>\n<p>Finalement, <strong>les tests unitaires testent l’interface publique</strong>.</p>\n<p>Les méthodes privées sont testées à travers les méthodes publiques. On peut se dire que tester le détail de l’implémentation technique serait judicieux pour mieux debugguer, mais c’est un coût d’implémentation et de maintenance conséquent. À l’inverse, je peux ici modifier / refactor mes méthodes privées autant que je veux tant que mon module fonctionne.</p>\n<p>À choisir : autant tester plus de scénarios sur l’interface publique. La coverage indiquera si oui ou non on teste les méthodes privées en passant.</p>\n<h3 id=\"le-cas-des-events-handlers\"><a href=\"#le-cas-des-events-handlers\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Le cas des events handlers</h3>\n<p>L’interface publique, c’est donc ce qui compte.</p>\n<p>Qu’en est-il des événements qui font réagir notre module ? Les events handlers (= <code class=\"language-text\">onClick()</code> &#x26; co) doivent-elles être publiques pour pouvoir être testées ?</p>\n<p>En fait, non.</p>\n<p>On parle d’événements. Notre module écoute des événements et réagit en fonction. Les tests doivent donc déclencher le comportement en émettant les événements, puis en observant le résultat attendu (impact sur le système, etc.). La méthode liée peut bien être publique ou privée, ce n’est pas ce qui compte au moment où l’on teste la manière dont le module répond à l’événement.</p>\n<h3 id=\"préfixer-avec-_\"><a href=\"#pr%C3%A9fixer-avec-_\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Préfixer avec ”_”</h3>\n<p>Par convention (assez répandue), on préfixe les noms des méthodes / variables privées avec un <code class=\"language-text\">_</code>.</p>\n<p>C’est également ce que je fais pour 2 raisons :</p>\n<ol>\n<li>c’est une convention qui présente l’avantage de se démarquer. On n’a pas de <code class=\"language-text\">private</code> en JS, mais la plupart comprendront qu’on parle là d’une fonction “supposée” privée…</li>\n<li>cela facilite le travail de documentation automatique. Souvent, par convention, l’autocompletion considérera cette fonction comme privée et n’oubliera pas de mettre <code class=\"language-text\">@private</code>. Ça vaut ce que ça vaut, en tout cas ça ne coûte rien \\o/</li>\n</ol>\n<p>C’est donc personnellement une considération de <strong>clarté</strong>. La nature <em>privée</em> de la méthode <code class=\"language-text\">_joke()</code> saute plus facilement aux yeux.</p>\n<p>En revanche, il est assez commun que cette convention soit utilisée pour tenter de <strong>définir</strong> la nature privée d’une méthode au lieu de la mettre en valeur. C’est-à-dire que l’interface publique exposée est composée de méthodes dont certaines sont préfixées avec <code class=\"language-text\">_</code> pour indiquer que celles-ci doivent être <em>considérées comme privées</em>.</p>\n<p>C’est un point qui génère de nombreux débats. D’après mon expérience personnelle, c’est généralement quelque chose qui est mis en place quand on ne sait pas trop comment on fait pour véritablement mettre en place des méthodes privées. Du coup tout est public, mais on indique que certaines sont <em>privées par intention</em>.</p>\n<p>En pratique, il est assez simple de mettre en place des méthodes privées avec le <em>module pattern</em>. Tant qu’à faire, je conseille donc de partir du principe que tout ce qui est exposé est public. Si on souhaite qu’une fonction soit privée, alors autant l’écrire comme telle et utiliser le préfixe <code class=\"language-text\">_</code> simplement pour la lisibilité du code.</p>\n<p>Cela étant, à chaque projet de définir et suivre ses conventions selon ses besoins.</p>\n<h3 id=\"cest-pas-dans-le-prototype-du-coup-pour-lhéritage-et-la-performance-\"><a href=\"#cest-pas-dans-le-prototype-du-coup-pour-lh%C3%A9ritage-et-la-performance-\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>C’est pas dans le prototype… du coup pour l’héritage et la performance ?</h3>\n<p>Effectivement, étant donné qu’elle n’est pas accessible, <strong>une méthode privée ne peut pas être surchargée</strong>. C’est la raison pour laquelle je considère les méthodes privées comme un moyen de simplifier l’interface exposée de mon module. Si j’ai besoin du détail de l’implémentation, que je dois pouvoir y accéder en héritant ma classe, alors j’ai besoin que ce détail soit public.</p>\n<p>Là encore, le scepticisme n’est pas tellement causé la nature des méthodes privées en soi, mais plutôt à une interprétation / implémentation maladroite de celles-ci.</p>\n<p>On notera également le point sur la performance : il y aura autant de fonctions privées que d’instances de mon module, ce qui est techniquement <em>moins performant</em>. Mais en <a href=\"http://jsperf.com/public-vs-private-methods\">analysant effectivement l’impact</a>, cette remarque relève de l’ordre de l’optimisation précoce dans mon utilisation des méthodes privées, pour le moment.</p>\n<h3 id=\"et-comment-jaccède-à-mes-méthodes-publiques-depuis-mes-méthodes-privées-\"><a href=\"#et-comment-jacc%C3%A8de-%C3%A0-mes-m%C3%A9thodes-publiques-depuis-mes-m%C3%A9thodes-priv%C3%A9es-\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Et comment j’accède à mes méthodes publiques depuis mes méthodes privées ?</h3>\n<p>Ceci peut être un point de blocage.</p>\n<p>En fait, si ma fonction privée provient d’un refactor de ma méthode publique, ce n’en est plus un. Tout simplement parce-que ma méthode privée a pour rôle de simplifier l’interface publique, c’est-à-dire de <strong>rendre plus lisible</strong> ma méthode publique.</p>\n<p>J’envisage donc la méthode privée comme un “helper” personnel du module, dont il se sert pour faire son travail. Toutes les variables dont la méthode a besoin lui son donc passées en paramètre.</p>\n<p>Ainsi, on peut simplement envisager de passer le contexte de l’interface publique à la méthode privée :</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> MyModule <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">_addSomeCats</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    context<span class=\"token punctuation\">.</span>cats<span class=\"token operator\">++</span>\n    context<span class=\"token punctuation\">.</span><span class=\"token function\">logNumberOfCats</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    cats<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    addSomeCats<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// En soi cela n'a pas grand intérêt ici de tout envoyer</span>\n      <span class=\"token comment\">// dans une méthode privée, mais c'est pour illustrer la</span>\n      <span class=\"token comment\">// manière dont on passe le contexte.</span>\n      <span class=\"token function\">_addSomeCats</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    logNumberOfCats<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cats<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Ce qui donnera :</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">MyModule<span class=\"token punctuation\">.</span><span class=\"token function\">addSomeCats</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// affiche \"2\"</span></code></pre></div>\n<p>Dans cet exemple, le contexte est passé en paramètre.</p>\n<p>En pratique, il est possible d’utiliser <code class=\"language-text\">this</code> dans la méthode <code class=\"language-text\">_addSomeCats</code> et de l’appeller en lui passant le contexte avec <code class=\"language-text\">.call()</code> ainsi : <code class=\"language-text\">_addSomeCats.call(this)</code>.</p>\n<p>L’exemple précédent ne présente pas un grand intérêt, mais concrètement cela peut se présenter de la manière suivante dans un projet :</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> MyModule <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// syntaxe alternative de `var _createViewInstance = function() { … }`.</span>\n  <span class=\"token comment\">// on a refactor ici quelques tâches répétitives du module.</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">_createViewInstance</span><span class=\"token punctuation\">(</span>View<span class=\"token punctuation\">,</span> $parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>View<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'No View constructor provided'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>$parent<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'No $parent provided'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">var</span> view <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">View</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    view<span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">appendTo</span><span class=\"token punctuation\">(</span>$parent<span class=\"token punctuation\">)</span>\n    view<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> view\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// …</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    onRender<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ordersView <span class=\"token operator\">=</span> <span class=\"token function\">_createViewInstance</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>OrdersView<span class=\"token punctuation\">,</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#orders'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        app<span class=\"token punctuation\">.</span><span class=\"token function\">err</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token comment\">// -> notre façon de log les erreurs qui peuvent subvenir</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ordersView <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">// un tas d'autres trucs…</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// …</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Ce qui nous amène effectivement à <strong>Backbone.js</strong>.</p>\n<h2 id=\"implémentation-avec-backbonejs\"><a href=\"#impl%C3%A9mentation-avec-backbonejs\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Implémentation avec Backbone.js</h2>\n<p>C’est le point qui fut pour moi la cause de cet article. En effet, après avoir assimilé le concept et bien visualisé sa mise en place avec un module, on peut rester perplexe sur la manière de l’implémenter quand on à l’habitude de ceci :</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> MyModule <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> Books <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  Books<span class=\"token punctuation\">.</span>Model <span class=\"token operator\">=</span> Backbone<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// un peu de configuration…</span>\n\n    isPrivate<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'certainly not…'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    _intendedToBePrivate<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// le genre de méthode qui apparaît dans ce genre de situation.</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// …</span>\n\n  <span class=\"token keyword\">return</span> Books\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Finalement, le principe est simple : <code class=\"language-text\">.extend()</code> prend un objet en paramètre. Qu’à cela ne tienne, on peut lui envoyer une <a href=\"/fr/2013/05/bien-isoler-ses-variables-en-javascript/\">IIFE</a> qui lui retourne un objet (son API).</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> MyModule <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> Books <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">var</span> ModelConfiguration <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">_actuallyPrivate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"look 'ma, I'm private!\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// on expose la configuration.</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      defaults<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        isCompleted<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n      urlRoot<span class=\"token punctuation\">:</span> <span class=\"token string\">'/order'</span><span class=\"token punctuation\">,</span>\n\n      isCompleted<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">_actuallyPrivate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'isCompleted'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  Books<span class=\"token punctuation\">.</span>Model <span class=\"token operator\">=</span> Backbone<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span>ModelConfiguration<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// …</span>\n\n  <span class=\"token keyword\">return</span> Books\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"pour-conclure\"><a href=\"#pour-conclure\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pour conclure</h2>\n<p>La question des fonctions privées et de leur intérêt fait toujours débat et peut laisser sceptique. Parfois (souvent ?), ça complique plus le schmilblick qu’autre chose. Aussi, chaque projet doit trouver midi à sa porte et adopter la position qui lui convient.</p>\n<p>En ce qui me concerne, <strong>je crée des méthodes privées lors de mes opérations de refactor</strong>. Si la méthode est publique par nature, je la traite comme telle : pas de préfixe <code class=\"language-text\">_</code>, des tests unitaires. Le plus important pour moi, c’est de ne pas me leurrer avec une convention.</p>\n<p>Quoiqu’il en soit, je me suis questionné un bon moment pour comprendre comment cela pouvait se traduire en utilisant <em>Backbone.js</em>. Et comme j’ai eu du mal à faire le déclic, je me suis fendu de cet article pour aider les prochains qui entreront dans les mêmes réflexions que j’ai pu avoir.</p>\n<p>Cela étant, c’est un point à débats et à réflexions. N’hésitez donc pas, je suis preneur de suggestions et remarques à ce sujet !</p>","fields":{"tagSlugs":["/fr/tags/javascript/","/fr/tags/backbone-js/","/fr/tags/privacy/"],"slug":"/fr/2014/12/fonctions-privees-backbonejs/"},"timeToRead":9,"frontmatter":{"title":"Fonctions privées avec Backbone.js","tags":["javascript","backbone.js","privacy"],"date":"2014-12-07T00:00:00.000Z","description":"Pourquoi et comment faire des fonctions privées. Et concrètement, comment implémenter ça tout en utilisant Backbone.js."}}},"pageContext":{"slug":"/fr/2014/12/fonctions-privees-backbonejs/"}}