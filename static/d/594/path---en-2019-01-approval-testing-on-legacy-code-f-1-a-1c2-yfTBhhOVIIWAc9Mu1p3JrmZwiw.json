{"data":{"site":{"siteMetadata":{"title":"@nicoespeon's blog","subtitles":{"en":"I write about web development, agile practices and personal organization.","fr":"J‚Äô√©cris sur le d√©veloppement web, les pratiques agiles et l‚Äôorganisation personnelle."},"author":{"name":"Nicolas Carlo","twitter":"nicoespeon"},"url":"https://www.nicoespeon.com"}},"markdownRemark":{"id":"b2d7653b-496c-52ac-a14b-8bec6764f72a","html":"<p>Here‚Äôs the deal: you need to change the code to make this awesome new feature work, but that code is not covered by an automated test. How do you know you didn‚Äôt break anything when you‚Äôre done?</p>\n<p>That‚Äôs a typical scenario I frequently face.</p>\n<p>I see different approaches in such a situation:</p>\n<ol>\n<li>\n<p>ü§û <strong>Cross fingers</strong>, do the change and hope nothing breaks. Manually test different use cases you know. After all, you‚Äôre just adding a feature. You know the codebase, more or less. What could go wrong?</p>\n</li>\n<li>\n<p>ü§î <strong>Spend time to understand</strong>, test and refactor the code before changing it. <a href=\"https://twitter.com/kentbeck/status/250733358307500032\">‚ÄúMake the change easy, then make the easy change‚Äù</a>. Sure, it will take some time. You didn‚Äôt estimate that task to take that much time actually. That‚Äôs unexpected complexity. But, in the end, you will leave codebase in a better state and you‚Äôll be able to go faster.</p>\n</li>\n<li>\n<p>üì∏ <strong>Take a snapshot of existing code behavior</strong>. Consider it a black box and capture enough of its behavior to feel confident touching it.</p>\n</li>\n</ol>\n<p>I clearly think the first approach is shooting yourself in the foot ‚àí except if you know you won‚Äôt need to maintain that code. Heck, it seems you‚Äôre maintaining this code already, otherwise, you wouldn‚Äôt have this question in the first place! If you want to keep moving fast without breaking everything, there is a better, more professional way.</p>\n<p>The second approach would be ideal. Working effectively with legacy code requires putting the existing code into a test harness, first. Then, you can refactor. But, it takes skills to write good tests. You should practice these skills though, they will help you with these ‚Äì so common ‚Äì scenarios. Now, I hear you: client demo is next week and you need to ship that cool feature before. You need a pragmatic solution to the problem. You‚Äôre gonna take this shortcut consciously so you can deliver, then you‚Äôll pay the technical debt back. Now, are you stuck with approach #1 then?</p>\n<p>Nope. Approach #3 is more‚Ä¶ pragmatic. You have to put your code under test before you touch it anyway. But, who said you need to completely understand current code to do so? What you want is to know if you break existing behavior when you touch the code. This, you can do with <strong>Approval Testing</strong>.</p>\n<p>The main idea is:</p>\n<ul>\n<li>take a snapshot of existing code behavior, in all possible variations</li>\n<li>use test coverage to discover parts of the code not covered with the variations</li>\n<li>use mutations to ensure you detect any broken behavior</li>\n</ul>\n<p><strong>You don‚Äôt need to understand existing code to do so.</strong> That‚Äôs the good news.</p>\n<p>There is a pre-requisite though: you need to take a snapshot of your code behavior, meaning that you <strong>should be able to stringify the output of your code</strong>, including side-effects. If your codebase was not designed with tests in mind, you probably need to rely on <a href=\"https://www.oreilly.com/library/view/working-effectively-with/0131177052/\">Michael Feather‚Äôs book</a> to help you get started.</p>\n<p>Now, let see how you can do that in JavaScript.</p>\n<h2 id=\"approval-testing-in-javascript\"><a href=\"#approval-testing-in-javascript\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Approval Testing in JavaScript</h2>\n<p>My personal go-to for JavaScript testing nowadays is <a href=\"https://jestjs.io/\">Jest</a>.</p>\n<p>It is simple to set up ‚Äì almost no configuration needed. It has a wonderful test runner baked in, with a powerful watch mode. Finally, and that‚Äôs what you‚Äôre looking for, it can take snapshots.</p>\n<figure>\n  <img src=\"/jest-runner-88925241a8fcb472f4d8cc8479a7174f.gif\" alt=\"Jest runner in action\">\n  <figcaption>Jest runner in action &#x2013; damn it&apos;s so cool!</figcaption>\n</figure>\n<p>Snapshots are powerful. But they are a <em>test-after</em> technique. I usually recommend to practice <a href=\"https://en.wikipedia.org/wiki/Test_driven_development\">Test-Driven Developement</a>, so you should barely need snapshots. Actually, <strong>snapshots have very few valid use-cases</strong>. Putting tests on existing code, before refactoring it, is one of these.</p>\n<p>Now, I need an example. I‚Äôll use the <a href=\"http://iamnotmyself.com/2011/02/13/refactor-this-the-gilded-rose-kata/\">Gilded Rose kata</a> to illustrate that. It‚Äôs an exercise to practice refactoring techniques, which is really convenient here. I made a <a href=\"https://github.com/nicoespeon/kata-gilded-rose-js\">JS starter</a> of the kata that you can use.</p>\n<p>So you have 2 classes:¬†<code class=\"language-text\">Shop</code> and <code class=\"language-text\">Item</code>. <code class=\"language-text\">Item</code> is pretty simple:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Item</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> sellIn<span class=\"token punctuation\">,</span> quality<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sellIn <span class=\"token operator\">=</span> sellIn\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>quality <span class=\"token operator\">=</span> quality\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then you have <code class=\"language-text\">Shop</code> which takes a list of <code class=\"language-text\">items</code> and have a method <code class=\"language-text\">updateQuality()</code> that will update the <code class=\"language-text\">quality</code> and <code class=\"language-text\">sellIn</code> attributes of every item. There is a bunch of logic that‚Äôs currently supposed to work. It is not pretty though, so I won‚Äôt put it here but give you <a href=\"https://github.com/nicoespeon/kata-gilded-rose-js/blob/954274fb04741e9c2992f9b31482daca366e0055/gilded-rose.js#L14-L69\">a link to the beast</a> instead.</p>\n<p>Your goal: change <code class=\"language-text\">updateQuality()</code> so it deals with <code class=\"language-text\">&quot;Conjured&quot;</code> items too (they degrade in quality twice as fast as normal items).</p>\n<p>There is no test. A good idea is to refactor this code first ‚Äì make the change easy, remember?</p>\n<p>Let me show you how to apply the Approval Testing technique in such a scenario.</p>\n<h3 id=\"1-generate-an-output-you-can-snapshot\"><a href=\"#1-generate-an-output-you-can-snapshot\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Generate an output you can snapshot</h3>\n<p>The first step is to generate a snapshot from <code class=\"language-text\">updateQuality()</code>. It doesn‚Äôt return a string, but it changes <code class=\"language-text\">items</code>. Thus, my first move is to write a function returning something which captures the changes so Jest can take a snapshot of it:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// I put that code in my test file, since it's test-related.</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> sellIn<span class=\"token punctuation\">,</span> quality<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> gildedRose <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Shop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> sellIn<span class=\"token punctuation\">,</span> quality<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> items <span class=\"token operator\">=</span> gildedRose<span class=\"token punctuation\">.</span><span class=\"token function\">updateQuality</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> items<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I could have returned <code class=\"language-text\">items</code>, but I‚Äôm simplifying things a bit here: I‚Äôm only testing a shop with one item. That‚Äôs because I already know the behavior is the same regardless the number of items. It might not be your case. You should adapt to your situation, this is the tricky part.</p>\n<p>Now I have a <code class=\"language-text\">doUpdateQuality(name, sellIn, quality)</code> I can call from my tests. It will instantiate the shop, call the method I‚Äôm testing and return me the updated item.</p>\n<p>My next move is to write the first test, taking a snapshot from the output:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should update quality'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> sellIn<span class=\"token punctuation\">,</span> quality<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ‚Ä¶</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If you‚Äôre not familiar with Jest snapshot testing, I suggest you take a few minutes to have a look at <a href=\"https://jestjs.io/docs/en/snapshot-testing#snapshot-testing-with-jest\">their documentation</a>. I will wait üòâ</p>\n<h3 id=\"2-using-test-coverage-to-find-all-input-combinations\"><a href=\"#2-using-test-coverage-to-find-all-input-combinations\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Using test coverage to find all input combinations</h3>\n<p>At this point, I generated a first snapshot, given a set of parameters. Jest will tell me if any regression happens to that scenario. Can I go refactor <code class=\"language-text\">updateQuality()</code> now? Nope. Because I‚Äôm not covering all the code with this snapshot. This, I can know thanks to the test coverage!</p>\n<p>To generate test coverage, I run Jest with the <code class=\"language-text\">--coverage</code> option.</p>\n<p>I find the <code class=\"language-text\">html</code> report to be the best in this scenario. To do so, I need to configure Jest options. This can be done in a config file, or quickly in <code class=\"language-text\">package.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"gilded-rose-kata\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ‚Ä¶</span>\n  <span class=\"token string\">\"scripts\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"jest\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"jest\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"coverageReporters\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"html\"</span>\n      <span class=\"token comment\">// I could add \"text\" or \"text-summary\" to see output in the console</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then, I run <code class=\"language-text\">yarn test --coverage</code> (or <code class=\"language-text\">npm run test -- --coverage</code>), which generates a <code class=\"language-text\">coverage/</code> folder.</p>\n<p>I open the <code class=\"language-text\">coverage/index.html</code> file:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/coverage-1-a3b44c81d9f13b612fb7923841071d85-d02bf.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 97.87878787878788%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAADKElEQVQ4y41Ui3KbOhD1/3/STdJMH3bT9N72pnFix8TGNm8LhBAIgcCcLthN0oybKTNndoVgtTp7dkezsMKNb/Bg+5jfTbG213i0LCSMYXj2HdAR9vvDuuue0e+9ejfaxBxeViAuFJI8QyQ4WQkvZihMDb1vkdcVKnTgRX7wuz1U20CTDVNOvkFJ66zSGO3O3iM+/4jd+Rjxu89g5xPwS7IXn8DejZFcTsgfD3509oG++3TYGzBG8M977MgfQHFGmsXgWxeB5WJ1a2E7teBO5xCuj8wLwOwN8iBAk2bP4IKsONrs4KcHf2S6BpFaoSEq1m4Ke7tGwEI4voeqMWh7GvH3z6gmTuLMQUM/57JCyjm01uA8QVkWR9J7vru/wsgYA0GpVlX9fEz3wh0+fOl3b2eodQmexohjiZUdYGM78DYBiuIexjhHNfyexa/gJwOWpUIsfJJZQ0EqgkRJV87ziLbLkz+9lSUFLJGKFEpRYNJkStcvdT5sGqqUqWuCQUOLlrTWkfZOcffroFFPfCgstNQJP25u4W19yCKjTAtkQtFhHIwzCLJ1pYaAb2U9ZMjTZFikIkcYCUSRhx1JR0oBVjPYcgM/9yAqAdWUSHSCmJDVEqlOf8+wvypL3KEvd74Dd7VCynJEvg++C8FI1DzZgUtGSiigCYWWyJVArRXaIwVPATVlqKMQzcZDTh3iXt3CntxiNZ6QnWA9+YLg+xTW9TW2366x+e8rlv9eIZhPUVEfv5bToSg8HRYNkd7jj88weY6tc0KbTxkq6ueWESePDrY3K4R3FqLZDMHdDNH9AvFiTf1Mtyg1tMxhiKan0fW6KH3AOmQwKwfV/RLB1znChyXY0kK4sJCut2BrB4H9CObYCNfEsetAZDFKKpBuNKq2eiEbVUIkHHvSWkeaK0iHvVxkJqi3BUqVQ2oBXiZQnUZN46IfGanJhirndQ5l1HPAiq5hKMN6YaP6MUfx/wzbDzewzq6wODvH48UlVhcf4X3+hthawuRUaSFhpDoo/9SVFfHX9nONcbTULYUXQbo9XGSEnOZi4ZO4tx7NyB4kfnpXSznU5mVRfgJ5QPp/u0qpuQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Coverage output with a lot of red lines\"\n        title=\"\"\n        src=\"/static/coverage-1-a3b44c81d9f13b612fb7923841071d85-c83f1.png\"\n        srcset=\"/static/coverage-1-a3b44c81d9f13b612fb7923841071d85-569e3.png 240w,\n/static/coverage-1-a3b44c81d9f13b612fb7923841071d85-93400.png 480w,\n/static/coverage-1-a3b44c81d9f13b612fb7923841071d85-c83f1.png 960w,\n/static/coverage-1-a3b44c81d9f13b612fb7923841071d85-d02bf.png 1320w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>All the red lines, I don‚Äôt test.</p>\n<figure>\n  <blockquote>\n    <p>Test coverage can only tell you<br>what code is not tested, nothing else.</p>\n  </blockquote>\n</figure>\n<p>Let‚Äôs figure out another combination that would cover more lines‚Ä¶ An item with a positive quality should do:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should update quality'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>I run the test again. A new snapshot is generated.</p>\n<p>Coverage report is updated:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/coverage-2-04a789346aece6e4a881623da856728a-5b83d.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 97.87556904400606%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC1klEQVQ4y5VUbW/TMBjs//9FvHxASIgvgAZjY+tKmzTvadzEzrudtMfZiG0t0waWTo4d5XLn5x4vrtIBF4nB0k9x8+Manu9jtVqhKAo8Hsfj0eF8nO8tgjhFmAkU+xJCFMiyDPv9HlEUoaoqdF0HpZSby7J06PseTdO4Oc9zt/fn/WLoO1h03YBh0HweYbTBOI5cD/ezhSV4DLtniR7vLbQxTkFRKARBjiTKkYaxU9C2LVXavzf3ll8CCQdk6g7TNMP3BTabNZI0JvmWCnrM80TM+NdBwhFCRSTUVDWipCJrpSz3tND9VZQXFRpalpWC1vpR6c6r+3ylTxRaW6UUrHCDjZdi64WItxma9juM8RzZ8Xg4UfFUXO4JrS0hE8yHiUUYiJpWB9oXfK2f/Og5lQtbail/500wi5VUJKzdy2kC7JHYGNnZFuhc7blqErZI5YoKD/j69RuiIEHT1S4ySjGsskRRCUhVQo+9I3xOtVNYlpVbSNkw+YrdEmG3S1GrCmLcYaM8xCqA7OnE9BC9cKjHGnKUpwq7rkVebl1ptR6RJGw9oVwbCrFzPV23PAbDjppHjEQ/sfU0W4/k02xOErDoB2t5aXcwTwY31ze0XSAMAoShh2Drs7clol1CbJEUMWIib3ZoqPBwmP+2vGeYXRHsgeP/x4nlgYTdTmDOCqilj+DLHbLLW+Tfr5BeXnH+AXGzRhPFmFraljVM0/Lv89NFsYSaZIaBHvlh+nmJbOWh8DbIfq5RBSFEmCD11ygiH5nvoYpDJkDwLHkLEfZcH2LD/Enm72hDR7RUoGTLCks0tUTPm6YeJMp+D+pj1A8wRDUpSK1Qa0bMtA+EIxVOVKhv1xgurtF8uUbw7gKr1x+xfPUaqzdvsX7zHvGHTxC3K2hVY2DvG0USbZ623Io9DnWLuWLV2Cktb/A6ZVx4e1s02Q5tXkHGXKcJVMKMMl6ad+bxrCi/AA2KCClRYBLfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Coverage output with less red lines\"\n        title=\"\"\n        src=\"/static/coverage-2-04a789346aece6e4a881623da856728a-c83f1.png\"\n        srcset=\"/static/coverage-2-04a789346aece6e4a881623da856728a-569e3.png 240w,\n/static/coverage-2-04a789346aece6e4a881623da856728a-93400.png 480w,\n/static/coverage-2-04a789346aece6e4a881623da856728a-c83f1.png 960w,\n/static/coverage-2-04a789346aece6e4a881623da856728a-5b83d.png 1318w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Yay, less red lines!</p>\n<p>So you get the idea: during this phase, I need to find all the possible combinations that would cover all the code. No more red lines.</p>\n<p>Let‚Äôs fast-forward a bit. Here‚Äôs what I‚Äôve got:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should update quality'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Aged Brie'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/coverage-3-77c53f9aeb0d0f9bc39da61b93d4378e-2c575.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 101.74326465927099%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC80lEQVQ4y41UaY/bNhDV//9HOdqP3U2RoNkgAda3XVsHRYmHJIoidbwO5WODxtmExoDjEfU0w/dmoqfE4lPi8LyP8eXLP9gfDlgsF2AsQ1jT5TdO483/aYz+RxlTKISFUi1UqSG4hCgU0pihMx6DG2GqFoOfoEUN2ziMHnBtT/sESe/0dCbErXGIHldv8GH9Fg/Ld3jc/InH9Xv8vfmD/Hf4sCF/S/767P+1fIMH8h8vdo0F/2H1dn4WybpAwo/Yxycsthusd2tsNs/IyhO4ypDkR+QyQWUF6k6dzV53+RK7WNT3HrzaYRyA478K8SkGzxmSOIHrHIZ+pGcjfndFnbPI9R5936MUBnmeo64rcH7er2uapt+yyHsPKRVCpvdWYI7OzYevwK9maK0lQIGybJBmEjkjn/auO9FH4rvZvQYcmbYBlycC6KhcRcYIXKIolhiG7Jbd92CvArZtO5fsvUPwg3nf4eV8kOyv7/H6fM6Q6Q2s7XA4pNQhHFVTzaA1ibXSNSqlZ/NE4Dj0P7nr6ZqhAS/Pbda2A7FbI8tS2lPqAgFuGDZyi1gdIRsON3jUrobuNFrfwniDIWjulqFpqPXyORAIEtReJQEJwaG1gmokOAHpTsL0Bp76rukbSBJxAKtchX7sXwCbtsJJfp0DQUKfPn7E8ZBju9tjt1tiv9ui4CV1C0dM3ZPJFLnKwWqGwhQkfPdjyYVgl8BE6U9wzpNZMjdbT91iLWVG1YQ7b5oGnnQ7jOM9UgiwZHOAF5yyOxJIT/fZEYhB+GCQVEckAa+L+gJY4yTOJWutsVrsiRQaGMlptkBQUVZIsgyCyhaihK70/IHxjnSiUEYhs1vA2h7GkGRqSaVVNCA6IqFGYQsImjiSJkwggxuOpE6hiJyyLW9MzzrMxHaevmGt11/x7ekzyqJFHAddxsjShK6jIMZpmF5IuFf9XHJrCVCt5iEQVk1ZLZ5X1HoVGLUhYwkylpKUNOlV0kTKUVHJSik46q7/l/wf5KUDByaCJPkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Coverage output with no red line\"\n        title=\"\"\n        src=\"/static/coverage-3-77c53f9aeb0d0f9bc39da61b93d4378e-c83f1.png\"\n        srcset=\"/static/coverage-3-77c53f9aeb0d0f9bc39da61b93d4378e-569e3.png 240w,\n/static/coverage-3-77c53f9aeb0d0f9bc39da61b93d4378e-93400.png 480w,\n/static/coverage-3-77c53f9aeb0d0f9bc39da61b93d4378e-c83f1.png 960w,\n/static/coverage-3-77c53f9aeb0d0f9bc39da61b93d4378e-2c575.png 1262w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>No more red lines, but I still have these <code class=\"language-text\">E</code> symbols. These symbols mean that I‚Äôm covering the <code class=\"language-text\">if</code> case, but I‚Äôm missing the <code class=\"language-text\">else</code> clause ‚Äì that‚Äôs why only 68.57% of branches are covered. I need to cover them too:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should update quality'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Aged Brie'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Aged Brie'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Sulfuras, Hand of Ragnaros'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Sulfuras, Hand of Ragnaros'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</span>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">49</span><span class=\"token punctuation\">)</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>So far, so good. I‚Äôm covering every line and branch. Can I go refactor <code class=\"language-text\">updateQuality()</code> now?</p>\n<p>Well‚Ä¶ not yet. Remember when I said test coverage can only tell you ‚Äúwhat code is not tested‚Äù? That means it doesn‚Äôt tell you if the covered code is properly tested.</p>\n<p>This is why setting a test coverage objective to ensure test quality doesn‚Äôt work. Test coverage tells you parts that are not tested ‚Äì and that might be fine not to test these parts. Other than that, it says nothing.</p>\n<p>To me, good test coverage comes as a side-effect of a good testing strategy (TDD). It‚Äôs not a target.</p>\n<h3 id=\"3-use-mutations-to-verify-snapshots\"><a href=\"#3-use-mutations-to-verify-snapshots\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Use mutations to verify snapshots</h3>\n<p>To ensure the covered code is actually tested, I‚Äôm gonna introduce little mutations in the code.</p>\n<p>The goal here is to see the test fail. If I change the existing code and a test fail, I‚Äôll feel safe refactoring this code! When the test has failed, I revert the mutation and move to another line.</p>\n<p>What mutations should you introduce? Again, it depends on what you‚Äôre testing ‚Äì sorry. Usually, mutate the side-effects that you‚Äôre capturing in your snapshot. In my case, that means I don‚Äôt have to change <code class=\"language-text\">if</code>s, but only the updates to <code class=\"language-text\">item</code>. There are 8 of them.</p>\n<p>Let‚Äôs start with the first assignment, line 22:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">!=</span> <span class=\"token string\">'Sulfuras, Hand of Ragnaros'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>quality <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>quality <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I‚Äôll introduce a little mutation, just to check:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">!=</span> <span class=\"token string\">'Sulfuras, Hand of Ragnaros'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>quality <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>quality <span class=\"token operator\">-</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I run my tests again:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-49d4c.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 38.7%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA10lEQVQoz5WSa26DMBCEOUfxg2XXLwhVQqWo97/YdHFCQ0hp1R+fxpat2dHYzel8RZ4uKGVEjAVEAdYLjOvRmg7GUlXre1AUdOGOPNQzV7We0HzOV5zOHwhphKQBxjPe1GA1W1n2bfsHeqeZ44h3KZiUizKHEdnJzeAXtsO2NIWzGjByHDBoyqJKHdf41tFN97hH6hfDIQREktpdxxGkuJ5rL37V3Xo5N+7AsISsieS7t7WLFzXPXW0f7MkwJe1vmiASD3s54seE3AckSfD6Tcwy+Z+me74Agqjb140/D1gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"A snapshot failed\"\n        title=\"\"\n        src=\"/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-c83f1.png\"\n        srcset=\"/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-569e3.png 240w,\n/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-93400.png 480w,\n/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-c83f1.png 960w,\n/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-23e13.png 1440w,\n/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-10d8f.png 1920w,\n/static/failed-snapshot-1-f75bbfacdee7a1d2f70764aec33dd59a-49d4c.png 2000w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Great! I know my test will catch any regression here. I can revert my mutation.</p>\n<p>Let‚Äôs move on the other ones. I introduce a similar mutation line 33:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>quality <span class=\"token operator\">&lt;</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>quality <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>quality <span class=\"token operator\">+</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Run tests again and‚Ä¶</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/passing-tests-53842161570902bb6f2a34eaa3782299-41e23.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 572px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 60.48951048951049%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACWUlEQVQozz2S6XbaQAyFeQmSAN7wboPHG94NcRNIIKSQNu0T9B36qz199FuNCPmhczRjz9XVJ400X0CNShj5GoonoGU9dDprywJ62kJZlgiEQF/ZiIWLOCnRND38IEKSrtC0axhzB9OZDkWdY5RXLR6ej0jKFnnZYP24R1z2KLoB7eYBadnRYx+eY0A3LNi2D4tC0y3MTYdzKTRTjItgVw/o6nuUWYs0LpFSVdv2EIYRh+eF9PMc41sVk6nGcXM7+8zvJuqnoIzR8HONzY8ex197NF8rjG9mMC0PjhsiXMRwvQVFiIBalHdz0+V76Uzm8tu1XXb49ucJ3//u8f5vj9PvHUzTw9PzCx63z3h7e8f+8IqSsByPJwzDFmlW4Hz+zuxWqxr9esDtnQpVMy8OJxMN+apCVXcoioYfRyKlc08DWJHjKT1QuE3Zngx5lq6uIcVk++yQrRKjuefACQJ0NIyy6lh4GSVcqOvvUdNkw4XAqqg5T7OSCwfEWbpumjXlghx+QJ4qOldRP1go2hyaJqcawNBdDmVmEhKfGeuGzetyZWfZl7uRVJcuJHTJpG037DCKUpguCfkkGrnwclqdLODcMC7r4rgB/+f5CzbDDGuyKuHLNgraQ3mWeZ5XhMCHm/jItimKl5wig+gFbCuASyJxkqPtNiz6yVDy2e722O0OzOQ6rfF4BsOxsGyWEGvi9JggHgREJ0gsZF6RyFDT8ESc8dLLt6PhyxYnWoPT+RsOtCLH1zMPYTrVSdBG8hAjKEIUx5wEYxSHHO4ygIhyLJYxu5SDkuik6H9c0G6CRLzXBgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"All tests passing\"\n        title=\"\"\n        src=\"/static/passing-tests-53842161570902bb6f2a34eaa3782299-41e23.png\"\n        srcset=\"/static/passing-tests-53842161570902bb6f2a34eaa3782299-c2b80.png 240w,\n/static/passing-tests-53842161570902bb6f2a34eaa3782299-bf6fa.png 480w,\n/static/passing-tests-53842161570902bb6f2a34eaa3782299-41e23.png 572w\"\n        sizes=\"(max-width: 572px) 100vw, 572px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>That‚Äôs not good.</p>\n<p>Before going further, I revert the mutation in the code. <strong>Don‚Äôt let mutations live long.</strong></p>\n<p>Then, at that point, I need to think a bit about the code ‚Äì yeah, I lied, but you don‚Äôt have to understand <em>all</em> the code. How could this happen? I suspect that a further update makes me take another path in the following logic, resulting in a similar result with my given combinations. Looking at the lines of code I want to mutate, I find this one to be interesting:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">!=</span> <span class=\"token string\">'Sulfuras, Hand of Ragnaros'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>sellIn <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>sellIn <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\n</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>sellIn <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ‚Ä¶</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That means if <code class=\"language-text\">sellIn</code> is <code class=\"language-text\">0</code>, then it doesn‚Äôt execute the rest of the code. I try to add another combination:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should update quality'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Aged Brie'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Aged Brie'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Sulfuras, Hand of Ragnaros'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Sulfuras, Hand of Ragnaros'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">49</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>I generate the new snapshot, then retry the mutation:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-14179.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABQ0lEQVQoz41SW3LCMAzMMUoejh3JrzwoSckA0x6gZ+n9/7eyoZ0yA4WPtSTbI620KuL+hDAf0C9H+H4AEYM4whgL63qEcYdaEapao27MQxRfyzs+t3uspw+s6xHOD3BhgGoJL6VCKfhJ9kzSYtIOx2nBPK8Y+i36MKKPE7yN4M6heYLVVUIlx0wBi3EYtMVO/DeKGXMX4Jtzu8+iSAyitBmEaWgZQdjFBGHLNqBpDRrdib3gni//aiUM69rAyQUbgpW5ddKmIY9OoMlCM8FYFstof33Ksb7c5zciKClQJJqeHUbv87w2SYiqvcKmFPsHVaVvI7VcysHCZhhfhZkFOxFDBCEOmaURxl5UTyuUYmIprDpUzW3FM0MtLS/ThCn2cDI3LTuY0GrO63OOOccJ/61QTpg+WVGXRGkl1VObj9S8l/QbCpMWNshtG48AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"A snapshot is now failing\"\n        title=\"\"\n        src=\"/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-c83f1.png\"\n        srcset=\"/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-569e3.png 240w,\n/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-93400.png 480w,\n/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-c83f1.png 960w,\n/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-23e13.png 1440w,\n/static/failed-snapshot-2-7355dbad31ce95777e7b18aa5a2d7d9d-14179.png 1532w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p><img src=\"/yes-ff326b278cccfa096e43ed222b460064.gif\"></p>\n<p>It worked!</p>\n<p>I revert my mutation and continue to the next assignment. I do that until I know all of them are <em>actually</em> covered with tests.</p>\n<p>Hopefully, I didn‚Äôt found other false positive for coverage. Here‚Äôs the final list of tests:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should update quality'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Aged Brie'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Aged Brie'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Sulfuras, Hand of Ragnaros'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Sulfuras, Hand of Ragnaros'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">49</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">doUpdateQuality</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Can I go refactor <code class=\"language-text\">updateQuality()</code> now?</p>\n<p>Yes! All the code is now covered by snapshots. A wrong move and I‚Äôll automatically know that. I can now refactor the code without introducing bugs. Then I‚Äôll add the feature ü§ò</p>\n<h3 id=\"4-these-tests-are-technical-debt\"><a href=\"#4-these-tests-are-technical-debt\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. These tests are technical debt</h3>\n<p>If you apply this recipe, remember this:¬†you accepted to take technical debt here. You traded well-written tests against snapshots of existing behavior to get a test harness faster so you can refactor.</p>\n<p>Snapshots are powerful, but they don‚Äôt help you understand what the code is supposed to do. Once the code is refactored, you should pay the debt back: write proper, comprehensive tests on your clean code to replace your snapshots. If you do so, this part of the codebase will be easier to maintain in the future, and you‚Äôll add new features faster.</p>\n<h2 id=\"introducing-jest-extended-snapshot\"><a href=\"#introducing-jest-extended-snapshot\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introducing jest-extended-snapshot</h2>\n<p>Looking at the resulting test code, I thought that was a lot of boilerplate code in a single <code class=\"language-text\">it</code>!</p>\n<p>So I refactored it with a custom Jest matcher: <code class=\"language-text\">toVerifyAllCombinations()</code>.</p>\n<p>With it, the previous code could be written the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should update quality'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>doUpdateQuality<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toVerifyAllCombinations</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'Aged Brie'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'Backstage passes to a TAFKAL80ETC concert'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'Sulfuras, Hand of Ragnaros'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">49</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>It will generate all possible combinations of the following arguments, call <code class=\"language-text\">doUpdateQuality()</code> with each and take a snapshot of all results.</p>\n<p>I like it because it expresses the intention better: ‚Äúcurrent behavior should be preserved for all these scenarios‚Äù.</p>\n<p>I extracted that into a library so you can use it too: <a href=\"https://github.com/nicoespeon/jest-extended-snapshot#readme\">jest-extended-snapshot</a> üëπ</p>\n<h2 id=\"inspiration\"><a href=\"#inspiration\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Inspiration</h2>\n<p>I discovered Approval Testing thanks to <a href=\"https://twitter.com/emilybache\">Emily Bache</a>. She made a very nice 20-min screencast where she runs a demo of this very example, in Java:</p>\n<div>\n          <div\n            class=\"gatsby-resp-iframe-wrapper\"\n            style=\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 1.0725rem\"\n          >\n            <iframe src=\"https://www.youtube.com/embed/zyM2Ep28ED8\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen style=\"\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          \"></iframe>\n          </div>\n          </div>\n<p>You can read more about Approval Testing on <a href=\"http://approvaltests.com/\">http://approvaltests.com/</a>.</p>\n<p>They have a library to do that in JS, with Mocha: <a href=\"https://github.com/approvals/Approvals.NodeJS\">https://github.com/approvals/Approvals.NodeJS</a></p>","fields":{"tagSlugs":["/tags/tests/","/tags/legacy-code/","/tags/jest/"],"slug":"/en/2019/01/approval-testing-on-legacy-code/"},"timeToRead":13,"frontmatter":{"title":"\"I need to change this code, but it has no test\"","tags":["tests","legacy code","jest"],"date":"2019-01-12T00:00:00.000Z","description":"An introduction to \"Approval Testing\" in JavaScript with Jest."}}},"pageContext":{"slug":"/en/2019/01/approval-testing-on-legacy-code/"}}